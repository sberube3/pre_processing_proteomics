---
title: "Bland_Altman_With_Ranks"
output: pdf_document
---
```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)
library(MASS)
library(EnvStats)
library(riverplot)
library(viridis)
library(DescTools)
library(preprocessCore)
library(limma)
setwd("/Users/sophieberube/Desktop/Hopkins/Hopkins/Research_Protein_Arrays/Tamaki_arrays")

```

```{r,echo=FALSE,warning=FALSE,results="hide",cache=TRUE, results='hide'}

##############duplicate removal function 
array_clean<-function(x,data){
  Array_x_whole<-data

  Array_x<- Array_x_whole[60:9308,]

  colnames(Array_x)<-c("Index","Array_Row","Array_Column","Spot_Row","Spot_Column",
                        "Name","ID","X","Y","Diameter","F_Pixels","B_Pixels","Footprint",
                        "Flags","Ch1_Median","Ch1_Mean","Ch1_SD","Ch1_B_Median","Ch1_B_Mean",
                        "Ch1_B_SD","Ch1_%_>_B_+_1_SD","Ch1_%_>_B+2_SD", 
                        "Ch1_F_%_Sat.", "Ch1_Median_-_B", "Ch1_Mean_-B",
                        "Ch1_SignalNoiseRatio")

  a<-(8*x)-7
  b<-(8*x)-6
  c<-(8*x)-5
  d<-(8*x)-4
  e<-(8*x)-3
  f<-(8*x)-2
  g<-(8*x)-1
  h<-(8*x)
  

  Array_a<- Array_x%>%
    filter(Array_Row==1)
  
  Array_b<- Array_x%>%
    filter(Array_Row==2)
  
  Array_c<- Array_x%>%
    filter(Array_Row==3)
  
  Array_d<- Array_x%>%
    filter(Array_Row==4)
  
  Array_e<- Array_x%>%
    filter(Array_Row==5)
  
  Array_f<- Array_x%>%
    filter(Array_Row==6)
  
  Array_g<- Array_x%>%
    filter(Array_Row==7)
  
  Array_h<- Array_x%>%
    filter(Array_Row==8)
  
 
  return(list(Array_a,Array_b,Array_c,Array_d,Array_e,Array_f,Array_g,Array_h))

}
#############################################

```

```{r, cache=TRUE, message=FALSE, echo=FALSE, warning=FALSE}

data_1<-read.csv("./tamaki_csv/1_280_100.csv",header=TRUE,stringsAsFactors = F)



Array_1<-array_clean(x=1,data=data_1)

Sample_1<- Array_1[[1]]
Sample_2<- Array_1[[2]]
Sample_3<- Array_1[[3]]
Sample_4<- Array_1[[4]]
Sample_5<- Array_1[[5]]
Sample_6<- Array_1[[6]]
Sample_7<- Array_1[[7]]
Sample_8<- Array_1[[8]]
#######################################################
data_2<-read.delim("./tamaki_csv/2_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_2<- array_clean(x=2,data=data_2)

Sample_9<- Array_2[[1]]
Sample_10<- Array_2[[2]]
Sample_11<- Array_2[[3]]
Sample_12<- Array_2[[4]]
Sample_13<- Array_2[[5]]
Sample_14<- Array_2[[6]]
Sample_15<- Array_2[[7]]
Sample_16<- Array_2[[8]]

#############################
data_3<-read.delim("./tamaki_csv/3_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_3<- array_clean(x=3,data=data_3)

Sample_17<- Array_3[[1]]
Sample_18<- Array_3[[2]]
Sample_19<- Array_3[[3]]
Sample_20<- Array_3[[4]]
Sample_21<- Array_3[[5]]
Sample_22<- Array_3[[6]]
Sample_23<- Array_3[[7]]
Sample_24<- Array_3[[8]]
###############################
data_4<-read.delim("./tamaki_csv/4_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_4<- array_clean(x=4,data=data_4)

Sample_25<- Array_4[[1]]
Sample_26<- Array_4[[2]]
Sample_27<- Array_4[[3]]
Sample_28<- Array_4[[4]]
Sample_29<- Array_4[[5]]
Sample_30<- Array_4[[6]]
Sample_31<- Array_4[[7]]
Sample_32<- Array_4[[8]]

##################################

data_5<-read.delim("./tamaki_csv/5_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_5<- array_clean(x=5,data=data_5)

Sample_33<- Array_5[[1]]
Sample_34<- Array_5[[2]]
Sample_35<- Array_5[[3]]
Sample_36<- Array_5[[4]]
Sample_37<- Array_5[[5]]
Sample_38<- Array_5[[6]]
Sample_39<- Array_5[[7]]
Sample_40<- Array_5[[8]]

####################################


data_6<-read.delim("./tamaki_csv/6_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_6<- array_clean(x=6,data=data_6)

Sample_41<- Array_6[[1]]
Sample_42<- Array_6[[2]]
Sample_43<- Array_6[[3]]
Sample_44<- Array_6[[4]]
Sample_45<- Array_6[[5]]
Sample_46<- Array_6[[6]]
Sample_47<- Array_6[[7]]
Sample_48<- Array_6[[8]]

################################


data_7<-read.delim("./tamaki_csv/7_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_7<- array_clean(x=7,data=data_7)

Sample_49<- Array_7[[1]]
Sample_50<- Array_7[[2]]
Sample_51<- Array_7[[3]]
Sample_52<- Array_7[[4]]
Sample_53<- Array_7[[5]]
Sample_54<- Array_7[[6]]
Sample_55<- Array_7[[7]]
Sample_56<- Array_7[[8]]

##################################


data_8<-read.delim("./tamaki_csv/8_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_8<- array_clean(x=8,data=data_8)

Sample_57<- Array_8[[1]]
Sample_58<- Array_8[[2]]
Sample_59<- Array_8[[3]]
Sample_60<- Array_8[[4]]
Sample_61<- Array_8[[5]]
Sample_62<- Array_8[[6]]
Sample_63<- Array_8[[7]]
Sample_64<- Array_8[[8]]

#####################################


data_9<-read.delim("./tamaki_csv/9_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_9<- array_clean(x=9,data=data_9)

Sample_65<- Array_9[[1]]
Sample_66<- Array_9[[2]]
Sample_67<- Array_9[[3]]
Sample_68<- Array_9[[4]]
Sample_69<- Array_9[[5]]
Sample_70<- Array_9[[6]]
Sample_71<- Array_9[[7]]
Sample_72<- Array_9[[8]]

###################################


data_10<-read.delim("./tamaki_csv/10_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_10<- array_clean(x=10,data=data_10)

Sample_73<- Array_10[[1]]
Sample_74<- Array_10[[2]]
Sample_75<- Array_10[[3]]
Sample_76<- Array_10[[4]]
Sample_77<- Array_10[[5]]
Sample_78<- Array_10[[6]]
Sample_79<- Array_10[[7]]
Sample_80<- Array_10[[8]]

#########################################
data_11<-read.delim("./tamaki_csv/11_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_11<- array_clean(x=11,data=data_11)

Sample_81<- Array_11[[1]]
Sample_82<- Array_11[[2]]
Sample_83<- Array_11[[3]]
Sample_84<- Array_11[[4]]
Sample_85<- Array_11[[5]]
Sample_86<- Array_11[[6]]
Sample_87<- Array_11[[7]]
Sample_88<- Array_11[[8]]

#################################
data_12<-read.delim("./tamaki_csv/12_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_12<- array_clean(x=12,data=data_12)

Sample_89<- Array_12[[1]]
Sample_90<- Array_12[[2]]
Sample_91<- Array_12[[3]]
Sample_92<- Array_12[[4]]
Sample_93<- Array_12[[5]]
Sample_94<- Array_12[[6]]
Sample_95<- Array_12[[7]]
Sample_96<- Array_12[[8]]

###############################################

data_13<-read.delim("./tamaki_csv/13_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_13<- array_clean(x=13,data=data_13)

Sample_97<- Array_13[[1]]
Sample_98<- Array_13[[2]]
Sample_99<- Array_13[[3]]
Sample_100<- Array_13[[4]]
Sample_101<- Array_13[[5]]
Sample_102<- Array_13[[6]]
Sample_103<- Array_13[[7]]
Sample_104<- Array_13[[8]]

#####################################

data_14<-read.delim("./tamaki_csv/14_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_14<- array_clean(x=14,data=data_14)

Sample_105<- Array_14[[1]]
Sample_106<- Array_14[[2]]
Sample_107<- Array_14[[3]]
Sample_108<- Array_14[[4]]
Sample_109<- Array_14[[5]]
Sample_110<- Array_14[[6]]
Sample_111<- Array_14[[7]]
Sample_112<- Array_14[[8]]

#########################################

data_15<-read.delim("./tamaki_csv/15_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_15<- array_clean(x=15,data=data_15)

Sample_113<- Array_15[[1]]
Sample_114<- Array_15[[2]]
Sample_115<- Array_15[[3]]
Sample_116<- Array_15[[4]]
Sample_117<- Array_15[[5]]
Sample_118<- Array_15[[6]]
Sample_119<- Array_15[[7]]
Sample_120<- Array_15[[8]]

##########################################

data_16<-read.delim("./tamaki_csv/16_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_16<- array_clean(x=16,data=data_16)

Sample_121<- Array_16[[1]]
Sample_122<- Array_16[[2]]
Sample_123<- Array_16[[3]]
Sample_124<- Array_16[[4]]
Sample_125<- Array_16[[5]]
Sample_126<- Array_16[[6]]
Sample_127<- Array_16[[7]]
Sample_128<- Array_16[[8]]

########################################


data_17<-read.delim("./tamaki_csv/17_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_17<- array_clean(x=17,data=data_17)

Sample_129<- Array_17[[1]]
Sample_130<- Array_17[[2]]
Sample_131<- Array_17[[3]]
Sample_132<- Array_17[[4]]
Sample_133<- Array_17[[5]]
Sample_134<- Array_17[[6]]
Sample_135<- Array_17[[7]]
Sample_136<- Array_17[[8]]

############################


data_18<-read.delim("./tamaki_csv/18_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_18<- array_clean(x=18,data=data_18)

Sample_137<- Array_18[[1]]
Sample_138<- Array_18[[2]]
Sample_139<- Array_18[[3]]
Sample_140<- Array_18[[4]]
Sample_141<- Array_18[[5]]
Sample_142<- Array_18[[6]]
Sample_143<- Array_18[[7]]
Sample_144<- Array_18[[8]]

##########################################


data_19<-read.delim("./tamaki_csv/19_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_19<- array_clean(x=19,data=data_19)

Sample_145<- Array_19[[1]]
Sample_146<- Array_19[[2]]
Sample_147<- Array_19[[3]]
Sample_148<- Array_19[[4]]
Sample_149<- Array_19[[5]]
Sample_150<- Array_19[[6]]
Sample_151<- Array_19[[7]]
Sample_152<- Array_19[[8]]

#########################################


data_20<-read.delim("./tamaki_csv/20_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_20<- array_clean(x=20,data=data_20)

Sample_153<- Array_20[[1]]
Sample_154<- Array_20[[2]]
Sample_155<- Array_20[[3]]
Sample_156<- Array_20[[4]]
Sample_157<- Array_20[[5]]
Sample_158<- Array_20[[6]]
Sample_159<- Array_20[[7]]
Sample_160<- Array_20[[8]]

##############################################

data_21<-read.delim("./tamaki_csv/21_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_21<- array_clean(x=21,data=data_21)

Sample_161<- Array_21[[1]]
Sample_162<- Array_21[[2]]
Sample_163<- Array_21[[3]]
Sample_164<- Array_21[[4]]
Sample_165<- Array_21[[5]]
Sample_166<- Array_21[[6]]
Sample_167<- Array_21[[7]]
Sample_168<- Array_21[[8]]

##############################################

data_22<-read.delim("./tamaki_csv/22_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_22<- array_clean(x=22,data=data_22)

Sample_169<- Array_22[[1]]
Sample_170<- Array_22[[2]]
Sample_171<- Array_22[[3]]
Sample_172<- Array_22[[4]]
Sample_173<- Array_22[[5]]
Sample_174<- Array_22[[6]]
Sample_175<- Array_22[[7]]
Sample_176<- Array_22[[8]]

####################################


data_23<-read.delim("./tamaki_csv/23_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_23<- array_clean(x=23,data=data_23)

Sample_177<- Array_23[[1]]
Sample_178<- Array_23[[2]]
Sample_179<- Array_23[[3]]
Sample_180<- Array_23[[4]]
Sample_181<- Array_23[[5]]
Sample_182<- Array_23[[6]]
Sample_183<- Array_23[[7]]
Sample_184<- Array_23[[8]]

#########################################


data_24<-read.delim("./tamaki_csv/24_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_24<- array_clean(x=24,data=data_24)

Sample_185<- Array_24[[1]]
Sample_186<- Array_24[[2]]
Sample_187<- Array_24[[3]]
Sample_188<- Array_24[[4]]
Sample_189<- Array_24[[5]]
Sample_190<- Array_24[[6]]
Sample_191<- Array_24[[7]]
Sample_192<- Array_24[[8]]

##################################


data_25<-read.delim("./tamaki_csv/25_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_25<- array_clean(x=25,data=data_25)

Sample_193<- Array_25[[1]]
Sample_194<- Array_25[[2]]
Sample_195<- Array_25[[3]]
Sample_196<- Array_25[[4]]
Sample_197<- Array_25[[5]]
Sample_198<- Array_25[[6]]
Sample_199<- Array_25[[7]]
Sample_200<- Array_25[[8]]

#################################

data_26<-read.delim("./tamaki_csv/26_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_26<- array_clean(x=26,data=data_26)

Sample_201<- Array_26[[1]]
Sample_202<- Array_26[[2]]
Sample_203<- Array_26[[3]]
Sample_204<- Array_26[[4]]
Sample_205<- Array_26[[5]]
Sample_206<- Array_26[[6]]
Sample_207<- Array_26[[7]]
Sample_208<- Array_26[[8]]

############################################


data_27<-read.delim("./tamaki_csv/27_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_27<- array_clean(x=27,data=data_27)

Sample_209<- Array_27[[1]]
Sample_210<- Array_27[[2]]
Sample_211<- Array_27[[3]]
Sample_212<- Array_27[[4]]
Sample_213<- Array_27[[5]]
Sample_214<- Array_27[[6]]
Sample_215<- Array_27[[7]]
Sample_216<- Array_27[[8]]

#######################################


data_28<-read.delim("./tamaki_csv/28_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_28<- array_clean(x=28,data=data_28)

Sample_217<- Array_28[[1]]
Sample_218<- Array_28[[2]]
Sample_219<- Array_28[[3]]
Sample_220<- Array_28[[4]]
Sample_221<- Array_28[[5]]
Sample_222<- Array_28[[6]]
Sample_223<- Array_28[[7]]
Sample_224<- Array_28[[8]]

#############################################

data_29<-read.delim("./tamaki_csv/29_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_29<- array_clean(x=29,data=data_29)

Sample_225<- Array_29[[1]]
Sample_226<- Array_29[[2]]
Sample_227<- Array_29[[3]]
Sample_228<- Array_29[[4]]
Sample_229<- Array_29[[5]]
Sample_230<- Array_29[[6]]
Sample_231<- Array_29[[7]]
Sample_232<- Array_29[[8]]

###############################################


data_30<-read.delim("./tamaki_csv/30_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_30<- array_clean(x=30,data=data_30)

Sample_233<- Array_30[[1]]
Sample_234<- Array_30[[2]]
Sample_235<- Array_30[[3]]
Sample_236<- Array_30[[4]]
Sample_237<- Array_30[[5]]
Sample_238<- Array_30[[6]]
Sample_239<- Array_30[[7]]
Sample_240<- Array_30[[8]]

##############################################


data_31<-read.delim("./tamaki_csv/31_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_31<- array_clean(x=31,data=data_31)

Sample_241<- Array_31[[1]]
Sample_242<- Array_31[[2]]
Sample_243<- Array_31[[3]]
Sample_244<- Array_31[[4]]
Sample_245<- Array_31[[5]]
Sample_246<- Array_31[[6]]
Sample_247<- Array_31[[7]]
Sample_248<- Array_31[[8]]

##############################################



data_32<-read.delim("./tamaki_csv/32_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_32<- array_clean(x=32,data=data_32)

Sample_249<- Array_32[[1]]
Sample_250<- Array_32[[2]]
Sample_251<- Array_32[[3]]
Sample_252<- Array_32[[4]]
Sample_253<- Array_32[[5]]
Sample_254<- Array_32[[6]]
Sample_255<- Array_32[[7]]
Sample_256<- Array_32[[8]]

#############################################



data_33<-read.delim("./tamaki_csv/33_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_33<- array_clean(x=33,data=data_33)

Sample_257<- Array_33[[1]]
Sample_258<- Array_33[[2]]
Sample_259<- Array_33[[3]]
Sample_260<- Array_33[[4]]
Sample_261<- Array_33[[5]]
Sample_262<- Array_33[[6]]
Sample_263<- Array_33[[7]]
Sample_264<- Array_33[[8]]

###########################################



data_34<-read.delim("./tamaki_csv/34_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_34<- array_clean(x=34,data=data_34)

Sample_265<- Array_34[[1]]
Sample_266<- Array_34[[2]]
Sample_267<- Array_34[[3]]
Sample_268<- Array_34[[4]]
Sample_269<- Array_34[[5]]
Sample_270<- Array_34[[6]]
Sample_271<- Array_34[[7]]
Sample_272<- Array_34[[8]]

####################################


data_35<-read.delim("./tamaki_csv/35_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_35<- array_clean(x=35,data=data_35)

Sample_273<- Array_35[[1]]
Sample_274<- Array_35[[2]]
Sample_275<- Array_35[[3]]
Sample_276<- Array_35[[4]]
Sample_277<- Array_35[[5]]
Sample_278<- Array_35[[6]]
Sample_279<- Array_35[[7]]
Sample_280<- Array_35[[8]]

######################################


data_36<-read.delim("./tamaki_csv/36_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_36<- array_clean(x=36,data=data_36)

Sample_281<- Array_36[[1]]
Sample_282<- Array_36[[2]]
Sample_283<- Array_36[[3]]
Sample_284<- Array_36[[4]]
Sample_285<- Array_36[[5]]
Sample_286<- Array_36[[6]]
Sample_287<- Array_36[[7]]
Sample_288<- Array_36[[8]]

##############################################



data_37<-read.delim("./tamaki_csv/37_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_37<- array_clean(x=37,data=data_37)

Sample_289<- Array_37[[1]]
Sample_290<- Array_37[[2]]
Sample_291<- Array_37[[3]]
Sample_292<- Array_37[[4]]
Sample_293<- Array_37[[5]]
Sample_294<- Array_37[[6]]
Sample_295<- Array_37[[7]]
Sample_296<- Array_37[[8]]

#######################################



data_38<-read.delim("./tamaki_csv/38_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_38<- array_clean(x=38,data=data_38)

Sample_297<- Array_38[[1]]
Sample_298<- Array_38[[2]]
Sample_299<- Array_38[[3]]
Sample_300<- Array_38[[4]]
Sample_301<- Array_38[[5]]
Sample_302<- Array_38[[6]]
Sample_303<- Array_38[[7]]
Sample_304<- Array_38[[8]]

###########################################



data_39<-read.delim("./tamaki_csv/39_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_39<- array_clean(x=39,data=data_39)

Sample_305<- Array_39[[1]]
Sample_306<- Array_39[[2]]
Sample_307<- Array_39[[3]]
Sample_308<- Array_39[[4]]
Sample_309<- Array_39[[5]]
Sample_310<- Array_39[[6]]
Sample_311<- Array_39[[7]]
Sample_312<- Array_39[[8]]

########################################

data_40<-read.delim("./tamaki_csv/40_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_40<- array_clean(x=40,data=data_40)

Sample_313<- Array_40[[1]]
Sample_314<- Array_40[[2]]
Sample_315<- Array_40[[3]]
Sample_316<- Array_40[[4]]
Sample_317<- Array_40[[5]]
Sample_318<- Array_40[[6]]
Sample_319<- Array_40[[7]]
Sample_320<- Array_40[[8]]

##############################################

data_41<-read.delim("./tamaki_csv/41_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_41<- array_clean(x=41,data=data_41)

Sample_321<- Array_41[[1]]
Sample_322<- Array_41[[2]]
Sample_323<- Array_41[[3]]
Sample_324<- Array_41[[4]]
Sample_325<- Array_41[[5]]
Sample_326<- Array_41[[6]]
Sample_327<- Array_41[[7]]
Sample_328<- Array_41[[8]]

################################################

data_42<-read.delim("./tamaki_csv/42_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_42<- array_clean(x=42,data=data_42)

Sample_329<- Array_42[[1]]
Sample_330<- Array_42[[2]]
Sample_331<- Array_42[[3]]
Sample_332<- Array_42[[4]]
Sample_333<- Array_42[[5]]
Sample_334<- Array_42[[6]]
Sample_335<- Array_42[[7]]
Sample_336<- Array_42[[8]]

#############################################


data_43<-read.delim("./tamaki_csv/43_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_43<- array_clean(x=43,data=data_43)

Sample_337<- Array_43[[1]]
Sample_338<- Array_43[[2]]
Sample_339<- Array_43[[3]]
Sample_340<- Array_43[[4]]
Sample_341<- Array_43[[5]]
Sample_342<- Array_43[[6]]
Sample_343<- Array_43[[7]]
Sample_344<- Array_43[[8]]

#########################################


data_44<-read.delim("./tamaki_csv/44_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_44<- array_clean(x=44,data=data_44)

Sample_345<- Array_44[[1]]
Sample_346<- Array_44[[2]]
Sample_347<- Array_44[[3]]
Sample_348<- Array_44[[4]]
Sample_349<- Array_44[[5]]
Sample_350<- Array_44[[6]]
Sample_351<- Array_44[[7]]
Sample_352<- Array_44[[8]]

#############################################


data_45<-read.delim("./tamaki_csv/45_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_45<- array_clean(x=45,data=data_45)

Sample_353<- Array_45[[1]]
Sample_354<- Array_45[[2]]
Sample_355<- Array_45[[3]]
Sample_356<- Array_45[[4]]
Sample_357<- Array_45[[5]]
Sample_358<- Array_45[[6]]
Sample_359<- Array_45[[7]]
Sample_360<- Array_45[[8]]

#############################################


data_46<-read.delim("./tamaki_csv/46_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_46<- array_clean(x=46,data=data_46)

Sample_361<- Array_46[[1]]
Sample_362<- Array_46[[2]]
Sample_363<- Array_46[[3]]
Sample_364<- Array_46[[4]]
Sample_365<- Array_46[[5]]
Sample_366<- Array_46[[6]]
Sample_367<- Array_46[[7]]
Sample_368<- Array_46[[8]]

#################################################


data_47<-read.delim("./tamaki_csv/47_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_47<- array_clean(x=47,data=data_47)

Sample_369<- Array_47[[1]]
Sample_370<- Array_47[[2]]
Sample_371<- Array_47[[3]]
Sample_372<- Array_47[[4]]
Sample_373<- Array_47[[5]]
Sample_374<- Array_47[[6]]
Sample_375<- Array_47[[7]]
Sample_376<- Array_47[[8]]

################################################

data_48<-read.delim("./tamaki_csv/48_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_48<- array_clean(x=48,data=data_48)

Sample_377<- Array_48[[1]]
Sample_378<- Array_48[[2]]
Sample_379<- Array_48[[3]]
Sample_380<- Array_48[[4]]
Sample_381<- Array_48[[5]]
Sample_382<- Array_48[[6]]
Sample_383<- Array_48[[7]]
Sample_384<- Array_48[[8]]

#####################################################

data_49<-read.delim("./tamaki_csv/49_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_49<- array_clean(x=49,data=data_49)

Sample_385<- Array_49[[1]]
Sample_386<- Array_49[[2]]
Sample_387<- Array_49[[3]]
Sample_388<- Array_49[[4]]
Sample_389<- Array_49[[5]]
Sample_390<- Array_49[[6]]
Sample_391<- Array_49[[7]]
Sample_392<- Array_49[[8]]

###########################################


data_50<-read.delim("./tamaki_csv/50_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_50<- array_clean(x=50,data=data_50)

Sample_393<- Array_50[[1]]
Sample_394<- Array_50[[2]]
Sample_395<- Array_50[[3]]
Sample_396<- Array_50[[4]]
Sample_397<- Array_50[[5]]
Sample_398<- Array_50[[6]]
Sample_399<- Array_50[[7]]
Sample_400<- Array_50[[8]]

############################################


data_51<-read.delim("./tamaki_csv/51_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_51<- array_clean(x=51,data=data_51)

Sample_401<- Array_51[[1]]
Sample_402<- Array_51[[2]]
Sample_403<- Array_51[[3]]
Sample_404<- Array_51[[4]]
Sample_405<- Array_51[[5]]
Sample_406<- Array_51[[6]]
Sample_407<- Array_51[[7]]
Sample_408<- Array_51[[8]]

##############################################


data_52<-read.delim("./tamaki_csv/52_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_52<- array_clean(x=52,data=data_52)

Sample_409<- Array_52[[1]]
Sample_410<- Array_52[[2]]
Sample_411<- Array_52[[3]]
Sample_412<- Array_52[[4]]
Sample_413<- Array_52[[5]]
Sample_414<- Array_52[[6]]
Sample_415<- Array_52[[7]]
Sample_416<- Array_52[[8]]

##########################################


data_53<-read.delim("./tamaki_csv/53_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_53<- array_clean(x=53,data=data_53)

Sample_417<- Array_53[[1]]
Sample_418<- Array_53[[2]]
Sample_419<- Array_53[[3]]
Sample_420<- Array_53[[4]]
Sample_421<- Array_53[[5]]
Sample_422<- Array_53[[6]]
Sample_423<- Array_53[[7]]
Sample_424<- Array_53[[8]]

###########################################


data_54<-read.delim("./tamaki_csv/54_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_54<- array_clean(x=54,data=data_54)

Sample_425<- Array_54[[1]]
Sample_426<- Array_54[[2]]
Sample_427<- Array_54[[3]]
Sample_428<- Array_54[[4]]
Sample_429<- Array_54[[5]]
Sample_430<- Array_54[[6]]
Sample_431<- Array_54[[7]]
Sample_432<- Array_54[[8]]

#########################################

data_55<-read.delim("./tamaki_csv/55_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_55<- array_clean(x=55,data=data_55)

Sample_433<- Array_55[[1]]
Sample_434<- Array_55[[2]]
Sample_435<- Array_55[[3]]
Sample_436<- Array_55[[4]]
Sample_437<- Array_55[[5]]
Sample_438<- Array_55[[6]]
Sample_439<- Array_55[[7]]
Sample_440<- Array_55[[8]]

######################################

data_56<-read.delim("./tamaki_csv/56_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_56<- array_clean(x=56,data=data_56)

Sample_441<- Array_56[[1]]
Sample_442<- Array_56[[2]]
Sample_443<- Array_56[[3]]
Sample_444<- Array_56[[4]]
Sample_445<- Array_56[[5]]
Sample_446<- Array_56[[6]]
Sample_447<- Array_56[[7]]
Sample_448<- Array_56[[8]]

########################################

data_57<-read.delim("./tamaki_csv/57_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_57<- array_clean(x=57,data=data_57)

Sample_449<- Array_57[[1]]
Sample_450<- Array_57[[2]]
Sample_451<- Array_57[[3]]
Sample_452<- Array_57[[4]]
Sample_453<- Array_57[[5]]
Sample_454<- Array_57[[6]]
Sample_455<- Array_57[[7]]
Sample_456<- Array_57[[8]]

########################################


data_58<-read.delim("./tamaki_csv/58_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_58<- array_clean(x=58,data=data_58)

Sample_457<- Array_58[[1]]
Sample_458<- Array_58[[2]]
Sample_459<- Array_58[[3]]
Sample_460<- Array_58[[4]]
Sample_461<- Array_58[[5]]
Sample_462<- Array_58[[6]]
Sample_463<- Array_58[[7]]
Sample_464<- Array_58[[8]]

########################################

data_59<-read.delim("./tamaki_csv/59_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_59<- array_clean(x=59,data=data_59)

Sample_465<- Array_59[[1]]
Sample_466<- Array_59[[2]]
Sample_467<- Array_59[[3]]
Sample_468<- Array_59[[4]]
Sample_469<- Array_59[[5]]
Sample_470<- Array_59[[6]]
Sample_471<- Array_59[[7]]
Sample_472<- Array_59[[8]]

##################################################

data_60<-read.delim("./tamaki_csv/60_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_60<- array_clean(x=60,data=data_60)

Sample_473<- Array_60[[1]]
Sample_474<- Array_60[[2]]
Sample_475<- Array_60[[3]]
Sample_476<- Array_60[[4]]
Sample_477<- Array_60[[5]]
Sample_478<- Array_60[[6]]
Sample_479<- Array_60[[7]]
Sample_480<- Array_60[[8]]

#############################################


data_61<-read.delim("./tamaki_csv/61_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_61<- array_clean(x=61,data=data_61)

Sample_481<- Array_61[[1]]
Sample_482<- Array_61[[2]]
Sample_483<- Array_61[[3]]
Sample_484<- Array_61[[4]]
Sample_485<- Array_61[[5]]
Sample_486<- Array_61[[6]]
Sample_487<- Array_61[[7]]
Sample_488<- Array_61[[8]]

##########################################


data_62<-read.delim("./tamaki_csv/62_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_62<- array_clean(x=62,data=data_62)

Sample_489<- Array_62[[1]]
Sample_490<- Array_62[[2]]
Sample_491<- Array_62[[3]]
Sample_492<- Array_62[[4]]
Sample_493<- Array_62[[5]]
Sample_494<- Array_62[[6]]
Sample_495<- Array_62[[7]]
Sample_496<- Array_62[[8]]

##########################################


data_63<-read.delim("./tamaki_csv/63_280_100.txt",header=TRUE,stringsAsFactors = F)

Array_63<- array_clean(x=63,data=data_63)

Sample_497<- Array_63[[1]]
Sample_498<- Array_63[[2]]
Sample_499<- Array_63[[3]]
Sample_500<- Array_63[[4]]
Sample_501<- Array_63[[5]]
Sample_502<- Array_63[[6]]
Sample_503<- Array_63[[7]]
Sample_504<- Array_63[[8]]
```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE,results='hide'}

#make a matrix of FG values

fg_vals<- as.data.frame(cbind(Sample_1$Ch1_Median,Sample_2$Ch1_Median,
                              Sample_3$Ch1_Median,Sample_4$Ch1_Median,
                              Sample_5$Ch1_Median,Sample_6$Ch1_Median,
                              Sample_7$Ch1_Median,Sample_8$Ch1_Median,
                              Sample_9$Ch1_Median,Sample_10$Ch1_Median,
                              Sample_11$Ch1_Median,Sample_12$Ch1_Median,
                              Sample_13$Ch1_Median,Sample_14$Ch1_Median,
                              Sample_15$Ch1_Median,Sample_16$Ch1_Median,
                              Sample_17$Ch1_Median,Sample_18$Ch1_Median,
                              Sample_19$Ch1_Median,Sample_20$Ch1_Median,
                              Sample_21$Ch1_Median,Sample_22$Ch1_Median,
                              Sample_23$Ch1_Median,Sample_24$Ch1_Median,
                              Sample_25$Ch1_Median,Sample_26$Ch1_Median,
                              Sample_27$Ch1_Median,Sample_28$Ch1_Median,
                              Sample_29$Ch1_Median,Sample_30$Ch1_Median,
                              Sample_31$Ch1_Median,Sample_32$Ch1_Median,
                              Sample_33$Ch1_Median,Sample_34$Ch1_Median,
                              Sample_35$Ch1_Median,Sample_36$Ch1_Median,
                              Sample_37$Ch1_Median,Sample_38$Ch1_Median,
                              Sample_39$Ch1_Median,Sample_40$Ch1_Median,
                              Sample_41$Ch1_Median,Sample_42$Ch1_Median,
                              Sample_43$Ch1_Median,Sample_44$Ch1_Median,
                              Sample_45$Ch1_Median,Sample_46$Ch1_Median,
                              Sample_47$Ch1_Median,Sample_48$Ch1_Median,
                              Sample_49$Ch1_Median,Sample_50$Ch1_Median,
                              Sample_51$Ch1_Median,Sample_52$Ch1_Median,
                              Sample_53$Ch1_Median,Sample_54$Ch1_Median,
                              Sample_55$Ch1_Median,Sample_56$Ch1_Median,
                              Sample_57$Ch1_Median,Sample_58$Ch1_Median,
                              Sample_59$Ch1_Median,Sample_60$Ch1_Median,
                              Sample_61$Ch1_Median,Sample_62$Ch1_Median,
                              Sample_63$Ch1_Median,Sample_64$Ch1_Median,
                              Sample_65$Ch1_Median,Sample_66$Ch1_Median,
                              Sample_67$Ch1_Median,Sample_68$Ch1_Median,
                              Sample_69$Ch1_Median,Sample_70$Ch1_Median,
                              Sample_71$Ch1_Median,Sample_72$Ch1_Median,
                              Sample_73$Ch1_Median,Sample_74$Ch1_Median,
                              Sample_75$Ch1_Median,Sample_76$Ch1_Median,
                              Sample_77$Ch1_Median,Sample_78$Ch1_Median,
                              Sample_79$Ch1_Median,Sample_80$Ch1_Median,
                              Sample_81$Ch1_Median,Sample_82$Ch1_Median,
                              Sample_83$Ch1_Median,Sample_84$Ch1_Median,
                              Sample_85$Ch1_Median,Sample_86$Ch1_Median,
                              Sample_87$Ch1_Median,Sample_88$Ch1_Median,
                              Sample_89$Ch1_Median,Sample_90$Ch1_Median,
                              Sample_91$Ch1_Median,Sample_92$Ch1_Median,
                              Sample_93$Ch1_Median,Sample_94$Ch1_Median,
                              Sample_95$Ch1_Median,Sample_96$Ch1_Median,
                              Sample_97$Ch1_Median,Sample_98$Ch1_Median,
                              Sample_99$Ch1_Median,Sample_100$Ch1_Median,
                              Sample_101$Ch1_Median,Sample_102$Ch1_Median,
                              Sample_103$Ch1_Median,Sample_104$Ch1_Median,
                              Sample_105$Ch1_Median,Sample_106$Ch1_Median,
                              Sample_107$Ch1_Median,Sample_108$Ch1_Median,
                              Sample_109$Ch1_Median,Sample_110$Ch1_Median,
                              Sample_111$Ch1_Median,Sample_112$Ch1_Median,
                              Sample_113$Ch1_Median,Sample_114$Ch1_Median,
                              Sample_115$Ch1_Median,Sample_116$Ch1_Median,
                              Sample_117$Ch1_Median,Sample_118$Ch1_Median,
                              Sample_119$Ch1_Median,Sample_120$Ch1_Median,
                              Sample_121$Ch1_Median,Sample_122$Ch1_Median,
                              Sample_123$Ch1_Median,Sample_124$Ch1_Median,
                              Sample_125$Ch1_Median,Sample_126$Ch1_Median,
                              Sample_127$Ch1_Median,Sample_128$Ch1_Median,
                              Sample_129$Ch1_Median,Sample_130$Ch1_Median,
                              Sample_131$Ch1_Median,Sample_132$Ch1_Median,
                              Sample_133$Ch1_Median,Sample_134$Ch1_Median,
                              Sample_135$Ch1_Median,Sample_136$Ch1_Median,
                              Sample_137$Ch1_Median,Sample_138$Ch1_Median,
                              Sample_139$Ch1_Median,Sample_140$Ch1_Median,
                              Sample_141$Ch1_Median,Sample_142$Ch1_Median,
                              Sample_143$Ch1_Median,Sample_144$Ch1_Median,
                              Sample_145$Ch1_Median,Sample_146$Ch1_Median,
                              Sample_147$Ch1_Median,Sample_148$Ch1_Median,
                              Sample_149$Ch1_Median,Sample_150$Ch1_Median,
                              Sample_151$Ch1_Median,Sample_152$Ch1_Median,
                              Sample_153$Ch1_Median,Sample_154$Ch1_Median,
                              Sample_155$Ch1_Median,Sample_156$Ch1_Median,
                              Sample_157$Ch1_Median,Sample_158$Ch1_Median,
                              Sample_159$Ch1_Median,Sample_160$Ch1_Median,
                              Sample_161$Ch1_Median,Sample_162$Ch1_Median,
                              Sample_163$Ch1_Median,Sample_164$Ch1_Median,
                              Sample_165$Ch1_Median,Sample_166$Ch1_Median,
                              Sample_167$Ch1_Median,Sample_168$Ch1_Median,
                              Sample_169$Ch1_Median,Sample_170$Ch1_Median,
                              Sample_171$Ch1_Median,Sample_172$Ch1_Median,
                              Sample_173$Ch1_Median,Sample_174$Ch1_Median,
                              Sample_175$Ch1_Median,Sample_176$Ch1_Median,
                              Sample_177$Ch1_Median,Sample_178$Ch1_Median,
                              Sample_179$Ch1_Median,Sample_180$Ch1_Median,
                              Sample_181$Ch1_Median,Sample_182$Ch1_Median,
                              Sample_183$Ch1_Median,Sample_184$Ch1_Median,
                              Sample_185$Ch1_Median,Sample_186$Ch1_Median,
                              Sample_187$Ch1_Median,Sample_188$Ch1_Median,
                              Sample_189$Ch1_Median,Sample_190$Ch1_Median,
                              Sample_191$Ch1_Median,Sample_192$Ch1_Median,
                              Sample_193$Ch1_Median,Sample_194$Ch1_Median,
                              Sample_195$Ch1_Median,Sample_196$Ch1_Median,
                              Sample_197$Ch1_Median,Sample_198$Ch1_Median,
                              Sample_199$Ch1_Median,Sample_200$Ch1_Median,
                              Sample_201$Ch1_Median,Sample_202$Ch1_Median,
                              Sample_203$Ch1_Median,Sample_204$Ch1_Median,
                              Sample_205$Ch1_Median,Sample_206$Ch1_Median,
                              Sample_207$Ch1_Median,Sample_208$Ch1_Median,
                              Sample_209$Ch1_Median,Sample_210$Ch1_Median,
                              Sample_211$Ch1_Median,Sample_212$Ch1_Median,
                              Sample_213$Ch1_Median,Sample_214$Ch1_Median,
                              Sample_215$Ch1_Median,Sample_216$Ch1_Median,
                              Sample_217$Ch1_Median,Sample_218$Ch1_Median,
                              Sample_219$Ch1_Median,Sample_220$Ch1_Median,
                              Sample_221$Ch1_Median,Sample_222$Ch1_Median,
                              Sample_223$Ch1_Median,Sample_224$Ch1_Median,
                              Sample_225$Ch1_Median,Sample_226$Ch1_Median,
                              Sample_227$Ch1_Median,Sample_228$Ch1_Median,
                              Sample_229$Ch1_Median,Sample_230$Ch1_Median,
                              Sample_231$Ch1_Median,Sample_232$Ch1_Median,
                              Sample_233$Ch1_Median,Sample_234$Ch1_Median,
                              Sample_235$Ch1_Median,Sample_236$Ch1_Median,
                              Sample_237$Ch1_Median,Sample_238$Ch1_Median,
                              Sample_239$Ch1_Median,Sample_240$Ch1_Median,
                              Sample_241$Ch1_Median,Sample_242$Ch1_Median,
                              Sample_243$Ch1_Median,Sample_244$Ch1_Median,
                              Sample_245$Ch1_Median,Sample_246$Ch1_Median,
                              Sample_247$Ch1_Median,Sample_248$Ch1_Median,
                              Sample_249$Ch1_Median,Sample_250$Ch1_Median,
                              Sample_251$Ch1_Median,Sample_252$Ch1_Median,
                              Sample_253$Ch1_Median,Sample_254$Ch1_Median,
                              Sample_255$Ch1_Median,Sample_256$Ch1_Median,
                              Sample_257$Ch1_Median,Sample_258$Ch1_Median,
                              Sample_259$Ch1_Median,Sample_260$Ch1_Median,
                              Sample_261$Ch1_Median,Sample_262$Ch1_Median,
                              Sample_263$Ch1_Median,Sample_264$Ch1_Median,
                              Sample_265$Ch1_Median,Sample_266$Ch1_Median,
                              Sample_267$Ch1_Median,Sample_268$Ch1_Median,
                              Sample_269$Ch1_Median,Sample_270$Ch1_Median,
                              Sample_271$Ch1_Median,Sample_272$Ch1_Median,
                              Sample_273$Ch1_Median,Sample_274$Ch1_Median,
                              Sample_275$Ch1_Median,Sample_276$Ch1_Median,
                              Sample_277$Ch1_Median,Sample_278$Ch1_Median,
                              Sample_279$Ch1_Median,Sample_280$Ch1_Median,
                              Sample_281$Ch1_Median,Sample_282$Ch1_Median,
                              Sample_283$Ch1_Median,Sample_284$Ch1_Median,
                              Sample_285$Ch1_Median,Sample_286$Ch1_Median,
                              Sample_287$Ch1_Median,Sample_288$Ch1_Median,
                              Sample_289$Ch1_Median,Sample_290$Ch1_Median,
                              Sample_291$Ch1_Median,Sample_292$Ch1_Median,
                              Sample_293$Ch1_Median,Sample_294$Ch1_Median,
                              Sample_295$Ch1_Median,Sample_296$Ch1_Median,
                              Sample_297$Ch1_Median,Sample_298$Ch1_Median,
                              Sample_299$Ch1_Median,Sample_300$Ch1_Median,
                              Sample_301$Ch1_Median,Sample_302$Ch1_Median,
                              Sample_303$Ch1_Median,Sample_304$Ch1_Median,
                              Sample_305$Ch1_Median,Sample_306$Ch1_Median,
                              Sample_307$Ch1_Median,Sample_308$Ch1_Median,
                              Sample_309$Ch1_Median,Sample_310$Ch1_Median,
                              Sample_311$Ch1_Median,Sample_312$Ch1_Median,
                              Sample_313$Ch1_Median,Sample_314$Ch1_Median,
                              Sample_315$Ch1_Median,Sample_316$Ch1_Median,
                              Sample_317$Ch1_Median,Sample_318$Ch1_Median,
                              Sample_319$Ch1_Median,Sample_320$Ch1_Median,
                              Sample_321$Ch1_Median,Sample_322$Ch1_Median,
                              Sample_323$Ch1_Median,Sample_324$Ch1_Median,
                              Sample_325$Ch1_Median,Sample_326$Ch1_Median,
                              Sample_327$Ch1_Median,Sample_328$Ch1_Median,
                              Sample_329$Ch1_Median,Sample_330$Ch1_Median,
                              Sample_331$Ch1_Median,Sample_332$Ch1_Median,
                              Sample_333$Ch1_Median,Sample_334$Ch1_Median,
                              Sample_335$Ch1_Median,Sample_336$Ch1_Median,
                              Sample_337$Ch1_Median,Sample_338$Ch1_Median,
                              Sample_339$Ch1_Median,Sample_340$Ch1_Median,
                              Sample_341$Ch1_Median,Sample_342$Ch1_Median,
                              Sample_343$Ch1_Median,Sample_344$Ch1_Median,
                              Sample_345$Ch1_Median,Sample_346$Ch1_Median,
                              Sample_347$Ch1_Median,Sample_348$Ch1_Median,
                              Sample_349$Ch1_Median,Sample_350$Ch1_Median,
                              Sample_351$Ch1_Median,Sample_352$Ch1_Median,
                              Sample_353$Ch1_Median,Sample_354$Ch1_Median,
                              Sample_355$Ch1_Median,Sample_356$Ch1_Median,
                              Sample_357$Ch1_Median,Sample_358$Ch1_Median,
                              Sample_359$Ch1_Median,Sample_360$Ch1_Median,
                              Sample_361$Ch1_Median,Sample_362$Ch1_Median,
                              Sample_363$Ch1_Median,Sample_364$Ch1_Median,
                              Sample_365$Ch1_Median,Sample_366$Ch1_Median,
                              Sample_367$Ch1_Median,Sample_368$Ch1_Median,
                              Sample_369$Ch1_Median,Sample_370$Ch1_Median,
                              Sample_371$Ch1_Median,Sample_372$Ch1_Median,
                              Sample_373$Ch1_Median,Sample_374$Ch1_Median,
                              Sample_375$Ch1_Median,Sample_376$Ch1_Median,
                              Sample_377$Ch1_Median,Sample_378$Ch1_Median,
                              Sample_379$Ch1_Median,Sample_380$Ch1_Median,
                              Sample_381$Ch1_Median,Sample_382$Ch1_Median,
                              Sample_383$Ch1_Median,Sample_384$Ch1_Median,
                              Sample_385$Ch1_Median,Sample_386$Ch1_Median,
                              Sample_387$Ch1_Median,Sample_388$Ch1_Median,
                              Sample_389$Ch1_Median,Sample_390$Ch1_Median,
                              Sample_391$Ch1_Median,Sample_392$Ch1_Median,
                              Sample_393$Ch1_Median,Sample_394$Ch1_Median,
                              Sample_395$Ch1_Median,Sample_396$Ch1_Median,
                              Sample_397$Ch1_Median,Sample_398$Ch1_Median,
                              Sample_399$Ch1_Median,Sample_400$Ch1_Median,
                              Sample_401$Ch1_Median,Sample_402$Ch1_Median,
                              Sample_403$Ch1_Median,Sample_404$Ch1_Median,
                              Sample_405$Ch1_Median,Sample_406$Ch1_Median,
                              Sample_407$Ch1_Median,Sample_408$Ch1_Median,
                              Sample_409$Ch1_Median,Sample_410$Ch1_Median,
                              Sample_411$Ch1_Median,Sample_412$Ch1_Median,
                              Sample_413$Ch1_Median,Sample_414$Ch1_Median,
                              Sample_415$Ch1_Median,Sample_416$Ch1_Median,
                              Sample_417$Ch1_Median,Sample_418$Ch1_Median,
                              Sample_419$Ch1_Median,Sample_420$Ch1_Median,
                              Sample_421$Ch1_Median,Sample_422$Ch1_Median,
                              Sample_423$Ch1_Median,Sample_424$Ch1_Median,
                              Sample_425$Ch1_Median,Sample_426$Ch1_Median,
                              Sample_427$Ch1_Median,Sample_428$Ch1_Median,
                              Sample_429$Ch1_Median,Sample_430$Ch1_Median,
                              Sample_431$Ch1_Median,Sample_432$Ch1_Median,
                              Sample_433$Ch1_Median,Sample_434$Ch1_Median,
                              Sample_435$Ch1_Median,Sample_436$Ch1_Median,
                              Sample_437$Ch1_Median,Sample_438$Ch1_Median,
                              Sample_439$Ch1_Median,Sample_440$Ch1_Median,
                              Sample_441$Ch1_Median,Sample_442$Ch1_Median,
                              Sample_443$Ch1_Median,Sample_444$Ch1_Median,
                              Sample_445$Ch1_Median,Sample_446$Ch1_Median,
                              Sample_447$Ch1_Median,Sample_448$Ch1_Median,
                              Sample_449$Ch1_Median,Sample_450$Ch1_Median,
                              Sample_451$Ch1_Median,Sample_452$Ch1_Median,
                              Sample_453$Ch1_Median,Sample_454$Ch1_Median,
                              Sample_455$Ch1_Median,Sample_456$Ch1_Median,
                              Sample_457$Ch1_Median,Sample_458$Ch1_Median,
                              Sample_459$Ch1_Median,Sample_460$Ch1_Median,
                              Sample_461$Ch1_Median,Sample_462$Ch1_Median,
                              Sample_463$Ch1_Median,Sample_464$Ch1_Median,
                              Sample_465$Ch1_Median,Sample_466$Ch1_Median,
                              Sample_467$Ch1_Median,Sample_468$Ch1_Median,
                              Sample_469$Ch1_Median,Sample_470$Ch1_Median,
                              Sample_471$Ch1_Median,Sample_472$Ch1_Median,
                              Sample_473$Ch1_Median,Sample_474$Ch1_Median,
                              Sample_475$Ch1_Median,Sample_476$Ch1_Median,
                              Sample_477$Ch1_Median,Sample_478$Ch1_Median,
                              Sample_479$Ch1_Median,Sample_480$Ch1_Median,
                              Sample_481$Ch1_Median,Sample_482$Ch1_Median,
                              Sample_483$Ch1_Median,Sample_484$Ch1_Median,
                              Sample_485$Ch1_Median,Sample_486$Ch1_Median,
                              Sample_487$Ch1_Median,Sample_488$Ch1_Median,
                              Sample_489$Ch1_Median,Sample_490$Ch1_Median,
                              Sample_491$Ch1_Median,Sample_492$Ch1_Median,
                              Sample_493$Ch1_Median,Sample_494$Ch1_Median,
                              Sample_495$Ch1_Median,Sample_496$Ch1_Median,
                              Sample_497$Ch1_Median,Sample_498$Ch1_Median,
                              Sample_499$Ch1_Median,Sample_500$Ch1_Median,
                              Sample_501$Ch1_Median,Sample_502$Ch1_Median,
                              Sample_503$Ch1_Median,Sample_504$Ch1_Median))

###################################

bg_vals<- as.data.frame(cbind(Sample_1$Ch1_B_Median,Sample_2$Ch1_B_Median,
                              Sample_3$Ch1_B_Median,Sample_4$Ch1_B_Median,
                              Sample_5$Ch1_B_Median,Sample_6$Ch1_B_Median,
                              Sample_7$Ch1_B_Median,Sample_8$Ch1_B_Median,
                              Sample_9$Ch1_B_Median,Sample_10$Ch1_B_Median,
                              Sample_11$Ch1_B_Median,Sample_12$Ch1_B_Median,
                              Sample_13$Ch1_B_Median,Sample_14$Ch1_B_Median,
                              Sample_15$Ch1_B_Median,Sample_16$Ch1_B_Median,
                              Sample_17$Ch1_B_Median,Sample_18$Ch1_B_Median,
                              Sample_19$Ch1_B_Median,Sample_20$Ch1_B_Median,
                              Sample_21$Ch1_B_Median,Sample_22$Ch1_B_Median,
                              Sample_23$Ch1_B_Median,Sample_24$Ch1_B_Median,
                              Sample_25$Ch1_B_Median,Sample_26$Ch1_B_Median,
                              Sample_27$Ch1_B_Median,Sample_28$Ch1_B_Median,
                              Sample_29$Ch1_B_Median,Sample_30$Ch1_B_Median,
                              Sample_31$Ch1_B_Median,Sample_32$Ch1_B_Median,
                              Sample_33$Ch1_B_Median,Sample_34$Ch1_B_Median,
                              Sample_35$Ch1_B_Median,Sample_36$Ch1_B_Median,
                              Sample_37$Ch1_B_Median,Sample_38$Ch1_B_Median,
                              Sample_39$Ch1_B_Median,Sample_40$Ch1_B_Median,
                              Sample_41$Ch1_B_Median,Sample_42$Ch1_B_Median,
                              Sample_43$Ch1_B_Median,Sample_44$Ch1_B_Median,
                              Sample_45$Ch1_B_Median,Sample_46$Ch1_B_Median,
                              Sample_47$Ch1_B_Median,Sample_48$Ch1_B_Median,
                              Sample_49$Ch1_B_Median,Sample_50$Ch1_B_Median,
                              Sample_51$Ch1_B_Median,Sample_52$Ch1_B_Median,
                              Sample_53$Ch1_B_Median,Sample_54$Ch1_B_Median,
                              Sample_55$Ch1_B_Median,Sample_56$Ch1_B_Median,
                              Sample_57$Ch1_B_Median,Sample_58$Ch1_B_Median,
                              Sample_59$Ch1_B_Median,Sample_60$Ch1_B_Median,
                              Sample_61$Ch1_B_Median,Sample_62$Ch1_B_Median,
                              Sample_63$Ch1_B_Median,Sample_64$Ch1_B_Median,
                              Sample_65$Ch1_B_Median,Sample_66$Ch1_B_Median,
                              Sample_67$Ch1_B_Median,Sample_68$Ch1_B_Median,
                              Sample_69$Ch1_B_Median,Sample_70$Ch1_B_Median,
                              Sample_71$Ch1_B_Median,Sample_72$Ch1_B_Median,
                              Sample_73$Ch1_B_Median,Sample_74$Ch1_B_Median,
                              Sample_75$Ch1_B_Median,Sample_76$Ch1_B_Median,
                              Sample_77$Ch1_B_Median,Sample_78$Ch1_B_Median,
                              Sample_79$Ch1_B_Median,Sample_80$Ch1_B_Median,
                              Sample_81$Ch1_B_Median,Sample_82$Ch1_B_Median,
                              Sample_83$Ch1_B_Median,Sample_84$Ch1_B_Median,
                              Sample_85$Ch1_B_Median,Sample_86$Ch1_B_Median,
                              Sample_87$Ch1_B_Median,Sample_88$Ch1_B_Median,
                              Sample_89$Ch1_B_Median,Sample_90$Ch1_B_Median,
                              Sample_91$Ch1_B_Median,Sample_92$Ch1_B_Median,
                              Sample_93$Ch1_B_Median,Sample_94$Ch1_B_Median,
                              Sample_95$Ch1_B_Median,Sample_96$Ch1_B_Median,
                              Sample_97$Ch1_B_Median,Sample_98$Ch1_B_Median,
                              Sample_99$Ch1_B_Median,Sample_100$Ch1_B_Median,
                              Sample_101$Ch1_B_Median,Sample_102$Ch1_B_Median,
                              Sample_103$Ch1_B_Median,Sample_104$Ch1_B_Median,
                              Sample_105$Ch1_B_Median,Sample_106$Ch1_B_Median,
                              Sample_107$Ch1_B_Median,Sample_108$Ch1_B_Median,
                              Sample_109$Ch1_B_Median,Sample_110$Ch1_B_Median,
                              Sample_111$Ch1_B_Median,Sample_112$Ch1_B_Median,
                              Sample_113$Ch1_B_Median,Sample_114$Ch1_B_Median,
                              Sample_115$Ch1_B_Median,Sample_116$Ch1_B_Median,
                              Sample_117$Ch1_B_Median,Sample_118$Ch1_B_Median,
                              Sample_119$Ch1_B_Median,Sample_120$Ch1_B_Median,
                              Sample_121$Ch1_B_Median,Sample_122$Ch1_B_Median,
                              Sample_123$Ch1_B_Median,Sample_124$Ch1_B_Median,
                              Sample_125$Ch1_B_Median,Sample_126$Ch1_B_Median,
                              Sample_127$Ch1_B_Median,Sample_128$Ch1_B_Median,
                              Sample_129$Ch1_B_Median,Sample_130$Ch1_B_Median,
                              Sample_131$Ch1_B_Median,Sample_132$Ch1_B_Median,
                              Sample_133$Ch1_B_Median,Sample_134$Ch1_B_Median,
                              Sample_135$Ch1_B_Median,Sample_136$Ch1_B_Median,
                              Sample_137$Ch1_B_Median,Sample_138$Ch1_B_Median,
                              Sample_139$Ch1_B_Median,Sample_140$Ch1_B_Median,
                              Sample_141$Ch1_B_Median,Sample_142$Ch1_B_Median,
                              Sample_143$Ch1_B_Median,Sample_144$Ch1_B_Median,
                              Sample_145$Ch1_B_Median,Sample_146$Ch1_B_Median,
                              Sample_147$Ch1_B_Median,Sample_148$Ch1_B_Median,
                              Sample_149$Ch1_B_Median,Sample_150$Ch1_B_Median,
                              Sample_151$Ch1_B_Median,Sample_152$Ch1_B_Median,
                              Sample_153$Ch1_B_Median,Sample_154$Ch1_B_Median,
                              Sample_155$Ch1_B_Median,Sample_156$Ch1_B_Median,
                              Sample_157$Ch1_B_Median,Sample_158$Ch1_B_Median,
                              Sample_159$Ch1_B_Median,Sample_160$Ch1_B_Median,
                              Sample_161$Ch1_B_Median,Sample_162$Ch1_B_Median,
                              Sample_163$Ch1_B_Median,Sample_164$Ch1_B_Median,
                              Sample_165$Ch1_B_Median,Sample_166$Ch1_B_Median,
                              Sample_167$Ch1_B_Median,Sample_168$Ch1_B_Median,
                              Sample_169$Ch1_B_Median,Sample_170$Ch1_B_Median,
                              Sample_171$Ch1_B_Median,Sample_172$Ch1_B_Median,
                              Sample_173$Ch1_B_Median,Sample_174$Ch1_B_Median,
                              Sample_175$Ch1_B_Median,Sample_176$Ch1_B_Median,
                              Sample_177$Ch1_B_Median,Sample_178$Ch1_B_Median,
                              Sample_179$Ch1_B_Median,Sample_180$Ch1_B_Median,
                              Sample_181$Ch1_B_Median,Sample_182$Ch1_B_Median,
                              Sample_183$Ch1_B_Median,Sample_184$Ch1_B_Median,
                              Sample_185$Ch1_B_Median,Sample_186$Ch1_B_Median,
                              Sample_187$Ch1_B_Median,Sample_188$Ch1_B_Median,
                              Sample_189$Ch1_B_Median,Sample_190$Ch1_B_Median,
                              Sample_191$Ch1_B_Median,Sample_192$Ch1_B_Median,
                              Sample_193$Ch1_B_Median,Sample_194$Ch1_B_Median,
                              Sample_195$Ch1_B_Median,Sample_196$Ch1_B_Median,
                              Sample_197$Ch1_B_Median,Sample_198$Ch1_B_Median,
                              Sample_199$Ch1_B_Median,Sample_200$Ch1_B_Median,
                              Sample_201$Ch1_B_Median,Sample_202$Ch1_B_Median,
                              Sample_203$Ch1_B_Median,Sample_204$Ch1_B_Median,
                              Sample_205$Ch1_B_Median,Sample_206$Ch1_B_Median,
                              Sample_207$Ch1_B_Median,Sample_208$Ch1_B_Median,
                              Sample_209$Ch1_B_Median,Sample_210$Ch1_B_Median,
                              Sample_211$Ch1_B_Median,Sample_212$Ch1_B_Median,
                              Sample_213$Ch1_B_Median,Sample_214$Ch1_B_Median,
                              Sample_215$Ch1_B_Median,Sample_216$Ch1_B_Median,
                              Sample_217$Ch1_B_Median,Sample_218$Ch1_B_Median,
                              Sample_219$Ch1_B_Median,Sample_220$Ch1_B_Median,
                              Sample_221$Ch1_B_Median,Sample_222$Ch1_B_Median,
                              Sample_223$Ch1_B_Median,Sample_224$Ch1_B_Median,
                              Sample_225$Ch1_B_Median,Sample_226$Ch1_B_Median,
                              Sample_227$Ch1_B_Median,Sample_228$Ch1_B_Median,
                              Sample_229$Ch1_B_Median,Sample_230$Ch1_B_Median,
                              Sample_231$Ch1_B_Median,Sample_232$Ch1_B_Median,
                              Sample_233$Ch1_B_Median,Sample_234$Ch1_B_Median,
                              Sample_235$Ch1_B_Median,Sample_236$Ch1_B_Median,
                              Sample_237$Ch1_B_Median,Sample_238$Ch1_B_Median,
                              Sample_239$Ch1_B_Median,Sample_240$Ch1_B_Median,
                              Sample_241$Ch1_B_Median,Sample_242$Ch1_B_Median,
                              Sample_243$Ch1_B_Median,Sample_244$Ch1_B_Median,
                              Sample_245$Ch1_B_Median,Sample_246$Ch1_B_Median,
                              Sample_247$Ch1_B_Median,Sample_248$Ch1_B_Median,
                              Sample_249$Ch1_B_Median,Sample_250$Ch1_B_Median,
                              Sample_251$Ch1_B_Median,Sample_252$Ch1_B_Median,
                              Sample_253$Ch1_B_Median,Sample_254$Ch1_B_Median,
                              Sample_255$Ch1_B_Median,Sample_256$Ch1_B_Median,
                              Sample_257$Ch1_B_Median,Sample_258$Ch1_B_Median,
                              Sample_259$Ch1_B_Median,Sample_260$Ch1_B_Median,
                              Sample_261$Ch1_B_Median,Sample_262$Ch1_B_Median,
                              Sample_263$Ch1_B_Median,Sample_264$Ch1_B_Median,
                              Sample_265$Ch1_B_Median,Sample_266$Ch1_B_Median,
                              Sample_267$Ch1_B_Median,Sample_268$Ch1_B_Median,
                              Sample_269$Ch1_B_Median,Sample_270$Ch1_B_Median,
                              Sample_271$Ch1_B_Median,Sample_272$Ch1_B_Median,
                              Sample_273$Ch1_B_Median,Sample_274$Ch1_B_Median,
                              Sample_275$Ch1_B_Median,Sample_276$Ch1_B_Median,
                              Sample_277$Ch1_B_Median,Sample_278$Ch1_B_Median,
                              Sample_279$Ch1_B_Median,Sample_280$Ch1_B_Median,
                              Sample_281$Ch1_B_Median,Sample_282$Ch1_B_Median,
                              Sample_283$Ch1_B_Median,Sample_284$Ch1_B_Median,
                              Sample_285$Ch1_B_Median,Sample_286$Ch1_B_Median,
                              Sample_287$Ch1_B_Median,Sample_288$Ch1_B_Median,
                              Sample_289$Ch1_B_Median,Sample_290$Ch1_B_Median,
                              Sample_291$Ch1_B_Median,Sample_292$Ch1_B_Median,
                              Sample_293$Ch1_B_Median,Sample_294$Ch1_B_Median,
                              Sample_295$Ch1_B_Median,Sample_296$Ch1_B_Median,
                              Sample_297$Ch1_B_Median,Sample_298$Ch1_B_Median,
                              Sample_299$Ch1_B_Median,Sample_300$Ch1_B_Median,
                              Sample_301$Ch1_B_Median,Sample_302$Ch1_B_Median,
                              Sample_303$Ch1_B_Median,Sample_304$Ch1_B_Median,
                              Sample_305$Ch1_B_Median,Sample_306$Ch1_B_Median,
                              Sample_307$Ch1_B_Median,Sample_308$Ch1_B_Median,
                              Sample_309$Ch1_B_Median,Sample_310$Ch1_B_Median,
                              Sample_311$Ch1_B_Median,Sample_312$Ch1_B_Median,
                              Sample_313$Ch1_B_Median,Sample_314$Ch1_B_Median,
                              Sample_315$Ch1_B_Median,Sample_316$Ch1_B_Median,
                              Sample_317$Ch1_B_Median,Sample_318$Ch1_B_Median,
                              Sample_319$Ch1_B_Median,Sample_320$Ch1_B_Median,
                              Sample_321$Ch1_B_Median,Sample_322$Ch1_B_Median,
                              Sample_323$Ch1_B_Median,Sample_324$Ch1_B_Median,
                              Sample_325$Ch1_B_Median,Sample_326$Ch1_B_Median,
                              Sample_327$Ch1_B_Median,Sample_328$Ch1_B_Median,
                              Sample_329$Ch1_B_Median,Sample_330$Ch1_B_Median,
                              Sample_331$Ch1_B_Median,Sample_332$Ch1_B_Median,
                              Sample_333$Ch1_B_Median,Sample_334$Ch1_B_Median,
                              Sample_335$Ch1_B_Median,Sample_336$Ch1_B_Median,
                              Sample_337$Ch1_B_Median,Sample_338$Ch1_B_Median,
                              Sample_339$Ch1_B_Median,Sample_340$Ch1_B_Median,
                              Sample_341$Ch1_B_Median,Sample_342$Ch1_B_Median,
                              Sample_343$Ch1_B_Median,Sample_344$Ch1_B_Median,
                              Sample_345$Ch1_B_Median,Sample_346$Ch1_B_Median,
                              Sample_347$Ch1_B_Median,Sample_348$Ch1_B_Median,
                              Sample_349$Ch1_B_Median,Sample_350$Ch1_B_Median,
                              Sample_351$Ch1_B_Median,Sample_352$Ch1_B_Median,
                              Sample_353$Ch1_B_Median,Sample_354$Ch1_B_Median,
                              Sample_355$Ch1_B_Median,Sample_356$Ch1_B_Median,
                              Sample_357$Ch1_B_Median,Sample_358$Ch1_B_Median,
                              Sample_359$Ch1_B_Median,Sample_360$Ch1_B_Median,
                              Sample_361$Ch1_B_Median,Sample_362$Ch1_B_Median,
                              Sample_363$Ch1_B_Median,Sample_364$Ch1_B_Median,
                              Sample_365$Ch1_B_Median,Sample_366$Ch1_B_Median,
                              Sample_367$Ch1_B_Median,Sample_368$Ch1_B_Median,
                              Sample_369$Ch1_B_Median,Sample_370$Ch1_B_Median,
                              Sample_371$Ch1_B_Median,Sample_372$Ch1_B_Median,
                              Sample_373$Ch1_B_Median,Sample_374$Ch1_B_Median,
                              Sample_375$Ch1_B_Median,Sample_376$Ch1_B_Median,
                              Sample_377$Ch1_B_Median,Sample_378$Ch1_B_Median,
                              Sample_379$Ch1_B_Median,Sample_380$Ch1_B_Median,
                              Sample_381$Ch1_B_Median,Sample_382$Ch1_B_Median,
                              Sample_383$Ch1_B_Median,Sample_384$Ch1_B_Median,
                              Sample_385$Ch1_B_Median,Sample_386$Ch1_B_Median,
                              Sample_387$Ch1_B_Median,Sample_388$Ch1_B_Median,
                              Sample_389$Ch1_B_Median,Sample_390$Ch1_B_Median,
                              Sample_391$Ch1_B_Median,Sample_392$Ch1_B_Median,
                              Sample_393$Ch1_B_Median,Sample_394$Ch1_B_Median,
                              Sample_395$Ch1_B_Median,Sample_396$Ch1_B_Median,
                              Sample_397$Ch1_B_Median,Sample_398$Ch1_B_Median,
                              Sample_399$Ch1_B_Median,Sample_400$Ch1_B_Median,
                              Sample_401$Ch1_B_Median,Sample_402$Ch1_B_Median,
                              Sample_403$Ch1_B_Median,Sample_404$Ch1_B_Median,
                              Sample_405$Ch1_B_Median,Sample_406$Ch1_B_Median,
                              Sample_407$Ch1_B_Median,Sample_408$Ch1_B_Median,
                              Sample_409$Ch1_B_Median,Sample_410$Ch1_B_Median,
                              Sample_411$Ch1_B_Median,Sample_412$Ch1_B_Median,
                              Sample_413$Ch1_B_Median,Sample_414$Ch1_B_Median,
                              Sample_415$Ch1_B_Median,Sample_416$Ch1_B_Median,
                              Sample_417$Ch1_B_Median,Sample_418$Ch1_B_Median,
                              Sample_419$Ch1_B_Median,Sample_420$Ch1_B_Median,
                              Sample_421$Ch1_B_Median,Sample_422$Ch1_B_Median,
                              Sample_423$Ch1_B_Median,Sample_424$Ch1_B_Median,
                              Sample_425$Ch1_B_Median,Sample_426$Ch1_B_Median,
                              Sample_427$Ch1_B_Median,Sample_428$Ch1_B_Median,
                              Sample_429$Ch1_B_Median,Sample_430$Ch1_B_Median,
                              Sample_431$Ch1_B_Median,Sample_432$Ch1_B_Median,
                              Sample_433$Ch1_B_Median,Sample_434$Ch1_B_Median,
                              Sample_435$Ch1_B_Median,Sample_436$Ch1_B_Median,
                              Sample_437$Ch1_B_Median,Sample_438$Ch1_B_Median,
                              Sample_439$Ch1_B_Median,Sample_440$Ch1_B_Median,
                              Sample_441$Ch1_B_Median,Sample_442$Ch1_B_Median,
                              Sample_443$Ch1_B_Median,Sample_444$Ch1_B_Median,
                              Sample_445$Ch1_B_Median,Sample_446$Ch1_B_Median,
                              Sample_447$Ch1_B_Median,Sample_448$Ch1_B_Median,
                              Sample_449$Ch1_B_Median,Sample_450$Ch1_B_Median,
                              Sample_451$Ch1_B_Median,Sample_452$Ch1_B_Median,
                              Sample_453$Ch1_B_Median,Sample_454$Ch1_B_Median,
                              Sample_455$Ch1_B_Median,Sample_456$Ch1_B_Median,
                              Sample_457$Ch1_B_Median,Sample_458$Ch1_B_Median,
                              Sample_459$Ch1_B_Median,Sample_460$Ch1_B_Median,
                              Sample_461$Ch1_B_Median,Sample_462$Ch1_B_Median,
                              Sample_463$Ch1_B_Median,Sample_464$Ch1_B_Median,
                              Sample_465$Ch1_B_Median,Sample_466$Ch1_B_Median,
                              Sample_467$Ch1_B_Median,Sample_468$Ch1_B_Median,
                              Sample_469$Ch1_B_Median,Sample_470$Ch1_B_Median,
                              Sample_471$Ch1_B_Median,Sample_472$Ch1_B_Median,
                              Sample_473$Ch1_B_Median,Sample_474$Ch1_B_Median,
                              Sample_475$Ch1_B_Median,Sample_476$Ch1_B_Median,
                              Sample_477$Ch1_B_Median,Sample_478$Ch1_B_Median,
                              Sample_479$Ch1_B_Median,Sample_480$Ch1_B_Median,
                              Sample_481$Ch1_B_Median,Sample_482$Ch1_B_Median,
                              Sample_483$Ch1_B_Median,Sample_484$Ch1_B_Median,
                              Sample_485$Ch1_B_Median,Sample_486$Ch1_B_Median,
                              Sample_487$Ch1_B_Median,Sample_488$Ch1_B_Median,
                              Sample_489$Ch1_B_Median,Sample_490$Ch1_B_Median,
                              Sample_491$Ch1_B_Median,Sample_492$Ch1_B_Median,
                              Sample_493$Ch1_B_Median,Sample_494$Ch1_B_Median,
                              Sample_495$Ch1_B_Median,Sample_496$Ch1_B_Median,
                              Sample_497$Ch1_B_Median,Sample_498$Ch1_B_Median,
                              Sample_499$Ch1_B_Median,Sample_500$Ch1_B_Median,
                              Sample_501$Ch1_B_Median,Sample_502$Ch1_B_Median,
                              Sample_503$Ch1_B_Median,Sample_504$Ch1_B_Median))
fg_vals_numeric<- apply(fg_vals,2,as.numeric)
bg_vals_numeric<- apply(bg_vals,2,as.numeric)

ratio_matrix<- (fg_vals_numeric)/(bg_vals_numeric)

log_ratio_matrix<- log(ratio_matrix)

```

```{r, cache=T, message=F, warning=F, echo=F, results='hide'}
box_cox_matrix<- matrix(NA, nrow=nrow(ratio_matrix), ncol=ncol(ratio_matrix))
box_cox_lambdas<- rep(NA,ncol(ratio_matrix))

for(i in 1:ncol(box_cox_matrix)){
  boxcox_result<- boxcox(ratio_matrix[,i],optimize=T)
  box_cox_matrix[,i]<- boxcox_result$data
  box_cox_lambdas[i]<- boxcox_result$lambda
}


```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}

density_df<- as.data.frame(cbind(c(as.vector(ratio_matrix),as.vector(log_ratio_matrix)),c(rep("Raw",length(as.vector(ratio_matrix))),rep("Log",length(as.vector(log_ratio_matrix))))))

colnames(density_df)<- c("Fluorescent_Intensity","Transformation")
density_df$Fluorescent_Intensity<- as.numeric(density_df$Fluorescent_Intensity)
density_df$Transformation<- as.factor(density_df$Transformation)

ICEMR_densities<- ggplot(density_df,aes(x=Fluorescent_Intensity,color=Transformation))+
  geom_density()+
  labs(x="Fluorescent Intensity", title="Density of Fluorescent Intensities on Malaria Arrays")+xlim(0,20)

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
#within array measurement agreement

  freq_df<- data.frame(table(Sample_1$ID))
  
  freq_df<- freq_df%>%
    filter(Freq>1)
  
  duplicated_probes<- freq_df$Var1 
  
  #how many probes of each? 
  
  length(which(Sample_1$ID==""|Sample_1$ID=="Blank"|Sample_1$ID=="blank"))
  length(which(Sample_1$ID=="a-human IgG 0.003"))
  length(which(Sample_1$ID=="a-human IgG 0.03"))
  length(which(Sample_1$ID=="a-human IgG 0.3"))
  length(which(Sample_1$ID=="IgG mix 0.003"))
  length(which(Sample_1$ID=="IgG mix 0.03"))
  length(which(Sample_1$ID=="IgG mix 0.3"))
  length(which(Sample_1$ID=="PVX_003775_2o2"))
  length(which(Sample_1$ID=="a-human IgG 0.001"))
  length(which(Sample_1$ID=="a-human IgG 0.01"))
  length(which(Sample_1$ID=="a-human IgG 0.1"))
  length(which(Sample_1$ID=="IgG mix 0.001"))
  length(which(Sample_1$ID=="IgG mix 0.01"))
  length(which(Sample_1$ID=="IgG mix 0.1"))
  length(which(Sample_1$ID=="no DNA Control plate"))
  length(which(Sample_1$ID=="TTBS"))
  
#all pairwise combinations
get_pairwise_combinations<- function(Sample,corrected_sample,dup_probes){
  #start with blank probes
  index_blank<-which(Sample$ID==""|Sample$ID=="Blank"|Sample$ID=="blank")
  index_a_human_0.003<- which(Sample$ID=="a-human IgG 0.003")
  index_a_human_0.03<- which(Sample$ID=="a-human IgG 0.03")
  index_a_human_0.3<- which(Sample$ID=="a-human IgG 0.3")
  index_mix_0.003<- which(Sample$ID=="IgG mix 0.003")
  index_mix_0.03<- which(Sample$ID=="IgG mix 0.03")
  index_mix_0.3<- which(Sample$ID=="IgG mix 0.3")
  index_pvx<- which(Sample$ID=="PVX_003775_2o2")
  index_a_human_0.001<- which(Sample$ID=="a-human IgG 0.001")
  index_a_human_0.01<- which(Sample$ID=="a-human IgG 0.01")
  index_a_human_0.1<- which(Sample$ID=="a-human IgG 0.1")
  index_mix_0.001<- which(Sample$ID=="IgG mix 0.001")
  index_mix_0.01<- which(Sample$ID=="IgG mix 0.01")
  index_mix_0.1<- which(Sample$ID=="IgG mix 0.1")
  index_noDNA<- which(Sample$ID=="no DNA Control plate")
  index_ttbs<- which(Sample$ID=="TTBS")
  
  combn_blank<-combn(index_blank,2)
  combn_a_human_0.003<- combn(index_a_human_0.003,2)
  combn_a_human_0.03<- combn(index_a_human_0.03,2)
  combn_a_human_0.3<- combn(index_a_human_0.3,2)
  combn_mix_0.003<- combn(index_mix_0.003,2)
  combn_mix_0.03<- combn(index_mix_0.03,2)
  combn_mix_0.3<- combn(index_mix_0.3,2)
  combn_pvx<- combn(index_pvx,2)
  combn_a_human_0.001<- combn(index_a_human_0.001,2)
  combn_a_human_0.01<- combn(index_a_human_0.01,2)
  combn_a_human_0.1<- combn(index_a_human_0.1,2)
  combn_mix_0.001<- combn(index_mix_0.001,2)
  combn_mix_0.01<- combn(index_mix_0.01,2)
  combn_mix_0.1<- combn(index_mix_0.1,2)
  combn_noDNA<- combn(index_noDNA,2)
  combn_ttbs<- combn(index_ttbs,2)

  
  ratio_blank<- as.data.frame(rbind(corrected_sample[combn_blank[1,]],corrected_sample[combn_blank[2,]]))
    ratio_a_human_0.003<- as.data.frame(rbind(corrected_sample[combn_a_human_0.003[1,]],corrected_sample[combn_a_human_0.003[2,]]))
    ratio_a_human_0.03<- as.data.frame(rbind(corrected_sample[combn_a_human_0.03[1,]],corrected_sample[combn_a_human_0.03[2,]]))
    ratio_a_human_0.3<- as.data.frame(rbind(corrected_sample[combn_a_human_0.3[1,]],corrected_sample[combn_a_human_0.3[2,]]))
  ratio_mix_0.003<- as.data.frame(rbind(corrected_sample[combn_mix_0.003[1,]],corrected_sample[combn_mix_0.003[2,]]))
  ratio_mix_0.03<- as.data.frame(rbind(corrected_sample[combn_mix_0.03[1,]],corrected_sample[combn_mix_0.03[2,]]))
  ratio_mix_0.3<- as.data.frame(rbind(corrected_sample[combn_mix_0.3[1,]],corrected_sample[combn_mix_0.3[2,]]))
  ratio_pvx<- as.data.frame(rbind(corrected_sample[combn_pvx[1,]],corrected_sample[combn_pvx[2,]]))
  ratio_a_human_0.001<- as.data.frame(rbind(corrected_sample[combn_a_human_0.001[1,]],corrected_sample[combn_a_human_0.001[2,]]))
  ratio_a_human_0.01<- as.data.frame(rbind(corrected_sample[combn_a_human_0.01[1,]],corrected_sample[combn_a_human_0.01[2,]]))
  ratio_a_human_0.1<- as.data.frame(rbind(corrected_sample[combn_a_human_0.1[1,]],corrected_sample[combn_a_human_0.1[2,]]))
  ratio_mix_0.001<- as.data.frame(rbind(corrected_sample[combn_mix_0.001[1,]],corrected_sample[combn_mix_0.001[2,]]))
  ratio_mix_0.01<- as.data.frame(rbind(corrected_sample[combn_mix_0.01[1,]],corrected_sample[combn_mix_0.01[2,]]))
  ratio_mix_0.1<- as.data.frame(rbind(corrected_sample[combn_mix_0.1[1,]],corrected_sample[combn_mix_0.1[2,]]))
  ratio_noDNA<- as.data.frame(rbind(corrected_sample[combn_noDNA[1,]],corrected_sample[combn_noDNA[2,]]))
  ratio_ttbs<- as.data.frame(rbind(corrected_sample[combn_ttbs[1,]],corrected_sample[combn_ttbs[2,]]))
  
  ratio_duplicated_probes<- as.data.frame(cbind(ratio_blank,ratio_a_human_0.003,ratio_a_human_0.03,ratio_a_human_0.3,ratio_mix_0.003,ratio_mix_0.03,ratio_mix_0.3,ratio_pvx,ratio_a_human_0.001,ratio_a_human_0.01,ratio_a_human_0.1,ratio_mix_0.001,ratio_mix_0.01,ratio_mix_0.1,ratio_noDNA,ratio_ttbs))
  
  return(ratio_duplicated_probes)
  
}  



##########################
Sample_333_duplicate_pairs_log<- get_pairwise_combinations(Sample_333,log_ratio_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_log,2,mean)
D_S_333<- Sample_333_duplicate_pairs_log[1,]-Sample_333_duplicate_pairs_log[2,]


X_S_333<- M_S_333
Y_S_333<- unlist(D_S_333)

Sample_333_df_log<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_log)<- c('log_mean','dif_over_sum')


sample_333_log<- ggplot(Sample_333_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log Values",y="Difference of Log ")
######################

Sample_43_duplicate_pairs_log<- get_pairwise_combinations(Sample_43,log_ratio_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_log,2,mean)
D_S_43<- Sample_43_duplicate_pairs_log[1,]-Sample_43_duplicate_pairs_log[2,]  


X_S_43<- M_S_43
Y_S_43<- unlist(D_S_43)

Sample_43_df_log<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_log)<- c('log_mean','dif_over_sum')


sample_43_log<- ggplot(Sample_43_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log Values",y="Difference of Log Values")

##################

Sample_504_duplicate_pairs_log<- get_pairwise_combinations(Sample_504,log_ratio_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_log,2,mean)
D_S_504<- Sample_504_duplicate_pairs_log[1,]-Sample_504_duplicate_pairs_log[2,]  


X_S_504<- M_S_504
Y_S_504<- unlist(D_S_504)

Sample_504_df_log<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_log)<- c('log_mean','dif_over_sum')


sample_504_log<- ggplot(Sample_504_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log Values",y="Difference of Log Values")

ICEMR_within_log_df<- as.data.frame(cbind(rbind(Sample_333_df_log,Sample_43_df_log,Sample_504_df_log),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_log_df)<- c("log_mean",'dif_over_sum','Array')

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
## between array plots
M_S_498_500<- (log_ratio_matrix[,498]+log_ratio_matrix[,500])/2
D_S_498_500<- (log_ratio_matrix[,498]-log_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df)<- c('log_mean','dif_over_sum')


sample_498_500_log<- ggplot(Sample_498_500_df,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log Values",y="Difference of Log Values")

#########################

M_S_498_504<- (log_ratio_matrix[,498]+log_ratio_matrix[,504])/2
D_S_498_504<- (log_ratio_matrix[,498]-log_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df)<- c('log_mean','dif_over_sum')


sample_498_504_log<- ggplot(Sample_498_504_df,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log Values",y="Difference of Log Values")

#############################
M_S_500_504<- (log_ratio_matrix[,500]+log_ratio_matrix[,504])/2
D_S_500_504<- (log_ratio_matrix[,500]-log_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df)<- c('log_mean','dif_over_sum')


sample_500_504_log<- ggplot(Sample_500_504_df,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log Values",y="Difference of Log Values")


ICEMR_between_log_df<- as.data.frame(cbind(rbind(Sample_498_500_df,Sample_498_504_df,Sample_500_504_df),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_log_df)<- c("log_mean",'dif','Array')


```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
index_ctrls<-which(Sample_1$ID==""|Sample_1$ID=="Blank"|Sample_1$ID=="blank"|Sample_1$ID=="a-human IgG 0.003"|Sample_1$ID=="a-human IgG 0.03"|Sample_1$ID=="a-human IgG 0.3"|Sample_1$ID=="IgG mix 0.003"|Sample_1$ID=="IgG mix 0.03"|Sample_1$ID=="IgG mix 0.3"|Sample_1$ID=="PVX_003775_2o2"|Sample_1$ID=="a-human IgG 0.001"|Sample_1$ID=="a-human IgG 0.01"|Sample_1$ID=="a-human IgG 0.1"|Sample_1$ID=="IgG mix 0.001"|Sample_1$ID=="IgG mix 0.01"|Sample_1$ID=="IgG mix 0.1"|Sample_1$ID=="no DNA Control plate"|Sample_1$ID=="TTBS")

length(index_ctrls)

#design matrix: 

slide_matrix<- matrix(0, nrow=(120*504),ncol=62)

for(i in 2:63){
  slide_matrix[((120*(8*(i-1)))+1):(120*8*(i)),(i-1)]<-1
}

subarray_matrix<- matrix(0,nrow=(120*504),ncol=7)

subarray_matrix[,1]<- rep(c(rep(0,120),rep(1,120),rep(0,(120*6))),times=63)
subarray_matrix[,2]<- rep(c(rep(0,(120*2)),rep(1,120),rep(0,(120*5))),times=63)
subarray_matrix[,3]<- rep(c(rep(0,(120*3)),rep(1,120),rep(0,(120*4))),times=63)
subarray_matrix[,4]<- rep(c(rep(0,(120*4)),rep(1,120),rep(0,(120*3))),times=63)
subarray_matrix[,5]<- rep(c(rep(0,(120*5)),rep(1,120),rep(0,(120*2))),times=63)
subarray_matrix[,6]<- rep(c(rep(0,(120*6)),rep(1,120),rep(0,(120*1))),times=63)
subarray_matrix[,7]<- rep(c(rep(0,(120*7)),rep(1,120)),times=63)


##################
Sample_1_ctrl<- Sample_1[index_ctrls,]

spot_names<- as.data.frame(table(Sample_1_ctrl$Name))

spot_names<- spot_names%>%
  mutate(index=rep(1:19))

spot_index<- rep(NA,120)


for(i in 1:length(spot_index)){
  spot_index[i]<- spot_names$index[which(Sample_1_ctrl$Name[i]==spot_names$Var1)]
}

spot_indices<- rep(spot_index,times=504)




spot_matrix<- matrix(0,nrow=120*504,ncol=18)

for(i in 1:nrow(spot_matrix)){
  if(spot_indices[i]>1){
  spot_matrix[i,(spot_indices[i]-1)]<-1
  }
}

#################
#design matrix
#################

design_matrix_ICEMR<- as.data.frame(cbind(as.vector(log_ratio_matrix[index_ctrls,]),slide_matrix,subarray_matrix,spot_matrix))

design_matrix_boxcox<- as.data.frame(cbind(as.vector(box_cox_matrix[index_ctrls,]),slide_matrix,subarray_matrix,spot_matrix))

model_ICEMR_logs<- rlm(V1~.,design_matrix_ICEMR)

model_ICEMR_boxcox<- rlm(V1~.,design_matrix_boxcox)
############################################################################
#Remove duplicate pairs of x,y in model, these will be rows that are EXACT duplicates of themselves in the design matrix
##########################################################################




corrected_log_matrix<- matrix(NA,nrow=1156,ncol=504)

#subtract off array level intercept and sub-array level intercept from everyone
  corrected_log_matrix<- log_ratio_matrix-model_ICEMR_logs$coefficients[1]

#subtract of each array effect
for(i in 2:63){
  corrected_log_matrix[,(((8*(i-1))+1):(8*i))]<- corrected_log_matrix[,(((8*(i-1))+1):(8*i))]-model_ICEMR_logs$coefficients[i]
}
  

#subtract off sub-array level intercept from everyone
for(i in 1:63){
  for(j in 2:8){
    corrected_log_matrix[,(((8*(i-1))+j))]<- corrected_log_matrix[,(((8*(i-1))+j))]-model_ICEMR_logs$coefficients[(62+j)]
  }
}
 
  
######################################################################
  

corrected_boxcox_matrix<- matrix(NA,nrow=1156,ncol=504)

#subtract off array level intercept and sub-array level intercept from everyone
  corrected_boxcox_matrix<- box_cox_matrix-model_ICEMR_boxcox$coefficients[1]

#subtract of each array effect
for(i in 2:63){
  corrected_boxcox_matrix[,(((8*(i-1))+1):(8*i))]<- corrected_boxcox_matrix[,(((8*(i-1))+1):(8*i))]-model_ICEMR_boxcox$coefficients[i]
}
  

#subtract off sub-array level intercept from everyone
for(i in 1:63){
  for(j in 2:8){
    corrected_boxcox_matrix[,(((8*(i-1))+j))]<- corrected_boxcox_matrix[,(((8*(i-1))+j))]-model_ICEMR_boxcox$coefficients[(62+j)]
  }
}
  
  
  
```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
#within array measurement agreement

  freq_df<- data.frame(table(Sample_1$ID))
  
  freq_df<- freq_df%>%
    filter(Freq>1)
  
  duplicated_probes<- freq_df$Var1 
  
  #how many probes of each? 
  
  length(which(Sample_1$ID==""|Sample_1$ID=="Blank"|Sample_1$ID=="blank"))
  length(which(Sample_1$ID=="a-human IgG 0.003"))
  length(which(Sample_1$ID=="a-human IgG 0.03"))
  length(which(Sample_1$ID=="a-human IgG 0.3"))
  length(which(Sample_1$ID=="IgG mix 0.003"))
  length(which(Sample_1$ID=="IgG mix 0.03"))
  length(which(Sample_1$ID=="IgG mix 0.3"))
  length(which(Sample_1$ID=="PVX_003775_2o2"))
  length(which(Sample_1$ID=="a-human IgG 0.001"))
  length(which(Sample_1$ID=="a-human IgG 0.01"))
  length(which(Sample_1$ID=="a-human IgG 0.1"))
  length(which(Sample_1$ID=="IgG mix 0.001"))
  length(which(Sample_1$ID=="IgG mix 0.01"))
  length(which(Sample_1$ID=="IgG mix 0.1"))
  length(which(Sample_1$ID=="no DNA Control plate"))
  length(which(Sample_1$ID=="TTBS"))
  
#all pairwise combinations
get_pairwise_combinations<- function(Sample,corrected_sample,dup_probes){
  #start with blank probes
  index_blank<-which(Sample$ID==""|Sample$ID=="Blank"|Sample$ID=="blank")
  index_a_human_0.003<- which(Sample$ID=="a-human IgG 0.003")
  index_a_human_0.03<- which(Sample$ID=="a-human IgG 0.03")
  index_a_human_0.3<- which(Sample$ID=="a-human IgG 0.3")
  index_mix_0.003<- which(Sample$ID=="IgG mix 0.003")
  index_mix_0.03<- which(Sample$ID=="IgG mix 0.03")
  index_mix_0.3<- which(Sample$ID=="IgG mix 0.3")
  index_pvx<- which(Sample$ID=="PVX_003775_2o2")
  index_a_human_0.001<- which(Sample$ID=="a-human IgG 0.001")
  index_a_human_0.01<- which(Sample$ID=="a-human IgG 0.01")
  index_a_human_0.1<- which(Sample$ID=="a-human IgG 0.1")
  index_mix_0.001<- which(Sample$ID=="IgG mix 0.001")
  index_mix_0.01<- which(Sample$ID=="IgG mix 0.01")
  index_mix_0.1<- which(Sample$ID=="IgG mix 0.1")
  index_noDNA<- which(Sample$ID=="no DNA Control plate")
  index_ttbs<- which(Sample$ID=="TTBS")
  
  combn_blank<-combn(index_blank,2)
  combn_a_human_0.003<- combn(index_a_human_0.003,2)
  combn_a_human_0.03<- combn(index_a_human_0.03,2)
  combn_a_human_0.3<- combn(index_a_human_0.3,2)
  combn_mix_0.003<- combn(index_mix_0.003,2)
  combn_mix_0.03<- combn(index_mix_0.03,2)
  combn_mix_0.3<- combn(index_mix_0.3,2)
  combn_pvx<- combn(index_pvx,2)
  combn_a_human_0.001<- combn(index_a_human_0.001,2)
  combn_a_human_0.01<- combn(index_a_human_0.01,2)
  combn_a_human_0.1<- combn(index_a_human_0.1,2)
  combn_mix_0.001<- combn(index_mix_0.001,2)
  combn_mix_0.01<- combn(index_mix_0.01,2)
  combn_mix_0.1<- combn(index_mix_0.1,2)
  combn_noDNA<- combn(index_noDNA,2)
  combn_ttbs<- combn(index_ttbs,2)

  
  ratio_blank<- as.data.frame(rbind(corrected_sample[combn_blank[1,]],corrected_sample[combn_blank[2,]]))
    ratio_a_human_0.003<- as.data.frame(rbind(corrected_sample[combn_a_human_0.003[1,]],corrected_sample[combn_a_human_0.003[2,]]))
    ratio_a_human_0.03<- as.data.frame(rbind(corrected_sample[combn_a_human_0.03[1,]],corrected_sample[combn_a_human_0.03[2,]]))
    ratio_a_human_0.3<- as.data.frame(rbind(corrected_sample[combn_a_human_0.3[1,]],corrected_sample[combn_a_human_0.3[2,]]))
  ratio_mix_0.003<- as.data.frame(rbind(corrected_sample[combn_mix_0.003[1,]],corrected_sample[combn_mix_0.003[2,]]))
  ratio_mix_0.03<- as.data.frame(rbind(corrected_sample[combn_mix_0.03[1,]],corrected_sample[combn_mix_0.03[2,]]))
  ratio_mix_0.3<- as.data.frame(rbind(corrected_sample[combn_mix_0.3[1,]],corrected_sample[combn_mix_0.3[2,]]))
  ratio_pvx<- as.data.frame(rbind(corrected_sample[combn_pvx[1,]],corrected_sample[combn_pvx[2,]]))
  ratio_a_human_0.001<- as.data.frame(rbind(corrected_sample[combn_a_human_0.001[1,]],corrected_sample[combn_a_human_0.001[2,]]))
  ratio_a_human_0.01<- as.data.frame(rbind(corrected_sample[combn_a_human_0.01[1,]],corrected_sample[combn_a_human_0.01[2,]]))
  ratio_a_human_0.1<- as.data.frame(rbind(corrected_sample[combn_a_human_0.1[1,]],corrected_sample[combn_a_human_0.1[2,]]))
  ratio_mix_0.001<- as.data.frame(rbind(corrected_sample[combn_mix_0.001[1,]],corrected_sample[combn_mix_0.001[2,]]))
  ratio_mix_0.01<- as.data.frame(rbind(corrected_sample[combn_mix_0.01[1,]],corrected_sample[combn_mix_0.01[2,]]))
  ratio_mix_0.1<- as.data.frame(rbind(corrected_sample[combn_mix_0.1[1,]],corrected_sample[combn_mix_0.1[2,]]))
  ratio_noDNA<- as.data.frame(rbind(corrected_sample[combn_noDNA[1,]],corrected_sample[combn_noDNA[2,]]))
  ratio_ttbs<- as.data.frame(rbind(corrected_sample[combn_ttbs[1,]],corrected_sample[combn_ttbs[2,]]))
  
  ratio_duplicated_probes<- as.data.frame(cbind(ratio_blank,ratio_a_human_0.003,ratio_a_human_0.03,ratio_a_human_0.3,ratio_mix_0.003,ratio_mix_0.03,ratio_mix_0.3,ratio_pvx,ratio_a_human_0.001,ratio_a_human_0.01,ratio_a_human_0.1,ratio_mix_0.001,ratio_mix_0.01,ratio_mix_0.1,ratio_noDNA,ratio_ttbs))
  
  return(ratio_duplicated_probes)
  
}  



##########################
Sample_333_duplicate_pairs_log_rlm<- get_pairwise_combinations(Sample_333,corrected_log_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_log_rlm,2,mean)
D_S_333<- Sample_333_duplicate_pairs_log_rlm[1,]-Sample_333_duplicate_pairs_log_rlm[2,]  


X_S_333<- M_S_333
Y_S_333<- abs(unlist(D_S_333))

Sample_333_df_rlm<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_rlm)<- c('log_mean','dif_over_sum')


sample_333_rlm<- ggplot(Sample_333_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")
#############################################################################
Sample_333_duplicate_pairs_boxcox_rlm<- get_pairwise_combinations(Sample_333,corrected_boxcox_matrix[,333],duplicated_probes)



M_S_333BC<- apply(Sample_333_duplicate_pairs_boxcox_rlm,2,mean)
D_S_333BC<- Sample_333_duplicate_pairs_boxcox_rlm[1,]-Sample_333_duplicate_pairs_boxcox_rlm[2,]  


X_S_333BC<- M_S_333BC
Y_S_333BC<- abs(unlist(D_S_333BC))

Sample_333_df_rlm_BC<- as.data.frame(cbind(X_S_333BC,Y_S_333BC))
colnames(Sample_333_df_rlm_BC)<- c('log_mean','dif_over_sum')


sample_333_rlm_BC<- ggplot(Sample_333_df_rlm_BC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Box Cox RLM Corrected",y="Difference of Box Cox RLM Corrected")
######################

Sample_43_duplicate_pairs_log_rlm<- get_pairwise_combinations(Sample_43,corrected_log_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_log_rlm,2,mean)
D_S_43<- Sample_43_duplicate_pairs_log_rlm[1,]-Sample_43_duplicate_pairs_log_rlm[2,]  


X_S_43<- M_S_43
Y_S_43<- abs(unlist(D_S_43))

Sample_43_df_rlm<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_rlm)<- c('log_mean','dif_over_sum')


sample_43_rlm<- ggplot(Sample_43_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

####################################################

Sample_43_duplicate_pairs_boxcox_rlm<- get_pairwise_combinations(Sample_43,corrected_boxcox_matrix[,43],duplicated_probes)



M_S_43BC<- apply(Sample_43_duplicate_pairs_boxcox_rlm,2,mean)
D_S_43BC<- Sample_43_duplicate_pairs_boxcox_rlm[1,]-Sample_43_duplicate_pairs_boxcox_rlm[2,]  


X_S_43BC<- M_S_43BC
Y_S_43BC<- abs(unlist(D_S_43BC))

Sample_43_df_rlmBC<- as.data.frame(cbind(X_S_43BC,Y_S_43BC))
colnames(Sample_43_df_rlmBC)<- c('log_mean','dif_over_sum')


sample_43_rlmBC<- ggplot(Sample_43_df_rlmBC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Box Cox RLM Corrected",y="Difference of Box Cox RLM Corrected")


##################

Sample_504_duplicate_pairs_log_rlm<- get_pairwise_combinations(Sample_504,corrected_log_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_log_rlm,2,mean)
D_S_504<- Sample_504_duplicate_pairs_log_rlm[1,]-Sample_504_duplicate_pairs_log_rlm[2,]  


X_S_504<- M_S_504
Y_S_504<- abs(unlist(D_S_504))

Sample_504_df_rlm<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_rlm)<- c('log_mean','dif_over_sum')


Sample_504_rlm<- ggplot(Sample_504_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

############################################################

Sample_504_duplicate_pairs_boxcox_rlm<- get_pairwise_combinations(Sample_504,corrected_boxcox_matrix[,504],duplicated_probes)



M_S_504BC<- apply(Sample_504_duplicate_pairs_boxcox_rlm,2,mean)
D_S_504BC<- Sample_504_duplicate_pairs_boxcox_rlm[1,]-Sample_504_duplicate_pairs_boxcox_rlm[2,]  


X_S_504BC<- M_S_504BC
Y_S_504BC<- abs(unlist(D_S_504BC))

Sample_504_df_rlmBC<- as.data.frame(cbind(X_S_504BC,Y_S_504BC))
colnames(Sample_504_df_rlmBC)<- c('log_mean','dif_over_sum')


Sample_504_rlmBC<- ggplot(Sample_504_df_rlmBC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Box Cox RLM Corrected",y="Difference of Box Cox RLM Corrected")


##############################################################

ICEMR_within_rlm_df<- as.data.frame(cbind(rbind(Sample_333_df_rlm,Sample_43_df_rlm,Sample_504_df_rlm),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_rlm_df)<- c("log_mean",'dif_over_sum','Array')


ICEMR_within_rlm_dfBC<- as.data.frame(cbind(rbind(Sample_333_df_rlm_BC,Sample_43_df_rlmBC,Sample_504_df_rlmBC),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_rlm_dfBC)<- c("log_mean",'dif_over_sum','Array')

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
## between array plots
M_S_498_500<- (corrected_log_matrix[,498]+corrected_log_matrix[,500])/2
D_S_498_500<- (corrected_log_matrix[,498]-corrected_log_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_rlm<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_rlm)<- c('log_mean','dif_over_sum')


sample_498_500_rlm<- ggplot(Sample_498_500_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_rlm$dif_over_sum~Sample_498_500_df_rlm$log_mean))

###########################################################################
M_S_498_500BC<- (corrected_boxcox_matrix[,498]+corrected_boxcox_matrix[,500])/2
D_S_498_500BC<- (corrected_boxcox_matrix[,498]-corrected_boxcox_matrix[,500]) 


X_S_498_500BC<- M_S_498_500BC
Y_S_498_500BC<- D_S_498_500BC

Sample_498_500_df_rlmBC<- as.data.frame(cbind(X_S_498_500BC,Y_S_498_500BC))
colnames(Sample_498_500_df_rlmBC)<- c('log_mean','dif_over_sum')


sample_498_500_rlmBC<- ggplot(Sample_498_500_df_rlmBC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Box Cox, RLM, Standardized",y="Difference of Box Cox, RLM, Standardized")

summary(lm(Sample_498_500_df_rlmBC$dif_over_sum~Sample_498_500_df_rlmBC$log_mean))
#########################

M_S_498_504<- (corrected_log_matrix[,498]+corrected_log_matrix[,504])/2
D_S_498_504<- (corrected_log_matrix[,498]-corrected_log_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_rlm<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_rlm)<- c('log_mean','dif_over_sum')


sample_498_504_rlm<- ggplot(Sample_498_504_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_rlm$dif_over_sum~Sample_498_504_df_rlm$log_mean))

################################################

M_S_498_504BC<- (corrected_boxcox_matrix[,498]+corrected_boxcox_matrix[,504])/2
D_S_498_504BC<- (corrected_boxcox_matrix[,498]-corrected_boxcox_matrix[,504]) 


X_S_498_504BC<- M_S_498_504BC
Y_S_498_504BC<- D_S_498_504BC

Sample_498_504_df_rlmBC<- as.data.frame(cbind(X_S_498_504BC,Y_S_498_504BC))
colnames(Sample_498_504_df_rlmBC)<- c('log_mean','dif_over_sum')


sample_498_504_rlmBC<- ggplot(Sample_498_504_df_rlmBC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Box Cox, RLM, Standardized",y="Difference of Box Cox, RLM, Standardized")
summary(lm(Sample_498_504_df_rlmBC$dif_over_sum~Sample_498_504_df_rlmBC$log_mean))
#############################
M_S_500_504<- (corrected_log_matrix[,500]+corrected_log_matrix[,504])/2
D_S_500_504<- (corrected_log_matrix[,500]-corrected_log_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_rlm<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_rlm)<- c('log_mean','dif_over_sum')


Sample_500_504_rlm<- ggplot(Sample_500_504_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_rlm$dif_over_sum~Sample_500_504_df_rlm$log_mean))

#########################################
M_S_500_504BC<- (corrected_boxcox_matrix[,500]+corrected_boxcox_matrix[,504])/2
D_S_500_504BC<- (corrected_boxcox_matrix[,500]-corrected_boxcox_matrix[,504]) 


X_S_500_504BC<- M_S_500_504BC
Y_S_500_504BC<- D_S_500_504BC

Sample_500_504_df_rlmBC<- as.data.frame(cbind(X_S_500_504BC,Y_S_500_504BC))
colnames(Sample_500_504_df_rlmBC)<- c('log_mean','dif_over_sum')


Sample_500_504_rlmBC<- ggplot(Sample_500_504_df_rlmBC,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Box Cox, RLM, Standardized",y="Difference of Box Cox, RLM, Standardized")

summary(lm(Sample_500_504_df_rlmBC$dif_over_sum~Sample_500_504_df_rlmBC$log_mean))

#########################################

ICEMR_between_rlm_df<- as.data.frame(cbind(rbind(Sample_498_500_df_rlm,Sample_498_504_df_rlm,Sample_500_504_df_rlm),rep(c("Arrays 498,500","Arrays 498,504","Arrays 500,504"),each=1156)))

colnames(ICEMR_between_rlm_df)<- c("log_mean",'dif','Array')

ICEMR_between_rlm_dfBC<- as.data.frame(cbind(rbind(Sample_498_500_df_rlmBC,Sample_498_504_df_rlmBC,Sample_500_504_df_rlmBC),rep(c("Arrays 498,500","Arrays 498,504","Arrays 500,504"),each=1156)))

colnames(ICEMR_between_rlm_dfBC)<- c("log_mean",'dif','Array')


```




```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
std_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlm<- apply(corrected_log_matrix[index_ctrls,],2,mean)
sd_rlm<- apply(corrected_log_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  std_ratio_matrix[,i]<- (corrected_log_matrix[,i]-mean_rlm[i])/sd_rlm[i]
}

std_BC_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlmBC<- apply(corrected_boxcox_matrix[index_ctrls,],2,mean)
sd_rlmBC<- apply(corrected_boxcox_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  std_BC_matrix[,i]<- (corrected_boxcox_matrix[,i]-mean_rlmBC[i])/sd_rlmBC[i]
}

med_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
med_rlm<- apply(corrected_log_matrix[index_ctrls,],2,median)
iqr_rlm<- apply(corrected_log_matrix[index_ctrls,],2,IQR)/1.35
for(i in 1:504){
  med_ratio_matrix[,i]<- (corrected_log_matrix[,i]-med_rlm[i])/iqr_rlm[i]
}


wins_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
wins_mean_rlm<- apply(apply(corrected_log_matrix[index_ctrls,],2,Winsorize),2,mean)
wins_sd_rlm<- apply(apply(corrected_log_matrix[index_ctrls,],2,Winsorize),2,sd)
for(i in 1:504){
  wins_ratio_matrix[,i]<- (corrected_log_matrix[,i]-wins_mean_rlm[i])/wins_sd_rlm[i]
}

quant_ratio_matrix<- normalize.quantiles(log_ratio_matrix)




vsn_ratio_matrix<- normalizeVSN(log_ratio_matrix)

svsn_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlm<- apply(vsn_ratio_matrix[index_ctrls,],2,mean)
sd_rlm<- apply(vsn_ratio_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  svsn_ratio_matrix[,i]<- (vsn_ratio_matrix[,i]-mean_rlm[i])/sd_rlm[i]
}

cyclic_loess_matrix<- normalizeCyclicLoess(log_ratio_matrix)


scyclic_loess_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlm<- apply(cyclic_loess_matrix[index_ctrls,],2,mean)
sd_rlm<- apply(cyclic_loess_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  scyclic_loess_ratio_matrix[,i]<- (cyclic_loess_matrix[,i]-mean_rlm[i])/sd_rlm[i]
}

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

##########################
Sample_333_duplicate_pairs_std<- get_pairwise_combinations(Sample_333,std_ratio_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_std,2,mean)
D_S_333<- Sample_333_duplicate_pairs_std[1,]-Sample_333_duplicate_pairs_std[2,]  


X_S_333<- M_S_333
Y_S_333<- unlist(D_S_333)

Sample_333_df_std<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_std)<- c('log_mean','dif_over_sum')


sample_333_std<- ggplot(Sample_333_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log, RLM Corrected",y="Difference of Log RLM Corrected")

######################


Sample_43_duplicate_pairs_std<- get_pairwise_combinations(Sample_43,std_ratio_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_std,2,mean)
D_S_43<- Sample_43_duplicate_pairs_std[1,]-Sample_43_duplicate_pairs_std[2,]  


X_S_43<- M_S_43
Y_S_43<- unlist(D_S_43)

Sample_43_df_std<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_std)<- c('log_mean','dif_over_sum')


sample_43_std<- ggplot(Sample_43_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

##################

Sample_504_duplicate_pairs_std<- get_pairwise_combinations(Sample_504,std_ratio_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_std,2,mean)
D_S_504<- Sample_504_duplicate_pairs_std[1,]-Sample_504_duplicate_pairs_std[2,]  


X_S_504<- M_S_504
Y_S_504<- unlist(D_S_504)

Sample_504_df_std<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_std)<- c('log_mean','dif_over_sum')


Sample_504_std<- ggplot(Sample_504_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

ICEMR_within_std_df<- as.data.frame(cbind(rbind(Sample_333_df_std,Sample_43_df_std,Sample_504_df_std),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_std_df)<- c("log_mean",'dif_over_sum','Array')


##########################
Sample_333_duplicate_pairs_vsn<- get_pairwise_combinations(Sample_333,vsn_ratio_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_vsn,2,mean)
D_S_333<- Sample_333_duplicate_pairs_vsn[1,]-Sample_333_duplicate_pairs_vsn[2,]  


X_S_333<- M_S_333
Y_S_333<- unlist(D_S_333)

Sample_333_df_vsn<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_vsn)<- c('log_mean','dif_over_sum')


sample_333_vsn<- ggplot(Sample_333_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log, RLM Corrected",y="Difference of Log RLM Corrected")

######################


Sample_43_duplicate_pairs_vsn<- get_pairwise_combinations(Sample_43,vsn_ratio_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_vsn,2,mean)
D_S_43<- Sample_43_duplicate_pairs_vsn[1,]-Sample_43_duplicate_pairs_vsn[2,]  


X_S_43<- M_S_43
Y_S_43<- unlist(D_S_43)

Sample_43_df_vsn<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_vsn)<- c('log_mean','dif_over_sum')


sample_43_vsn<- ggplot(Sample_43_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

##################

Sample_504_duplicate_pairs_vsn<- get_pairwise_combinations(Sample_504,vsn_ratio_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_vsn,2,mean)
D_S_504<- Sample_504_duplicate_pairs_vsn[1,]-Sample_504_duplicate_pairs_vsn[2,]  


X_S_504<- M_S_504
Y_S_504<- unlist(D_S_504)

Sample_504_df_vsn<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_vsn)<- c('log_mean','dif_over_sum')


Sample_504_vsn<- ggplot(Sample_504_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

ICEMR_within_vsn_df<- as.data.frame(cbind(rbind(Sample_333_df_vsn,Sample_43_df_vsn,Sample_504_df_vsn),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_vsn_df)<- c("log_mean",'dif_over_sum','Array')
#######################################################################

Sample_333_duplicate_pairs_quant<- get_pairwise_combinations(Sample_333,quant_ratio_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_quant,2,mean)
D_S_333<- Sample_333_duplicate_pairs_quant[1,]-Sample_333_duplicate_pairs_quant[2,]  


X_S_333<- M_S_333
Y_S_333<- unlist(D_S_333)

Sample_333_df_quant<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_quant)<- c('log_mean','dif_over_sum')


sample_333_quant<- ggplot(Sample_333_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log, RLM Corrected",y="Difference of Log RLM Corrected")

######################


Sample_43_duplicate_pairs_quant<- get_pairwise_combinations(Sample_43,quant_ratio_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_quant,2,mean)
D_S_43<- Sample_43_duplicate_pairs_quant[1,]-Sample_43_duplicate_pairs_quant[2,]  


X_S_43<- M_S_43
Y_S_43<- unlist(D_S_43)

Sample_43_df_quant<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_quant)<- c('log_mean','dif_over_sum')


sample_43_quant<- ggplot(Sample_43_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

##################

Sample_504_duplicate_pairs_quant<- get_pairwise_combinations(Sample_504,quant_ratio_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_quant,2,mean)
D_S_504<- Sample_504_duplicate_pairs_quant[1,]-Sample_504_duplicate_pairs_quant[2,]  


X_S_504<- M_S_504
Y_S_504<- unlist(D_S_504)

Sample_504_df_quant<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_quant)<- c('log_mean','dif_over_sum')


Sample_504_quant<- ggplot(Sample_504_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

ICEMR_within_quant_df<- as.data.frame(cbind(rbind(Sample_333_df_quant,Sample_43_df_quant,Sample_504_df_quant),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_quant_df)<- c("log_mean",'dif_over_sum','Array')
#####################################################

Sample_333_duplicate_pairs_cyclic_loess<- get_pairwise_combinations(Sample_333,cyclic_loess_matrix[,333],duplicated_probes)



M_S_333<- apply(Sample_333_duplicate_pairs_cyclic_loess,2,mean)
D_S_333<- Sample_333_duplicate_pairs_cyclic_loess[1,]-Sample_333_duplicate_pairs_cyclic_loess[2,]  


X_S_333<- M_S_333
Y_S_333<- unlist(D_S_333)

Sample_333_df_cyclic_loess<- as.data.frame(cbind(X_S_333,Y_S_333))
colnames(Sample_333_df_cyclic_loess)<- c('log_mean','dif_over_sum')


sample_333_cyclic_loess<- ggplot(Sample_333_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 333",x="Mean of Log, RLM Corrected",y="Difference of Log RLM Corrected")

######################


Sample_43_duplicate_pairs_cyclic_loess<- get_pairwise_combinations(Sample_43,cyclic_loess_matrix[,43],duplicated_probes)



M_S_43<- apply(Sample_43_duplicate_pairs_cyclic_loess,2,mean)
D_S_43<- Sample_43_duplicate_pairs_cyclic_loess[1,]-Sample_43_duplicate_pairs_cyclic_loess[2,]  


X_S_43<- M_S_43
Y_S_43<- unlist(D_S_43)

Sample_43_df_cyclic_loess<- as.data.frame(cbind(X_S_43,Y_S_43))
colnames(Sample_43_df_cyclic_loess)<- c('log_mean','dif_over_sum')


sample_43_cyclic_loess<- ggplot(Sample_43_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 43",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

##################

Sample_504_duplicate_pairs_cyclic_loess<- get_pairwise_combinations(Sample_504,cyclic_loess_matrix[,504],duplicated_probes)



M_S_504<- apply(Sample_504_duplicate_pairs_cyclic_loess,2,mean)
D_S_504<- Sample_504_duplicate_pairs_cyclic_loess[1,]-Sample_504_duplicate_pairs_cyclic_loess[2,]  


X_S_504<- M_S_504
Y_S_504<- unlist(D_S_504)

Sample_504_df_cyclic_loess<- as.data.frame(cbind(X_S_504,Y_S_504))
colnames(Sample_504_df_cyclic_loess)<- c('log_mean','dif_over_sum')


Sample_504_cyclic_loess<- ggplot(Sample_504_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Sample 504",x="Mean of Log RLM Corrected",y="Difference of Log RLM Corrected")

ICEMR_within_cyclic_loess_df<- as.data.frame(cbind(rbind(Sample_333_df_cyclic_loess,Sample_43_df_cyclic_loess,Sample_504_df_cyclic_loess),rep(c("Array 333","Array 43","Array 504"),each=936)))

colnames(ICEMR_within_cyclic_loess_df)<- c("log_mean",'dif_over_sum','Array')




```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
## between array plots
M_S_498_500<- (std_ratio_matrix[,498]+std_ratio_matrix[,500])/2
D_S_498_500<- (std_ratio_matrix[,498]-std_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_std<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_std)<- c('log_mean','dif_over_sum')


sample_498_500_std<- ggplot(Sample_498_500_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_std$dif_over_sum~Sample_498_500_df_std$log_mean))

##########################
M_S_498_500BC<- (std_BC_matrix[,498]+std_BC_matrix[,500])/2
D_S_498_500BC<- (std_BC_matrix[,498]-std_BC_matrix[,500]) 


X_S_498_500BC<- M_S_498_500BC
Y_S_498_500BC<- D_S_498_500BC

Sample_498_500_df_stdBC<- as.data.frame(cbind(X_S_498_500BC,Y_S_498_500BC))
colnames(Sample_498_500_df_stdBC)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_500_df_stdBC$dif_over_sum~Sample_498_500_df_stdBC$log_mean))


#########################

M_S_498_504<- (std_ratio_matrix[,498]+std_ratio_matrix[,504])/2
D_S_498_504<- (std_ratio_matrix[,498]-std_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_std<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_std)<- c('log_mean','dif_over_sum')


sample_498_504_std<- ggplot(Sample_498_504_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_std$dif_over_sum~Sample_498_504_df_std$log_mean))

############################

M_S_498_504BC<- (std_BC_matrix[,498]+std_BC_matrix[,504])/2
D_S_498_504BC<- (std_BC_matrix[,498]-std_BC_matrix[,504]) 


X_S_498_504BC<- M_S_498_504BC
Y_S_498_504BC<- D_S_498_504BC

Sample_498_504_df_stdBC<- as.data.frame(cbind(X_S_498_504BC,Y_S_498_504BC))
colnames(Sample_498_504_df_stdBC)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_504_df_stdBC$dif_over_sum~Sample_498_504_df_stdBC$log_mean))
#############################
M_S_500_504<- (std_ratio_matrix[,500]+std_ratio_matrix[,504])/2
D_S_500_504<- (std_ratio_matrix[,500]-std_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_std<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_std)<- c('log_mean','dif_over_sum')


Sample_500_504_std<- ggplot(Sample_500_504_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_std$dif_over_sum~Sample_500_504_df_std$log_mean))

#############################
M_S_500_504BC<- (std_BC_matrix[,500]+std_BC_matrix[,504])/2
D_S_500_504BC<- (std_BC_matrix[,500]-std_BC_matrix[,504]) 


X_S_500_504BC<- M_S_500_504BC
Y_S_500_504BC<- D_S_500_504BC

Sample_500_504_df_stdBC<- as.data.frame(cbind(X_S_500_504BC,Y_S_500_504BC))
colnames(Sample_500_504_df_stdBC)<- c('log_mean','dif_over_sum')


summary(lm(Sample_500_504_df_stdBC$dif_over_sum~Sample_500_504_df_stdBC$log_mean))
##############################

ICEMR_between_std_df<- as.data.frame(cbind(rbind(Sample_498_500_df_std,Sample_498_504_df_std,Sample_500_504_df_std),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_std_df)<- c("log_mean",'dif','Array')

#############################

ICEMR_between_std_dfBC<- as.data.frame(cbind(rbind(Sample_498_500_df_stdBC,Sample_498_504_df_stdBC,Sample_500_504_df_stdBC),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_std_dfBC)<- c("log_mean",'dif','Array')

###############################################################3

M_S_498_500<- (vsn_ratio_matrix[,498]+vsn_ratio_matrix[,500])/2
D_S_498_500<- (vsn_ratio_matrix[,498]-vsn_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_vsn<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_vsn)<- c('log_mean','dif_over_sum')


sample_498_500_vsn<- ggplot(Sample_498_500_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_vsn$dif_over_sum~Sample_498_500_df_vsn$log_mean))


#########################

M_S_498_504<- (vsn_ratio_matrix[,498]+vsn_ratio_matrix[,504])/2
D_S_498_504<- (vsn_ratio_matrix[,498]-vsn_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_vsn<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_vsn)<- c('log_mean','dif_over_sum')


sample_498_504_vsn<- ggplot(Sample_498_504_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_vsn$dif_over_sum~Sample_498_504_df_vsn$log_mean))
##################################################################

M_S_500_504<- (vsn_ratio_matrix[,500]+vsn_ratio_matrix[,504])/2
D_S_500_504<- (vsn_ratio_matrix[,500]-vsn_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_vsn<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_vsn)<- c('log_mean','dif_over_sum')


Sample_500_504_vsn<- ggplot(Sample_500_504_df_vsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_vsn$dif_over_sum~Sample_500_504_df_vsn$log_mean))
####################################


ICEMR_between_vsn_df<- as.data.frame(cbind(rbind(Sample_498_500_df_vsn,Sample_498_504_df_vsn,Sample_500_504_df_vsn),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_vsn_df)<- c("log_mean",'dif','Array')
############################################################################


M_S_498_500<- (svsn_ratio_matrix[,498]+svsn_ratio_matrix[,500])/2
D_S_498_500<- (svsn_ratio_matrix[,498]-svsn_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_svsn<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_svsn)<- c('log_mean','dif_over_sum')


sample_498_500_svsn<- ggplot(Sample_498_500_df_svsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_svsn$dif_over_sum~Sample_498_500_df_svsn$log_mean))


#########################

M_S_498_504<- (svsn_ratio_matrix[,498]+svsn_ratio_matrix[,504])/2
D_S_498_504<- (svsn_ratio_matrix[,498]-svsn_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_svsn<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_svsn)<- c('log_mean','dif_over_sum')


sample_498_504_svsn<- ggplot(Sample_498_504_df_svsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_svsn$dif_over_sum~Sample_498_504_df_svsn$log_mean))
##################################################################

M_S_500_504<- (svsn_ratio_matrix[,500]+svsn_ratio_matrix[,504])/2
D_S_500_504<- (svsn_ratio_matrix[,500]-svsn_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_svsn<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_svsn)<- c('log_mean','dif_over_sum')


Sample_500_504_svsn<- ggplot(Sample_500_504_df_svsn,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_svsn$dif_over_sum~Sample_500_504_df_svsn$log_mean))
####################################


ICEMR_between_svsn_df<- as.data.frame(cbind(rbind(Sample_498_500_df_svsn,Sample_498_504_df_svsn,Sample_500_504_df_svsn),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_svsn_df)<- c("log_mean",'dif','Array')




########################################################

M_S_498_500<- (quant_ratio_matrix[,498]+quant_ratio_matrix[,500])/2
D_S_498_500<- (quant_ratio_matrix[,498]-quant_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_quant<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_quant)<- c('log_mean','dif_over_sum')


sample_498_500_quant<- ggplot(Sample_498_500_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_quant$dif_over_sum~Sample_498_500_df_quant$log_mean))


#########################

M_S_498_504<- (quant_ratio_matrix[,498]+quant_ratio_matrix[,504])/2
D_S_498_504<- (quant_ratio_matrix[,498]-quant_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_quant<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_quant)<- c('log_mean','dif_over_sum')


sample_498_504_quant<- ggplot(Sample_498_504_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_quant$dif_over_sum~Sample_498_504_df_quant$log_mean))
##################################################################

M_S_500_504<- (quant_ratio_matrix[,500]+quant_ratio_matrix[,504])/2
D_S_500_504<- (quant_ratio_matrix[,500]-quant_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_quant<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_quant)<- c('log_mean','dif_over_sum')


Sample_500_504_quant<- ggplot(Sample_500_504_df_quant,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_quant$dif_over_sum~Sample_500_504_df_quant$log_mean))
####################################


ICEMR_between_quant_df<- as.data.frame(cbind(rbind(Sample_498_500_df_quant,Sample_498_504_df_quant,Sample_500_504_df_quant),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_quant_df)<- c("log_mean",'dif','Array')


######################################


M_S_498_500<- (cyclic_loess_matrix[,498]+cyclic_loess_matrix[,500])/2
D_S_498_500<- (cyclic_loess_matrix[,498]-cyclic_loess_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_cyclic_loess<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_cyclic_loess)<- c('log_mean','dif_over_sum')


sample_498_500_cyclic_loess<- ggplot(Sample_498_500_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_cyclic_loess$dif_over_sum~Sample_498_500_df_cyclic_loess$log_mean))


#########################

M_S_498_504<- (cyclic_loess_matrix[,498]+cyclic_loess_matrix[,504])/2
D_S_498_504<- (cyclic_loess_matrix[,498]-cyclic_loess_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_cyclic_loess<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_cyclic_loess)<- c('log_mean','dif_over_sum')


sample_498_504_cyclic_loess<- ggplot(Sample_498_504_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_cyclic_loess$dif_over_sum~Sample_498_504_df_cyclic_loess$log_mean))
##################################################################

M_S_500_504<- (cyclic_loess_matrix[,500]+cyclic_loess_matrix[,504])/2
D_S_500_504<- (cyclic_loess_matrix[,500]-cyclic_loess_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_cyclic_loess<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_cyclic_loess)<- c('log_mean','dif_over_sum')


Sample_500_504_cyclic_loess<- ggplot(Sample_500_504_df_cyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_cyclic_loess$dif_over_sum~Sample_500_504_df_cyclic_loess$log_mean))
####################################


ICEMR_between_cyclic_loess_df<- as.data.frame(cbind(rbind(Sample_498_500_df_cyclic_loess,Sample_498_504_df_cyclic_loess,Sample_500_504_df_cyclic_loess),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_cyclic_loess_df)<- c("log_mean",'dif','Array')

########################################################


M_S_498_500<- (scyclic_loess_ratio_matrix[,498]+scyclic_loess_ratio_matrix[,500])/2
D_S_498_500<- (scyclic_loess_ratio_matrix[,498]-scyclic_loess_ratio_matrix[,500]) 


X_S_498_500<- M_S_498_500
Y_S_498_500<- D_S_498_500

Sample_498_500_df_scyclic_loess<- as.data.frame(cbind(X_S_498_500,Y_S_498_500))
colnames(Sample_498_500_df_scyclic_loess)<- c('log_mean','dif_over_sum')


sample_498_500_scyclic_loess<- ggplot(Sample_498_500_df_scyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 500",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_498_500_df_scyclic_loess$dif_over_sum~Sample_498_500_df_scyclic_loess$log_mean))


#########################

M_S_498_504<- (scyclic_loess_ratio_matrix[,498]+scyclic_loess_ratio_matrix[,504])/2
D_S_498_504<- (scyclic_loess_ratio_matrix[,498]-scyclic_loess_ratio_matrix[,504]) 


X_S_498_504<- M_S_498_504
Y_S_498_504<- D_S_498_504

Sample_498_504_df_scyclic_loess<- as.data.frame(cbind(X_S_498_504,Y_S_498_504))
colnames(Sample_498_504_df_scyclic_loess)<- c('log_mean','dif_over_sum')


sample_498_504_scyclic_loess<- ggplot(Sample_498_504_df_scyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 498, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")
summary(lm(Sample_498_504_df_scyclic_loess$dif_over_sum~Sample_498_504_df_scyclic_loess$log_mean))
##################################################################

M_S_500_504<- (scyclic_loess_ratio_matrix[,500]+scyclic_loess_ratio_matrix[,504])/2
D_S_500_504<- (scyclic_loess_ratio_matrix[,500]-scyclic_loess_ratio_matrix[,504]) 


X_S_500_504<- M_S_500_504
Y_S_500_504<- D_S_500_504

Sample_500_504_df_scyclic_loess<- as.data.frame(cbind(X_S_500_504,Y_S_500_504))
colnames(Sample_500_504_df_scyclic_loess)<- c('log_mean','dif_over_sum')


Sample_500_504_scyclic_loess<- ggplot(Sample_500_504_df_scyclic_loess,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Samples 500, 504",x="Mean of Log, RLM, Standardized",y="Difference of Log, RLM, Standardized")

summary(lm(Sample_500_504_df_scyclic_loess$dif_over_sum~Sample_500_504_df_scyclic_loess$log_mean))
####################################


ICEMR_between_scyclic_loess_df<- as.data.frame(cbind(rbind(Sample_498_500_df_scyclic_loess,Sample_498_504_df_scyclic_loess,Sample_500_504_df_scyclic_loess),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_scyclic_loess_df)<- c("log_mean",'dif','Array')



```

```{r, cache=T, message=F, warning=F, echo=F}
M_S_498_500M<- (med_ratio_matrix[,498]+med_ratio_matrix[,500])/2
D_S_498_500M<- (med_ratio_matrix[,498]-med_ratio_matrix[,500]) 


X_S_498_500M<- M_S_498_500M
Y_S_498_500M<- D_S_498_500M

Sample_498_500_df_med<- as.data.frame(cbind(X_S_498_500M,Y_S_498_500M))
colnames(Sample_498_500_df_med)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_500_df_med$dif_over_sum~Sample_498_500_df_med$log_mean))

##########################

#########################

M_S_498_504M<- (med_ratio_matrix[,498]+med_ratio_matrix[,504])/2
D_S_498_504M<- (med_ratio_matrix[,498]-med_ratio_matrix[,504]) 


X_S_498_504M<- M_S_498_504M
Y_S_498_504M<- D_S_498_504M

Sample_498_504_df_med<- as.data.frame(cbind(X_S_498_504M,Y_S_498_504M))
colnames(Sample_498_504_df_med)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_504_df_med$dif_over_sum~Sample_498_504_df_med$log_mean))

############################


#############################
M_S_500_504M<- (med_ratio_matrix[,500]+med_ratio_matrix[,504])/2
D_S_500_504M<- (med_ratio_matrix[,500]-med_ratio_matrix[,504]) 


X_S_500_504M<- M_S_500_504M
Y_S_500_504M<- D_S_500_504M

Sample_500_504_df_med<- as.data.frame(cbind(X_S_500_504M,Y_S_500_504M))
colnames(Sample_500_504_df_med)<- c('log_mean','dif_over_sum')


summary(lm(Sample_500_504_df_med$dif_over_sum~Sample_500_504_df_med$log_mean))

#############################

##############################

ICEMR_between_med_df<- as.data.frame(cbind(rbind(Sample_498_500_df_med,Sample_498_504_df_med,Sample_500_504_df_med),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_med_df)<- c("log_mean",'dif','Array')

#############################

```



```{r, cache=T, message=F, warning=F, echo=F}
M_S_498_500W<- (wins_ratio_matrix[,498]+wins_ratio_matrix[,500])/2
D_S_498_500W<- (wins_ratio_matrix[,498]-wins_ratio_matrix[,500]) 


X_S_498_500W<- M_S_498_500W
Y_S_498_500W<- D_S_498_500W

Sample_498_500_df_wins<- as.data.frame(cbind(X_S_498_500W,Y_S_498_500W))
colnames(Sample_498_500_df_wins)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_500_df_wins$dif_over_sum~Sample_498_500_df_wins$log_mean))

##########################

#########################

M_S_498_504W<- (wins_ratio_matrix[,498]+wins_ratio_matrix[,504])/2
D_S_498_504W<- (wins_ratio_matrix[,498]-wins_ratio_matrix[,504]) 


X_S_498_504W<- M_S_498_504W
Y_S_498_504W<- D_S_498_504W

Sample_498_504_df_wins<- as.data.frame(cbind(X_S_498_504W,Y_S_498_504W))
colnames(Sample_498_504_df_wins)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_504_df_wins$dif_over_sum~Sample_498_504_df_wins$log_mean))

############################


#############################
M_S_500_504W<- (wins_ratio_matrix[,500]+wins_ratio_matrix[,504])/2
D_S_500_504W<- (wins_ratio_matrix[,500]-wins_ratio_matrix[,504]) 


X_S_500_504W<- M_S_500_504W
Y_S_500_504W<- D_S_500_504W

Sample_500_504_df_wins<- as.data.frame(cbind(X_S_500_504W,Y_S_500_504W))
colnames(Sample_500_504_df_wins)<- c('log_mean','dif_over_sum')


summary(lm(Sample_500_504_df_wins$dif_over_sum~Sample_500_504_df_wins$log_mean))

#############################

##############################

ICEMR_between_wins_df<- as.data.frame(cbind(rbind(Sample_498_500_df_wins,Sample_498_504_df_wins,Sample_500_504_df_wins),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_wins_df)<- c("log_mean",'dif','Array')

#############################

```



```{r, cache=T, message=F, warning=F, echo=F}
M_S_498_500Q<- (quant_ratio_matrix[,498]+quant_ratio_matrix[,500])/2
D_S_498_500Q<- (quant_ratio_matrix[,498]-quant_ratio_matrix[,500]) 


X_S_498_500Q<- M_S_498_500Q
Y_S_498_500Q<- D_S_498_500Q

Sample_498_500_df_quant<- as.data.frame(cbind(X_S_498_500Q,Y_S_498_500Q))
colnames(Sample_498_500_df_quant)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_500_df_quant$dif_over_sum~Sample_498_500_df_quant$log_mean))

##########################

#########################

M_S_498_504Q<- (quant_ratio_matrix[,498]+quant_ratio_matrix[,504])/2
D_S_498_504Q<- (quant_ratio_matrix[,498]-quant_ratio_matrix[,504]) 


X_S_498_504Q<- M_S_498_504Q
Y_S_498_504Q<- D_S_498_504Q

Sample_498_504_df_quant<- as.data.frame(cbind(X_S_498_504Q,Y_S_498_504Q))
colnames(Sample_498_504_df_quant)<- c('log_mean','dif_over_sum')


summary(lm(Sample_498_504_df_quant$dif_over_sum~Sample_498_504_df_quant$log_mean))

############################


#############################
M_S_500_504Q<- (quant_ratio_matrix[,500]+quant_ratio_matrix[,504])/2
D_S_500_504Q<- (quant_ratio_matrix[,500]-quant_ratio_matrix[,504]) 


X_S_500_504Q<- M_S_500_504Q
Y_S_500_504Q<- D_S_500_504Q

Sample_500_504_df_quant<- as.data.frame(cbind(X_S_500_504Q,Y_S_500_504Q))
colnames(Sample_500_504_df_quant)<- c('log_mean','dif_over_sum')


summary(lm(Sample_500_504_df_quant$dif_over_sum~Sample_500_504_df_quant$log_mean))

#############################

##############################

ICEMR_between_quant_df<- as.data.frame(cbind(rbind(Sample_498_500_df_quant,Sample_498_504_df_quant,Sample_500_504_df_quant),rep(c("Array 498,500","Array 498,504","Array 500,504"),each=1156)))

colnames(ICEMR_between_quant_df)<- c("log_mean",'dif','Array')

#############################

```



```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

rlm_medians<- apply(corrected_log_matrix,1,median)


rlm_medians_proteins<- as.data.frame(cbind(Sample_1$ID,rlm_medians))
 



rlm_medians_ctrl_proteins<- rlm_medians_proteins[index_ctrls,]

rlm_medians_test_proteins<- rlm_medians_proteins[-c(index_ctrls),]
rlm_medians_test_proteins$rlm_medians<- as.numeric(rlm_medians_test_proteins$rlm_medians)

ordered_rlm_medians_test_proteins<- rlm_medians_test_proteins[order(rlm_medians_test_proteins[,2],decreasing = TRUE),]

ranked_rlm_test_proteins<-cbind(ordered_rlm_medians_test_proteins,rep(1:nrow(ordered_rlm_medians_test_proteins)))

##################################

raw_medians<- apply(ratio_matrix,1,median)


raw_medians_proteins<- as.data.frame(cbind(Sample_1$ID,raw_medians), stringsAsFactors=FALSE,col.names=c("ID","Intensity"))

raw_medians_proteins$raw_medians<- as.numeric(raw_medians_proteins$raw_medians)

#separate control and test probes: 

raw_medians_ctrl_proteins<- raw_medians_proteins[index_ctrls,]

raw_medians_test_proteins<- raw_medians_proteins[-c(index_ctrls),]



ordered_raw_medians_test_proteins<- raw_medians_test_proteins[order(raw_medians_test_proteins[,2],decreasing = TRUE),]

ranked_raw_test_proteins<-cbind(ordered_raw_medians_test_proteins,rep(1:nrow(ordered_raw_medians_test_proteins)))

#######################################


######################

std_medians<- apply(std_ratio_matrix,1,median)


std_medians_proteins<- as.data.frame(cbind(Sample_1$Name,std_medians))
 



std_medians_ctrl_proteins<- std_medians_proteins[index_ctrls,]

std_medians_test_proteins<- std_medians_proteins[-c(index_ctrls),]

std_medians_test_proteins$std_medians<- as.numeric(std_medians_test_proteins$std_medians)
ordered_std_medians_test_proteins<- std_medians_test_proteins[order(std_medians_test_proteins[,2],decreasing = TRUE),]

ranked_std_test_proteins<-cbind(ordered_std_medians_test_proteins,rep(1:nrow(ordered_std_medians_test_proteins)))
##################################

#######################################
library(ggalluvial)

Method<- rep(c(1,2,3,4),each=20)

Antigen<- rep(c(1:10,25:34),times=4)

Ordering<- rep(c(1:20),times=4)

Rank<- c(1:10,25:34,1,2,3,4,5,6,7,8,12,10,26,27,25,30,29,32,28,31,35,39,1,2,4,3,5,6,11,7,10,9,20,25,30,29,33,28,26,31,32,40,
         1,3333,3,5,8,7,13,3334,15,10,9,3335,22,3336,11,3337,27,29,3338,28)


ICEMR_rank_df<- as.data.frame(cbind(Method, Antigen, Rank, Ordering))


ICEMR_rank_df$Method<- as.numeric(ICEMR_rank_df$Method)
ICEMR_rank_df$Antigen<- as.factor(ICEMR_rank_df$Antigen)
ICEMR_rank_df$Rank<- as.integer(ICEMR_rank_df$Rank)
ICEMR_rank_df$Ordering<- as.numeric(ICEMR_rank_df$Ordering)

ICEMR_rank_plot<- ggplot(ICEMR_rank_df, aes(x=Method,stratum=Antigen, alluvium=Rank, fill=Antigen,label=Rank))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks", "Published Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="Malaria Arrays Antigen Ranks")


######################

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

rlm_mediansBC<- apply(corrected_boxcox_matrix,1,median)


rlm_medians_proteinsBC<- as.data.frame(cbind(Sample_1$ID,rlm_mediansBC))
 



rlm_medians_ctrl_proteinsBC<- rlm_medians_proteinsBC[index_ctrls,]

rlm_medians_test_proteinsBC<- rlm_medians_proteinsBC[-c(index_ctrls),]
rlm_medians_test_proteinsBC$rlm_mediansBC<- as.numeric(rlm_medians_test_proteinsBC$rlm_mediansBC)

ordered_rlm_medians_test_proteinsBC<- rlm_medians_test_proteinsBC[order(rlm_medians_test_proteinsBC$rlm_mediansBC,decreasing = TRUE),]

ranked_rlm_test_proteinsBC<-cbind(ordered_rlm_medians_test_proteinsBC,rep(1:nrow(ordered_rlm_medians_test_proteinsBC)))

##################################

raw_medians<- apply(ratio_matrix,1,median)


raw_medians_proteins<- as.data.frame(cbind(Sample_1$ID,raw_medians), stringsAsFactors=FALSE,col.names=c("ID","Intensity"))

raw_medians_proteins$raw_medians<- as.numeric(raw_medians_proteins$raw_medians)

#separate control and test probes: 

raw_medians_ctrl_proteins<- raw_medians_proteins[index_ctrls,]

raw_medians_test_proteins<- raw_medians_proteins[-c(index_ctrls),]



ordered_raw_medians_test_proteins<- raw_medians_test_proteins[order(raw_medians_test_proteins[,2],decreasing = TRUE),]

ranked_raw_test_proteins<-cbind(ordered_raw_medians_test_proteins,rep(1:nrow(ordered_raw_medians_test_proteins)))

#######################################


######################

std_mediansBC<- apply(std_BC_matrix,1,median)


std_medians_proteinsBC<- as.data.frame(cbind(Sample_1$ID,std_mediansBC))
 



std_medians_ctrl_proteinsBC<- std_medians_proteinsBC[index_ctrls,]

std_medians_test_proteinsBC<- std_medians_proteinsBC[-c(index_ctrls),]

std_medians_test_proteinsBC$std_mediansBC<- as.numeric(std_medians_test_proteinsBC$std_mediansBC)
ordered_std_medians_test_proteinsBC<- std_medians_test_proteinsBC[order(std_medians_test_proteinsBC$std_mediansBC,decreasing = TRUE),]

ranked_std_test_proteinsBC<-cbind(ordered_std_medians_test_proteinsBC,rep(1:nrow(ordered_std_medians_test_proteinsBC)))
##################################

#######################################
library(ggalluvial)

MethodBC<- rep(c(1,2,3),each=20)

AntigenBC<- rep(c(1:10,25:34),times=3)

OrderingBC<- rep(c(1:20),times=3)

RankBC<- c(1:10,25:34,1,2,3,4,5,6,7,8,11,9,25,26,28,29,27,32,31,30,33,37,1,2,3,4,6,5,10,7,8,11,17,28,31,32,29,14,26,34,30,42)


ICEMR_rank_dfBC<- as.data.frame(cbind(MethodBC, AntigenBC, RankBC, OrderingBC))


ICEMR_rank_dfBC$MethodBC<- as.numeric(ICEMR_rank_dfBC$MethodBC)
ICEMR_rank_dfBC$AntigenBC<- as.factor(ICEMR_rank_dfBC$AntigenBC)
ICEMR_rank_dfBC$RankBC<- as.integer(ICEMR_rank_dfBC$RankBC)
ICEMR_rank_dfBC$OrderingBC<- as.numeric(ICEMR_rank_dfBC$OrderingBC)

ICEMR_rank_plotBC<- ggplot(ICEMR_rank_dfBC, aes(x=MethodBC,stratum=AntigenBC, alluvium=RankBC, fill=AntigenBC,label=RankBC))+
  scale_x_discrete(limits=c("Raw", "Box-Cox, RLM", "Box-Cox, RLM, Std"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+xlab("Method")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="Malaria Arrays Antigen Ranks (Box-Cox Transform)")


######################

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


######################

med_medians<- apply(med_ratio_matrix,1,median)


med_medians_proteins<- as.data.frame(cbind(Sample_1$ID,med_medians))
 



med_medians_ctrl_proteins<- med_medians_proteins[index_ctrls,]

med_medians_test_proteins<- med_medians_proteins[-c(index_ctrls),]

med_medians_test_proteins$med_medians<- as.numeric(med_medians_test_proteins$med_medians)
ordered_med_medians_test_proteins<- med_medians_test_proteins[order(med_medians_test_proteins[,2],decreasing = TRUE),]

ranked_med_test_proteins<-cbind(ordered_med_medians_test_proteins,rep(1:nrow(ordered_med_medians_test_proteins)))
##################################

#######################################
library(ggalluvial)



Rank_med<- c(1:10,25:34,1,2,3,4,5,6,7,8,12,10,26,27,25,30,29,32,28,31,35,39,1,2,4,3,6,5,8,7,10,12,29,26,25,34,31,35,27,28,30,42)


ICEMR_rank_dfM<- as.data.frame(cbind(Method, Antigen, Rank_med, Ordering))


ICEMR_rank_dfM$Method<- as.numeric(ICEMR_rank_dfM$Method)
ICEMR_rank_dfM$Antigen<- as.factor(ICEMR_rank_dfM$Antigen)
ICEMR_rank_dfM$Rank_med<- as.integer(ICEMR_rank_dfM$Rank_med)
ICEMR_rank_dfM$Ordering<- as.numeric(ICEMR_rank_dfM$Ordering)

ICEMR_rank_plot_med<- ggplot(ICEMR_rank_dfM, aes(x=Method,stratum=Antigen, alluvium=Rank_med, fill=Antigen,label=Rank_med))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="Malaria Arrays Antigen Ranks (Median Standardization)")


######################

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


######################

wins_medians<- apply(wins_ratio_matrix,1,median)


wins_medians_proteins<- as.data.frame(cbind(Sample_1$ID,wins_medians))
 



wins_medians_ctrl_proteins<- wins_medians_proteins[index_ctrls,]

wins_medians_test_proteins<- wins_medians_proteins[-c(index_ctrls),]

wins_medians_test_proteins$wins_medians<- as.numeric(wins_medians_test_proteins$wins_medians)
ordered_wins_medians_test_proteins<- wins_medians_test_proteins[order(wins_medians_test_proteins[,2],decreasing = TRUE),]

ranked_wins_test_proteins<-cbind(ordered_wins_medians_test_proteins,rep(1:nrow(ordered_wins_medians_test_proteins)))
##################################

#######################################
library(ggalluvial)



Rank_wins<- c(1:10,25:34,1,2,3,4,5,6,7,8,12,10,26,27,25,30,29,32,28,31,35,39,1,2,4,3,5,6,10,7,11,9,23,21,31,29,33,28,27,30,34,41)


ICEMR_rank_dfW<- as.data.frame(cbind(Method, Antigen, Rank_wins, Ordering))


ICEMR_rank_dfW$Method<- as.numeric(ICEMR_rank_dfW$Method)
ICEMR_rank_dfW$Antigen<- as.factor(ICEMR_rank_dfW$Antigen)
ICEMR_rank_dfW$Rank_wins<- as.integer(ICEMR_rank_dfW$Rank_wins)
ICEMR_rank_dfW$Ordering<- as.numeric(ICEMR_rank_dfW$Ordering)

ICEMR_rank_plot_wins<- ggplot(ICEMR_rank_dfW, aes(x=Method,stratum=Antigen, alluvium=Rank_wins, fill=Antigen,label=Rank_wins))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="Malaria Arrays Antigen Ranks (Winsorized Standardization)")


######################

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


######################

quant_medians<- apply(quant_ratio_matrix,1,median)


quant_medians_proteins<- as.data.frame(cbind(Sample_1$ID,quant_medians))
 



quant_medians_ctrl_proteins<- quant_medians_proteins[index_ctrls,]

quant_medians_test_proteins<- quant_medians_proteins[-c(index_ctrls),]

quant_medians_test_proteins$quant_medians<- as.numeric(quant_medians_test_proteins$quant_medians)
ordered_quant_medians_test_proteins<- quant_medians_test_proteins[order(quant_medians_test_proteins[,2],decreasing = TRUE),]

ranked_quant_test_proteins<-cbind(ordered_quant_medians_test_proteins,rep(1:nrow(ordered_quant_medians_test_proteins)))
##################################

#######################################
library(ggalluvial)



Rank_quant<- c(1:10,25:34,1,2,3,4,5,6,7,8,12,10,26,27,25,30,29,32,28,31,35,39,1,2,4,3,6,5,7,8,9,11,28,29,18,33,27,41,34,25,32,39)


ICEMR_rank_dfQ<- as.data.frame(cbind(Method, Antigen, Rank_quant, Ordering))


ICEMR_rank_dfQ$Method<- as.numeric(ICEMR_rank_dfQ$Method)
ICEMR_rank_dfQ$Antigen<- as.factor(ICEMR_rank_dfQ$Antigen)
ICEMR_rank_dfQ$Rank_quant<- as.integer(ICEMR_rank_dfQ$Rank_quant)
ICEMR_rank_dfQ$Ordering<- as.numeric(ICEMR_rank_dfQ$Ordering)

ICEMR_rank_plot_quant<- ggplot(ICEMR_rank_dfQ, aes(x=Method,stratum=Antigen, alluvium=Rank_quant, fill=Antigen,label=Rank_quant))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="Malaria Arrays Antigen Ranks (Quantile Normalization)")


######################

```

```{r,cache=TRUE,results="hide",warning=FALSE,message=FALSE,echo=FALSE}

setwd("/Users/sophieberube/Desktop/Hopkins/Hopkins/Research_Protein_Arrays/Lung_Cancer_Arrays/HuProt")


n_1<-read.delim("20160620-371988-O1-normal-650-600.txt")
n_2<-read.delim("20160620-371989-O2-normal-650-600.txt")
n_3<-read.delim("20160620-371990-O3-normal-650-600.txt")
n_4<-read.delim("20160621-3713333-O4-normal-cell-650-600.txt")
n_5<-read.delim("20160621-3713334-O5-normal-cell-650-600.txt") 
n_6<-read.delim("20160622-2-371446-O10-normal-cell.txt")
n_7<-read.delim("20160622-2-371447-O11-Normal.txt")
n_8<-read.delim("20160622-2-371448-O12-Normal.txt")
n_9<-read.delim("20160622-2-371449-O13-Normal.txt")
n_10<-read.delim("20160622-2-371450-O14-Normal.txt")
n_11<-read.delim("20160622-371353-O7-normal-cell.txt")
n_12<-read.delim("20160622-371354-O8-normal-cell.txt")
n_13<-read.delim("20160622-371355-O9-normal-cell.txt")
n_14<-read.delim("20160623-371900-P9-normal-cell.txt")
n_15<-read.delim("20160623-371901-P10-normal-cell.txt")
n_16<-read.delim("20160623-371902-P11-normal-cell.txt")
n_17<-read.delim("20160623-371903-P12-normal-cell.txt")
n_18<-read.delim("20160623-371904-P13-normal-cell.txt")
n_19<-read.delim("20160623-371905-P14-normal-cell.txt")
n_20<-read.delim("20160621-3713334-O6-normal-cell-650-600.txt")


lc_1<-read.delim("20160620-371984-C14-big-cell-650-600.txt")
lc_2<-read.delim("20160620-371985-C15-big-cell-650-600.txt")
lc_3<- read.delim("20160620-371986-C16-big-cell-650-600.txt")
lc_4<- read.delim("20160620-371987-C17-big-cell-650-600.txt")
lc_5<- read.delim("20160621-371994-C18-big-cell-650-600.txt")
lc_6<- read.delim("20160621-371995-C19-big-cell-650-600.txt")
lc_7<- read.delim("20160622-2-371436-D1-big-cell.txt")
lc_8<- read.delim("20160622-2-371437-D2-big-cell.txt")
lc_9<- read.delim("20160622-371340-C20-big-cell.txt")
lc_10<- read.delim("20160622-371341-C21-big-cell.txt")
lc_11<- read.delim("20160622-371342-C22-big-cell.txt")
lc_12<- read.delim("20160622-371343-C23-big-cell.txt")
lc_13<- read.delim("20160622-371344-C24-big-cell.txt")

sc_1<- read.delim("20160620-371981-A1-small-cell-650-600.txt")
sc_2<-read.delim("20160620-371982-A2-small-cell-650-600.txt")
sc_3<-read.delim("20160620-371983-A3-small-cell-650-600.txt")
sc_4<- read.delim("20160621-371991-A4-small-cell-650-600.txt")
sc_5<- read.delim("20160621-371992-A5-small-cell-650-600.txt")
sc_6<- read.delim("20160621-371993-A6-small-cell-650-600.txt")
sc_7<- read.delim("20160622-2-371431-C4-small-cell.txt")
sc_8<- read.delim("20160622-2-371432-C5-small-cell.txt")
sc_9<- read.delim("20160622-2-371433-C6-small-cell.txt")
sc_10<-read.delim("20160622-2-371434-C7-small-cell.txt")
sc_11<-read.delim("20160622-2-371435-C8-small-cell.txt")
sc_12<- read.delim("20160622-371336-A7-small-cell.txt")
sc_13<- read.delim("20160622-371337-A8-small-cell.txt")
sc_14<- read.delim("20160622-371338-A9-small-cell.txt")
sc_15<-read.delim("20160622-371339-A10-small-cell.txt")
sc_16<- read.delim("20160623-371451-C9-small-cell.txt")
sc_17<- read.delim("20160623-371452-C10-small-cell.txt")
sc_18<-read.delim("20160623-371453-C11-small-cell.txt")
sc_19<-read.delim("20160623-371454-C12-small-cell.txt")
sc_20<-read.delim("20160623-371455-C13-small-cell.txt")


ac_1<-read.delim("20160621-371996-F1-xian-cell-650-600.txt")
ac_2<-read.delim("20160621-371997-F2-xian-cell-650-600.txt")
ac_3<-read.delim("20160621-371998-F3-xian-cell-650-600.txt")
ac_4<-read.delim("20160621-371999-F4-xian-cell-650-600.txt")
ac_5<-read.delim("20160621-3712000-F5-xian-cell-650-600.txt")
ac_6<-read.delim("20160621-3712001-F6-xian-cell-650-600.txt")
ac_7<-read.delim("20160622-2-371438-F11-xian-cell.txt")
ac_8<-read.delim("20160622-2-371439-F12-xian-cell.txt")
ac_9<-read.delim("20160622-2-371440-F13-xian-cell.txt")
ac_10<- read.delim("20160622-2-371441-F14-xian-cell.txt")
ac_11<-read.delim("20160622-371345-F7-xian-cell.txt")
ac_12<-read.delim("20160622-371346-F8-xian-cell.txt")
ac_13<-read.delim("20160622-371347-F9-xian-cell.txt")
ac_14<-read.delim("20160622-371348-F10-xian-cell.txt")
ac_15<-read.delim("20160623-371881-E7-xianl-cell.txt")
ac_16<-read.delim("20160623-371882-E8-xianl-cell.txt")
ac_17<-read.delim("20160623-371883-E9-xianl-cell.txt")
ac_18<-read.delim("20160623-371884-E10-xianl-cell.txt")
ac_19<-read.delim("20160623-371885-E11-xianl-cell.txt")
ac_20<-read.delim("20160623-371886-E20-xianl-cell.txt")
ac_21<-read.delim("20160623-371887-E21-xianl-cell.txt")
ac_22<-read.delim("20160623-371888-E22-xianl-cell.txt")
ac_23<-read.delim("20160623-371889-E23-xianl-cell.txt")
ac_24<-read.delim("20160623-371890-E24-xianl-cell.txt")

sq_1<-read.delim("20160621-3712002-I1-lin-cell-650-600.txt")
sq_2<-read.delim("20160621-3712003-I2-lin-cell-650-600.txt")
sq_3<-read.delim("20160621-3712004-I3-lin-cell-650-600.txt")
sq_4<-read.delim("20160621-3712005-I4-lin-cell-650-600.txt")
sq_5<-read.delim("20160621-3712006-I5-lin-cell-650-600.txt")
sq_6<-read.delim("20160621-3713332-I6-lin-cell-650-600.txt")
sq_7<-read.delim("20160622-2-371442-I11---lin-cell.txt")
sq_8<-read.delim("20160622-2-371443-I12-lin-cell.txt")
sq_9<-read.delim("20160622-2-371444-I13-lin-cell.txt")
sq_10<-read.delim("20160622-2-371445-I14-lin-cell.txt")
sq_11<-read.delim("20160622-371349-I7-lin-cell.txt")
sq_12<-read.delim("20160622-371350-I8-lin-cell.txt")
sq_13<-read.delim("20160622-371351-I9-lin-cell.txt")
sq_14<-read.delim("20160622-371352-I10-lin-cell.txt")
sq_15<-read.delim("20160623-371891-J1-lin-cell.txt")
sq_16<-read.delim("20160623-371892-J3-lin-cell.txt")
sq_17<-read.delim("20160623-371893-J4-lin-cell.txt")
sq_18<-read.delim("20160623-371894-J5-lin-cell.txt")
sq_19<-read.delim("20160623-371895-J8-lin-cell.txt")
sq_20<-read.delim("20160623-371896-J13-lin-cell.txt")
sq_21<-read.delim("20160623-371896-J16-lin-cell.txt")
sq_22<-read.delim("20160623-371898-J17-lin-cell.txt")
sq_23<-read.delim("20160623-371899-J18-lin-cell.txt")

ratio_matrix<- cbind((n_1$F532.Median/n_1$B532.Median),
                         (n_2$F532.Median/n_2$B532.Median),
                         (n_3$F532.Median/n_3$B532.Median),
                         (n_4$F532.Median/n_4$B532.Median),
                         (n_5$F532.Median/n_5$B532.Median),
                         (n_6$F532.Median/n_6$B532.Median),
                         (n_7$F532.Median/n_7$B532.Median),
                         (n_8$F532.Median/n_8$B532.Median),
                         (n_9$F532.Median/n_9$B532.Median),
                         (n_10$F532.Median/n_10$B532.Median),
                         (n_11$F532.Median/n_11$B532.Median),
                         (n_12$F532.Median/n_12$B532.Median),
                         (n_13$F532.Median/n_13$B532.Median),
                         (n_14$F532.Median/n_14$B532.Median),
                         (n_15$F532.Median/n_15$B532.Median),
                         (n_16$F532.Median/n_16$B532.Median),
                         (n_17$F532.Median/n_17$B532.Median),
                         (n_18$F532.Median/n_18$B532.Median),
                         (n_19$F532.Median/n_19$B532.Median),
                         (n_20$F532.Median/n_20$B532.Median),
                         (lc_1$F532.Median/lc_1$B532.Median),
                         (lc_2$F532.Median/lc_2$B532.Median),
                         (lc_3$F532.Median/lc_3$B532.Median),
                         (lc_4$F532.Median/lc_4$B532.Median),
                         (lc_5$F532.Median/lc_5$B532.Median),
                         (lc_6$F532.Median/lc_6$B532.Median),
                         (lc_7$F532.Median/lc_7$B532.Median),
                         (lc_8$F532.Median/lc_8$B532.Median),
                         (lc_9$F532.Median/lc_9$B532.Median),
                         (lc_10$F532.Median/lc_10$B532.Median),
                         (lc_11$F532.Median/lc_11$B532.Median),
                         (lc_12$F532.Median/lc_12$B532.Median),
                         (lc_13$F532.Median/lc_13$B532.Median),
                         (sc_1$F532.Median/sc_1$B532.Median),
                         (sc_2$F532.Median/sc_2$B532.Median),
                         (sc_3$F532.Median/sc_3$B532.Median),
                         (sc_4$F532.Median/sc_4$B532.Median),
                         (sc_5$F532.Median/sc_5$B532.Median),
                         (sc_6$F532.Median/sc_6$B532.Median),
                         (sc_7$F532.Median/sc_7$B532.Median),
                         (sc_8$F532.Median/sc_8$B532.Median),
                         (sc_9$F532.Median/sc_9$B532.Median),
                         (sc_10$F532.Median/sc_10$B532.Median),
                         (sc_11$F532.Median/sc_11$B532.Median),
                         (sc_12$F532.Median/sc_12$B532.Median),
                         (sc_13$F532.Median/sc_13$B532.Median),
                         (sc_14$F532.Median/sc_14$B532.Median),
                         (sc_15$F532.Median/sc_15$B532.Median),
                         (sc_16$F532.Median/sc_16$B532.Median),
                         (sc_17$F532.Median/sc_17$B532.Median),
                         (sc_18$F532.Median/sc_18$B532.Median),
                         (sc_19$F532.Median/sc_19$B532.Median),
                         (sc_20$F532.Median/sc_20$B532.Median),
                         (ac_1$F532.Median/ac_1$B532.Median),
                         (ac_2$F532.Median/ac_2$B532.Median),
                         (ac_3$F532.Median/ac_3$B532.Median),
                         (ac_4$F532.Median/ac_4$B532.Median),
                         (ac_5$F532.Median/ac_5$B532.Median),
                         (ac_6$F532.Median/ac_6$B532.Median),
                         (ac_7$F532.Median/ac_7$B532.Median),
                         (ac_8$F532.Median/ac_8$B532.Median),
                         (ac_9$F532.Median/ac_9$B532.Median),
                         (ac_10$F532.Median/ac_10$B532.Median),
                         (ac_11$F532.Median/ac_11$B532.Median),
                         (ac_12$F532.Median/ac_12$B532.Median),
                         (ac_13$F532.Median/ac_13$B532.Median),
                         (ac_14$F532.Median/ac_14$B532.Median),
                         (ac_15$F532.Median/ac_15$B532.Median),
                         (ac_16$F532.Median/ac_16$B532.Median),
                         (ac_17$F532.Median/ac_17$B532.Median),
                         (ac_18$F532.Median/ac_18$B532.Median),
                         (ac_19$F532.Median/ac_19$B532.Median),
                         (ac_20$F532.Median/ac_20$B532.Median),
                         (ac_21$F532.Median/ac_21$B532.Median),
                         (ac_22$F532.Median/ac_22$B532.Median),
                         (ac_23$F532.Median/ac_23$B532.Median),
                         (ac_24$F532.Median/ac_24$B532.Median),
                         (sq_1$F532.Median/sq_1$B532.Median),
                         (sq_2$F532.Median/sq_2$B532.Median),
                         (sq_3$F532.Median/sq_3$B532.Median),
                         (sq_4$F532.Median/sq_4$B532.Median),
                         (sq_5$F532.Median/sq_5$B532.Median),
                         (sq_6$F532.Median/sq_6$B532.Median),
                         (sq_7$F532.Median/sq_7$B532.Median),
                         (sq_8$F532.Median/sq_8$B532.Median),
                         (sq_9$F532.Median/sq_9$B532.Median),
                         (sq_10$F532.Median/sq_10$B532.Median),
                         (sq_11$F532.Median/sq_11$B532.Median),
                         (sq_12$F532.Median/sq_12$B532.Median),
                         (sq_13$F532.Median/sq_13$B532.Median),
                         (sq_14$F532.Median/sq_14$B532.Median),
                         (sq_15$F532.Median/sq_15$B532.Median),
                         (sq_16$F532.Median/sq_16$B532.Median),
                         (sq_17$F532.Median/sq_17$B532.Median),
                         (sq_18$F532.Median/sq_18$B532.Median),
                         (sq_19$F532.Median/sq_19$B532.Median),
                         (sq_20$F532.Median/sq_20$B532.Median),
                         (sq_21$F532.Median/sq_21$B532.Median),
                         (sq_22$F532.Median/sq_22$B532.Median),
                         (sq_23$F532.Median/sq_23$B532.Median))

log_ratio_matrix<- log(ratio_matrix)

medians<- apply(ratio_matrix,1,median)

```

```{r, cache=T, results='hide', warning=F, message=F, echo=F}
box_cox_matrix<- matrix(NA, nrow=nrow(ratio_matrix), ncol=ncol(ratio_matrix))
box_cox_lambdas_HP<- rep(NA, ncol(ratio_matrix))

ratio_matrix[which(is.na(ratio_matrix[,60])|is.infinite(ratio_matrix[,60])),60]<- 10^(-10)

for(i in 1:ncol(box_cox_matrix)){
  boxcox_result<- boxcox(ratio_matrix[,i],optimize=T)
  box_cox_matrix[,i]<- boxcox_result$data
  box_cox_lambdas_HP[i]<- boxcox_result$lambda
}


lambda_df<- as.data.frame(cbind(c(box_cox_lambdas,box_cox_lambdas_HP),c(rep("Malaria Arrays", length(box_cox_lambdas)),rep("HuProt Arrays", length(box_cox_lambdas_HP)))))
colnames(lambda_df)<- c("Lambda", "Array_Type")

lambda_df$Lambda<- as.numeric(lambda_df$Lambda)

lambda_plot<- ggplot(data=lambda_df,aes(x=Lambda, color=Array_Type))+
  geom_density()+labs(title="Distribution of Lambda Values")+theme_classic()
  
```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}

density_df_huprot<- as.data.frame(cbind(c(as.vector(ratio_matrix),as.vector(log_ratio_matrix)),c(rep("Raw",length(as.vector(ratio_matrix))),rep("Log",length(as.vector(log_ratio_matrix))))))

colnames(density_df_huprot)<- c("Fluorescent_Intensity","Transformation")
density_df_huprot$Fluorescent_Intensity<- as.numeric(density_df_huprot$Fluorescent_Intensity)
density_df_huprot$Transformation<- as.factor(density_df_huprot$Transformation)

huprot_densities<- ggplot(density_df_huprot,aes(x=Fluorescent_Intensity,color=Transformation))+
  geom_density()+
  labs(x="Fluorescent Intensity", title="Density of Fluorescent Intensities on Malaria Arrays")+xlim(0,5)

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
n_1_no_sat<- n_1%>%
  mutate("Corrected_Fluo"=log_ratio_matrix[,1])


n_1_wide_fg<- spread(n_1_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_1_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_1_wide_fg))


for(i in 1:ncol(n_1_naremoved_fg)){
  if(length(which(is.na(n_1_wide_fg[,i])==FALSE))==2){
  n_1_naremoved_fg[,i]<-n_1_wide_fg[which(is.na(n_1_wide_fg[,i])==FALSE),i]
  }
  else{
    n_1_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_1_naremoved_fg)<-colnames(n_1_wide_fg)

n_1_fg_dup<- n_1_naremoved_fg[,colSums(is.na(n_1_naremoved_fg))==0]






n_1_dup_probes<- n_1_fg_dup



M_1_dup<- (n_1_dup_probes[1,]+n_1_dup_probes[2,])/2
D_1_dup<- (n_1_dup_probes[1,]-n_1_dup_probes[2,])

X_n_1<- M_1_dup
Y_n_1<- D_1_dup

n_1_df_log<- as.data.frame(cbind(X_n_1,Y_n_1))
colnames(n_1_df_log)<- c('log_mean','dif_over_sum')


n_1_plot_log<- ggplot(n_1_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 1",x=" Mean of Log Values",y="Difference of Log Values")





n_2_no_sat<- n_2%>%
  mutate("Corrected_Fluo"=log_ratio_matrix[,2])


n_2_wide_fg<- spread(n_2_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_2_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_2_wide_fg))


for(i in 1:ncol(n_2_naremoved_fg)){
  if(length(which(is.na(n_2_wide_fg[,i])==FALSE))==2){
  n_2_naremoved_fg[,i]<-n_2_wide_fg[which(is.na(n_2_wide_fg[,i])==FALSE),i]
  }
  else{
    n_2_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_2_naremoved_fg)<-colnames(n_2_wide_fg)

n_2_fg_dup<- n_2_naremoved_fg[,colSums(is.na(n_2_naremoved_fg))==0]






n_2_dup_probes<- n_2_fg_dup



M_2_dup<- (n_2_dup_probes[1,]+n_2_dup_probes[2,])/2
D_2_dup<- (n_2_dup_probes[1,]-n_2_dup_probes[2,])

X_n_2<- M_2_dup
Y_n_2<- D_2_dup

n_2_df_log<- as.data.frame(cbind(X_n_2,Y_n_2))
colnames(n_2_df_log)<- c('log_mean','dif_over_sum')


n_2_plot_log<- ggplot(n_2_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 2",x="Mean of Log Values",y="Difference of Log Values")







lc_13_no_sat<- lc_13%>%
  mutate("Corrected_Fluo"=log_ratio_matrix[,33])


lc_13_wide_fg<- spread(lc_13_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


lc_13_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(lc_13_wide_fg))


for(i in 1:ncol(lc_13_naremoved_fg)){
  if(length(which(is.na(lc_13_wide_fg[,i])==FALSE))==2){
  lc_13_naremoved_fg[,i]<-lc_13_wide_fg[which(is.na(lc_13_wide_fg[,i])==FALSE),i]
 }
  else{
    lc_13_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(lc_13_naremoved_fg)<-colnames(lc_13_wide_fg)

lc_13_fg_dup<- lc_13_naremoved_fg[,colSums(is.na(lc_13_naremoved_fg))==0]






lc_13_dup_probes<- lc_13_fg_dup



M_13_dup<- (lc_13_dup_probes[1,]+lc_13_dup_probes[2,])/2
D_13_dup<- (lc_13_dup_probes[1,]-lc_13_dup_probes[2,])

X_lc_13<- M_13_dup
Y_lc_13<- D_13_dup

lc_13_df_log<- as.data.frame(cbind(X_lc_13,Y_lc_13))
colnames(lc_13_df_log)<- c('log_mean','dif_over_sum')


lc_13_plot_log<- ggplot(lc_13_df_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 33",x="Mean of Log Values",y="Difference of Log Values")


huprot_within_log_df<- as.data.frame(cbind(rbind(n_1_df_log,n_2_df_log,lc_13_df_log),c(rep("Array 1",nrow(n_1_df_log)),rep("Array 2",nrow(n_2_df_log)),rep("Array 33",nrow(lc_13_df_log)))))

colnames(huprot_within_log_df)<- c("log_mean",'dif_over_sum','Array')

within_log_df<- 
  as.data.frame(rbind(huprot_within_log_df,ICEMR_within_log_df))

plot_within_log<- ggplot(within_log_df,aes(x=log_mean,y=dif_over_sum))+
 geom_point()+
  geom_smooth(method="lm",col="red")+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log Values",y="Difference of Log Values")

plot_within_log
```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2<- (log_ratio_matrix[,1]+log_ratio_matrix[,2])/2
D_1_2<- (log_ratio_matrix[,1]-log_ratio_matrix[,2])

X_1_2<- M_1_2
Y_1_2<- D_1_2

df_1_2_log<- as.data.frame(cbind(X_1_2,Y_1_2))
colnames(df_1_2_log)<- c('log_mean','dif_over_sum')


plot_1_2_log<- ggplot(df_1_2_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 1,2",x="Box-Cox, RLM Mean",y="Difference of Box-Cox RLM Values")


#############################

M_1_3<- (log_ratio_matrix[,1]+log_ratio_matrix[,3])/2
D_1_3<- (log_ratio_matrix[,1]-log_ratio_matrix[,3])

X_1_3<- M_1_3
Y_1_3<- D_1_3

df_1_3_log<- as.data.frame(cbind(X_1_3,Y_1_3))
colnames(df_1_3_log)<- c('log_mean','dif_over_sum')


plot_1_3_log<- ggplot(df_1_3_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 1,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")


######################
M_2_3<- (log_ratio_matrix[,2]+log_ratio_matrix[,3])/2
D_2_3<- (log_ratio_matrix[,2]-log_ratio_matrix[,3])

X_2_3<- M_2_3
Y_2_3<- D_2_3

df_2_3_log<- as.data.frame(cbind(X_2_3,Y_2_3))
colnames(df_2_3_log)<- c('log_mean','dif_over_sum')


plot_2_3_log<- ggplot(df_2_3_log,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 2,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")




huprot_between_log_df<- as.data.frame(cbind(rbind(df_1_2_log,df_1_2_log,df_2_3_log),c(rep("Array 1,2",48384),rep("Array 1,3",48384),rep("Array 2,3",48384))))

colnames(huprot_between_log_df)<- c("log_mean",'dif','Array')



between_log_df<- as.data.frame(rbind(ICEMR_between_log_df,huprot_between_log_df))

plot_between_log<- ggplot(between_log_df,aes(x=log_mean,y=dif))+
  geom_point()+
  geom_smooth(method="lm",col="red")+
  facet_wrap(~Array, scale="free")+
  labs(x="Mean of Log Values",y="Difference of Log Values")

plot_between_log

```

```{r, cach=TRUE, results='hide', warning=FALSE, echo=FALSE,message=FALSE}
library(EnvStats)
library(dplyr)
library(MASS)
median_vals<- apply(ratio_matrix,1,median)


index_ctrl<-which(n_1$Name=="H1"|n_1$Name=="H2(A+B)"|n_1$Name=="H3"|n_1$Name=="H4"|n_1$Name=="IgG488/594"|n_1$Name=="Rhodamine+IgG647"|n_1$Name=="GST10n"|n_1$Name=="GST50n"|n_1$Name=="GST100n"|n_1$Name=="GST200n"|n_1$Name=="Mouse-anti-biotin"|n_1$Name=="Rabbit-anti-biotin"|n_1$Name=="Biotin-BSA"|n_1$Name=="BSA"|n_1$Name=="Buffer"|n_1$Name=="buffer"|n_1$Name=="empty"|n_1$Name=="Mouse-IgM\xe1")
  

#design matrix: 

slide_matrix<- matrix(0, nrow=(4608*100),ncol=99)

for(i in 2:100){
  slide_matrix[((4608*((i-1)))+1):(4608*(i)),(i-1)]<-1
}

subarray_matrix<- matrix(0,nrow=(4608*100),ncol=23)

for(i in 2:24){
  subarray_matrix[,(i-1)]<- rep(c(rep(0,(192*(i-1))),rep(1,(192)),rep(0,192*(24-i))),times=100)
}


##################

spot_names<- as.data.frame(table(n_1$Name[index_ctrl]))

spot_names<- spot_names%>%
  mutate(index=rep(1:18))

spot_index<- rep(NA,4608)

ctrl_n_1<- n_1[index_ctrl,]

for(i in 1:length(spot_index)){
  spot_index[i]<- spot_names$index[which(ctrl_n_1$Name[i]==spot_names$Var1)]
}

spot_indices<- rep(spot_index,times=100)




spot_matrix<- matrix(0,nrow=(4608*100),ncol=17)

for(i in 1:nrow(spot_matrix)){
  if(spot_indices[i]>1){
  spot_matrix[i,(spot_indices[i]-1)]<-1
  }
}

#################
#design matrix
#################

design_matrix_cancer<- as.data.frame(cbind(as.vector(log_ratio_matrix[index_ctrl,]),slide_matrix,subarray_matrix,spot_matrix))


#################

model_cancer_logs<- rlm(V1~.,design_matrix_cancer)

corrected_log_matrix<- matrix(NA,nrow=48384,ncol=100)

corrected_log_matrix<- log_ratio_matrix-model_cancer_logs$coefficients[1]

for(i in 2:100){
  corrected_log_matrix[,i]<- corrected_log_matrix[,i]-model_cancer_logs$coefficients[i]
}

for(i in 2:20){
corrected_log_matrix[(2112*(i-1)+1):(2112*i),]<- corrected_log_matrix[(2112*(i-1)+1):(2112*i),]-model_cancer_logs$coefficients[(99+i)]
}

for(i in 21:24){
  corrected_log_matrix[(((2112*20)+(1536*(i-21))+1):((2112*20)+(1536*(i-20)))),]<-corrected_log_matrix[(((2112*20)+(1536*(i-21))+1):((2112*20)+(1536*(i-20)))),]-model_cancer_logs$coefficients[(100+i)]
}

################################

design_matrix_cancerBC<- as.data.frame(cbind(as.vector(box_cox_matrix[index_ctrl,]),slide_matrix,subarray_matrix,spot_matrix))


#################

model_cancer_BC<- rlm(V1~.,design_matrix_cancerBC)

corrected_log_matrix<- matrix(NA,nrow=48384,ncol=100)

corrected_log_matrix<- log_ratio_matrix-model_cancer_logs$coefficients[1]

for(i in 2:100){
  corrected_log_matrix[,i]<- corrected_log_matrix[,i]-model_cancer_logs$coefficients[i]
}

for(i in 2:20){
corrected_log_matrix[(2112*(i-1)+1):(2112*i),]<- corrected_log_matrix[(2112*(i-1)+1):(2112*i),]-model_cancer_logs$coefficients[(99+i)]
}

for(i in 21:24){
  corrected_log_matrix[(((2112*20)+(1536*(i-21))+1):((2112*20)+(1536*(i-20)))),]<-corrected_log_matrix[(((2112*20)+(1536*(i-21))+1):((2112*20)+(1536*(i-20)))),]-model_cancer_logs$coefficients[(100+i)]
}
```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
n_1_no_sat<- n_1%>%
  mutate("Corrected_Fluo"=corrected_log_matrix[,1])


n_1_wide_fg<- spread(n_1_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_1_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_1_wide_fg))


for(i in 1:ncol(n_1_naremoved_fg)){
  if(length(which(is.na(n_1_wide_fg[,i])==FALSE))==2){
  n_1_naremoved_fg[,i]<-n_1_wide_fg[which(is.na(n_1_wide_fg[,i])==FALSE),i]
  }
  else{
    n_1_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_1_naremoved_fg)<-colnames(n_1_wide_fg)

n_1_fg_dup<- n_1_naremoved_fg[,colSums(is.na(n_1_naremoved_fg))==0]






n_1_dup_probes<- n_1_fg_dup



M_1_dup<- (n_1_dup_probes[1,]+n_1_dup_probes[2,])/2
D_1_dup<- (n_1_dup_probes[1,]-n_1_dup_probes[2,])

X_n_1<- M_1_dup
Y_n_1<- abs(D_1_dup)

n_1_df_rlm<- as.data.frame(cbind(X_n_1,Y_n_1))
colnames(n_1_df_rlm)<- c('log_mean','dif_over_sum')


n_1_plot_rlm<- ggplot(n_1_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 1",x=" Mean of Log Values",y="Difference of Log Values")





n_2_no_sat<- n_2%>%
  mutate("Corrected_Fluo"=corrected_log_matrix[,2])


n_2_wide_fg<- spread(n_2_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_2_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_2_wide_fg))


for(i in 1:ncol(n_2_naremoved_fg)){
  if(length(which(is.na(n_2_wide_fg[,i])==FALSE))==2){
  n_2_naremoved_fg[,i]<-n_2_wide_fg[which(is.na(n_2_wide_fg[,i])==FALSE),i]
  }
  else{
    n_2_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_2_naremoved_fg)<-colnames(n_2_wide_fg)

n_2_fg_dup<- n_2_naremoved_fg[,colSums(is.na(n_2_naremoved_fg))==0]






n_2_dup_probes<- n_2_fg_dup



M_2_dup<- (n_2_dup_probes[1,]+n_2_dup_probes[2,])/2
D_2_dup<- (n_2_dup_probes[1,]-n_2_dup_probes[2,])

X_n_2<- M_2_dup
Y_n_2<- abs(D_2_dup)

n_2_df_rlm<- as.data.frame(cbind(X_n_2,Y_n_2))
colnames(n_2_df_rlm)<- c('log_mean','dif_over_sum')


n_2_plot_rlm<- ggplot(n_2_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 2",x="Mean of Log Values",y="Difference of Log Values")







lc_13_no_sat<- lc_13%>%
  mutate("Corrected_Fluo"=corrected_log_matrix[,33])


lc_13_wide_fg<- spread(lc_13_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


lc_13_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(lc_13_wide_fg))


for(i in 1:ncol(lc_13_naremoved_fg)){
  if(length(which(is.na(lc_13_wide_fg[,i])==FALSE))==2){
  lc_13_naremoved_fg[,i]<-lc_13_wide_fg[which(is.na(lc_13_wide_fg[,i])==FALSE),i]
 }
  else{
    lc_13_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(lc_13_naremoved_fg)<-colnames(lc_13_wide_fg)

lc_13_fg_dup<- lc_13_naremoved_fg[,colSums(is.na(lc_13_naremoved_fg))==0]






lc_13_dup_probes<- lc_13_fg_dup



M_13_dup<- (lc_13_dup_probes[1,]+lc_13_dup_probes[2,])/2
D_13_dup<- (lc_13_dup_probes[1,]-lc_13_dup_probes[2,])

X_lc_13<- M_13_dup
Y_lc_13<- abs(D_13_dup)

lc_13_df_rlm<- as.data.frame(cbind(X_lc_13,Y_lc_13))
colnames(lc_13_df_rlm)<- c('log_mean','dif_over_sum')


lc_13_plot_rlm<- ggplot(lc_13_df_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 33",x="Mean of Log Values",y="Difference of Log Values")


huprot_within_rlm_df<- as.data.frame(cbind(rbind(n_1_df_rlm,n_2_df_rlm,lc_13_df_rlm),c(rep("Array 1",nrow(n_1_df_rlm)),rep("Array 2",nrow(n_2_df_rlm)),rep("Array 33",nrow(lc_13_df_rlm)))))

colnames(huprot_within_rlm_df)<- c("log_mean",'dif_over_sum','Array')

within_rlm_df<- 
  as.data.frame(rbind(huprot_within_rlm_df,ICEMR_within_rlm_df))

outlier_index_2<- which(within_rlm_df$Array=="Array 2"&within_rlm_df$dif_over_sum>2)

outlier_index_333<- which(within_rlm_df$Array=="Array 333"&within_rlm_df$dif_over_sum>2)

outlier_index_504<- which(within_rlm_df$Array=="Array 504"&within_rlm_df$dif_over_sum>4)

within_rlm_df_nOutlier<- within_rlm_df[-c(outlier_index_2,outlier_index_333,outlier_index_504),]


plot_within_rlm<- ggplot(within_rlm_df_nOutlier,aes(x=log_mean,y=dif_over_sum))+
 geom_point(size=0.25)+
  geom_smooth(method="loess",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected Values",y="Abs Value of Difference of Log, RLM Corrected Values")

plot_within_rlm

plot_hist_within_dif_rlm<- 
  ggplot(within_rlm_df,aes(x=dif_over_sum))+
 geom_histogram()+
  facet_wrap(~Array, scale='free')+
  labs(x="Abs Value of Difference of Log, RLM Corrected Values")

mean_abs_val_dif<- within_rlm_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif_over_sum,na.rm=T))


ccc_array1<- CCC(n_1_dup_probes[1,],n_1_dup_probes[2,])$rho.c[1]

ccc_array2<- CCC(n_2_dup_probes[1,],n_2_dup_probes[2,])$rho.c[1]

ccc_array33<- CCC(lc_13_dup_probes[1,],lc_13_dup_probes[2,])$rho.c[1]

ccc_array_333<- CCC(unlist(Sample_333_duplicate_pairs_log_rlm[1,]),unlist(Sample_333_duplicate_pairs_log_rlm[2,]))$rho.c[1]


ccc_array_43<- CCC(unlist(Sample_43_duplicate_pairs_log_rlm[1,]),unlist(Sample_43_duplicate_pairs_log_rlm[2,]))$rho.c[1]


ccc_array_504<- CCC(unlist(Sample_504_duplicate_pairs_log_rlm[1,]),unlist(Sample_504_duplicate_pairs_log_rlm[2,]))$rho.c[1]

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2<- (corrected_log_matrix[,1]+corrected_log_matrix[,2])/2
D_1_2<- (corrected_log_matrix[,1]-corrected_log_matrix[,2])

X_1_2<- M_1_2
Y_1_2<- D_1_2

df_1_2_rlm<- as.data.frame(cbind(X_1_2,Y_1_2))
colnames(df_1_2_rlm)<- c('log_mean','dif_over_sum')


plot_1_2_rlm<- ggplot(df_1_2_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 1,2",x="Box-Cox, RLM Mean",y="Difference of Box-Cox RLM Values")
summary(lm(df_1_2_rlm$dif_over_sum~df_1_2_rlm$log_mean))

#############################

M_1_3<- (corrected_log_matrix[,1]+corrected_log_matrix[,3])/2
D_1_3<- (corrected_log_matrix[,1]-corrected_log_matrix[,3])

X_1_3<- M_1_3
Y_1_3<- D_1_3

df_1_3_rlm<- as.data.frame(cbind(X_1_3,Y_1_3))
colnames(df_1_3_rlm)<- c('log_mean','dif_over_sum')


plot_1_3_rlm<- ggplot(df_1_3_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 1,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")

summary(lm(df_1_3_rlm$dif_over_sum~df_1_3_rlm$log_mean))
######################
M_2_3<- (corrected_log_matrix[,2]+corrected_log_matrix[,3])/2
D_2_3<- (corrected_log_matrix[,2]-corrected_log_matrix[,3])

X_2_3<- M_2_3
Y_2_3<- D_2_3

df_2_3_rlm<- as.data.frame(cbind(X_2_3,Y_2_3))
colnames(df_2_3_rlm)<- c('log_mean','dif_over_sum')


plot_2_3_rlm<- ggplot(df_2_3_rlm,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 2,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")


summary(lm(df_2_3_rlm$dif_over_sum~df_2_3_rlm$log_mean))

huprot_between_rlm_df<- as.data.frame(cbind(rbind(df_1_2_rlm,df_1_2_rlm,df_2_3_rlm),c(rep("Arrays 1,2",48384),rep("Arrays 1,3",48384),rep("Arrays 2,3",48384))))

colnames(huprot_between_rlm_df)<- c("log_mean",'dif','Array')



between_rlm_df<- as.data.frame(rbind(ICEMR_between_rlm_df,huprot_between_rlm_df))

outlier_index_2_3<- which(between_rlm_df$Array=="Arrays 2,3"&(between_rlm_df$dif>4|between_rlm_df$dif<(-4)))

between_rlm_df_nOutlier<-between_rlm_df[-outlier_index_2_3,] 

plot_between_rlm<- ggplot(between_rlm_df_nOutlier,aes(x=log_mean,y=dif))+
  geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected Values",y="Difference of Log, RLM Corrected Values")

plot_between_rlm

mean_dif_rlm<- between_rlm_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif,na.rm=T))


ccc_array1_2<- CCC(corrected_log_matrix[,1],corrected_log_matrix[,2])$rho.c[1]

ccc_array2_3<- CCC(corrected_log_matrix[,2],corrected_log_matrix[,3])$rho.c[1]

ccc_array1_3<- CCC(corrected_log_matrix[,1],corrected_log_matrix[,3])$rho.c[1]

ccc_array_498_500<- CCC(corrected_log_matrix[,498],corrected_log_matrix[,500])$rho.c[1]


ccc_array_498_504<- CCC(corrected_log_matrix[,498],corrected_log_matrix[,504])$rho.c[1]


ccc_array_500_504<- CCC(corrected_log_matrix[,500],corrected_log_matrix[,504])$rho.c[1]
#################################################################

#coefficient of variation within subject sd 


rlm_cv_1_2<- sd(corrected_log_matrix[,1]-corrected_log_matrix[,2])/abs(mean(corrected_log_matrix[,1]-corrected_log_matrix[,2]))

rlm_cv_1_3<- sd(corrected_log_matrix[,1]-corrected_log_matrix[,3])/abs(mean(corrected_log_matrix[,1]-corrected_log_matrix[,3]))

rlm_cv_2_3<- sd(corrected_log_matrix[,2]-corrected_log_matrix[,3])/mean(corrected_log_matrix[,2]-corrected_log_matrix[,3])


std_cv_1_2<- sd(std_ratio_matrix[,1]-std_ratio_matrix[,2])/mean(std_ratio_matrix[,1]-std_ratio_matrix[,2])

std_cv_1_3<- sd(std_ratio_matrix[,1]-std_ratio_matrix[,3])/mean(std_ratio_matrix[,1]-std_ratio_matrix[,3])

std_cv_2_3<- sd(std_ratio_matrix[,2]-std_ratio_matrix[,3])/mean(std_ratio_matrix[,2]-std_ratio_matrix[,3])

```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
mean_rlm<- apply(corrected_log_matrix[index_ctrl,],2,mean)
sd_rlm<- apply(corrected_log_matrix[index_ctrl,],2,sd)

std_ratio_matrix<- matrix(NA, nrow=nrow(corrected_log_matrix), ncol=100)

for(i in 1:100){
  for(j in 1:nrow(std_ratio_matrix))
  std_ratio_matrix[j,i]<- (corrected_log_matrix[j,i]-mean_rlm[i])/sd_rlm[i]
}

med_ratio_matrix<- matrix(NA, nrow=nrow(corrected_log_matrix),ncol=100)
med_rlm<- apply(corrected_log_matrix[index_ctrl,],2,median)
iqr_rlm<- apply(corrected_log_matrix[index_ctrl,],2,IQR)/1.35
for(i in 1:100){
  med_ratio_matrix[,i]<- (corrected_log_matrix[,i]-med_rlm[i])/iqr_rlm[i]
}


wins_ratio_matrix<- matrix(NA, nrow=nrow(corrected_log_matrix),ncol=100)
wins_mean_rlm<- apply(apply(corrected_log_matrix[index_ctrl,],2,Winsorize),2,mean)
wins_sd_rlm<- apply(apply(corrected_log_matrix[index_ctrl,],2,Winsorize),2,sd)
for(i in 1:100){
  wins_ratio_matrix[,i]<- (corrected_log_matrix[,i]-wins_mean_rlm[i])/wins_sd_rlm[i]
}

quant_ratio_matrix<- normalize.quantiles(log_ratio_matrix)


log_ratio_matrix[is.nan(log_ratio_matrix)]<-0


log_ratio_matrix[which(is.infinite(log_ratio_matrix))]<-0

vsn_ratio_matrix<- normalizeVSN(log_ratio_matrix)

svsn_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlm<- apply(vsn_ratio_matrix[index_ctrls,],2,mean)
sd_rlm<- apply(vsn_ratio_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  svsn_ratio_matrix[,i]<- (vsn_ratio_matrix[,i]-mean_rlm[i])/sd_rlm[i]
}

cyclic_loess_matrix<- normalizeCyclicLoess(log_ratio_matrix)


scyclic_loess_ratio_matrix<- matrix(NA, nrow=1156,ncol=504)
mean_rlm<- apply(cyclic_loess_matrix[index_ctrls,],2,mean)
sd_rlm<- apply(cyclic_loess_matrix[index_ctrls,],2,sd)
for(i in 1:504){
  scyclic_loess_ratio_matrix[,i]<- (cyclic_loess_matrix[,i]-mean_rlm[i])/sd_rlm[i]
}


```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
n_1_no_sat<- n_1%>%
  mutate("Corrected_Fluo"=std_ratio_matrix[,1])


n_1_wide_fg<- spread(n_1_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_1_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_1_wide_fg))


for(i in 1:ncol(n_1_naremoved_fg)){
  if(length(which(is.na(n_1_wide_fg[,i])==FALSE))==2){
  n_1_naremoved_fg[,i]<-n_1_wide_fg[which(is.na(n_1_wide_fg[,i])==FALSE),i]
  }
  else{
    n_1_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_1_naremoved_fg)<-colnames(n_1_wide_fg)

n_1_fg_dup<- n_1_naremoved_fg[,colSums(is.na(n_1_naremoved_fg))==0]






n_1_dup_probes<- n_1_fg_dup



M_1_dup<- (n_1_dup_probes[1,]+n_1_dup_probes[2,])/2
D_1_dup<- (n_1_dup_probes[1,]-n_1_dup_probes[2,])

X_n_1<- M_1_dup
Y_n_1<- D_1_dup

n_1_df_std<- as.data.frame(cbind(X_n_1,Y_n_1))
colnames(n_1_df_std)<- c('log_mean','dif_over_sum')


n_1_plot_std<- ggplot(n_1_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 1",x=" Mean of Log Values",y="Difference of Log Values")





n_2_no_sat<- n_2%>%
  mutate("Corrected_Fluo"=std_ratio_matrix[,2])


n_2_wide_fg<- spread(n_2_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


n_2_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(n_2_wide_fg))


for(i in 1:ncol(n_2_naremoved_fg)){
  if(length(which(is.na(n_2_wide_fg[,i])==FALSE))==2){
  n_2_naremoved_fg[,i]<-n_2_wide_fg[which(is.na(n_2_wide_fg[,i])==FALSE),i]
  }
  else{
    n_2_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(n_2_naremoved_fg)<-colnames(n_2_wide_fg)

n_2_fg_dup<- n_2_naremoved_fg[,colSums(is.na(n_2_naremoved_fg))==0]






n_2_dup_probes<- n_2_fg_dup



M_2_dup<- (n_2_dup_probes[1,]+n_2_dup_probes[2,])/2
D_2_dup<- (n_2_dup_probes[1,]-n_2_dup_probes[2,])

X_n_2<- M_2_dup
Y_n_2<- D_2_dup

n_2_df_std<- as.data.frame(cbind(X_n_2,Y_n_2))
colnames(n_2_df_std)<- c('log_mean','dif_over_sum')


n_2_plot_std<- ggplot(n_2_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 2",x="Mean of Log Values",y="Difference of Log Values")







lc_13_no_sat<- lc_13%>%
  mutate("Corrected_Fluo"=std_ratio_matrix[,33])


lc_13_wide_fg<- spread(lc_13_no_sat[,c(1,2,3,4,59)],key="Name",value="Corrected_Fluo")


lc_13_naremoved_fg<-matrix(NA,nrow=2,ncol=ncol(lc_13_wide_fg))


for(i in 1:ncol(lc_13_naremoved_fg)){
  if(length(which(is.na(lc_13_wide_fg[,i])==FALSE))==2){
  lc_13_naremoved_fg[,i]<-lc_13_wide_fg[which(is.na(lc_13_wide_fg[,i])==FALSE),i]
 }
  else{
    lc_13_naremoved_fg[,i]<- rep(NA,2)
  }

}

colnames(lc_13_naremoved_fg)<-colnames(lc_13_wide_fg)

lc_13_fg_dup<- lc_13_naremoved_fg[,colSums(is.na(lc_13_naremoved_fg))==0]






lc_13_dup_probes<- lc_13_fg_dup



M_13_dup<- (lc_13_dup_probes[1,]+lc_13_dup_probes[2,])/2
D_13_dup<- (lc_13_dup_probes[1,]-lc_13_dup_probes[2,])

X_lc_13<- M_13_dup
Y_lc_13<- D_13_dup

lc_13_df_std<- as.data.frame(cbind(X_lc_13,Y_lc_13))
colnames(lc_13_df_std)<- c('log_mean','dif_over_sum')


lc_13_plot_std<- ggplot(lc_13_df_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Array 33",x="Mean of Log Values",y="Difference of Log Values")

n_2_df_std_nOutlier<- n_2_df_std[which(n_2_df_std$dif_over_sum>(-4)),]

huprot_within_std_df<- as.data.frame(cbind(rbind(n_1_df_std,n_2_df_std,lc_13_df_std),c(rep("Array 1",nrow(n_1_df_std)),rep("Array 2",nrow(n_2_df_std)),rep("Array 33",nrow(lc_13_df_std)))))

colnames(huprot_within_std_df)<- c("log_mean",'dif_over_sum','Array')

huprot_within_std_df_nOutlier<- as.data.frame(cbind(rbind(n_1_df_std,n_2_df_std_nOutlier,lc_13_df_std),c(rep("Array 1",nrow(n_1_df_std)),rep("Array 2",nrow(n_2_df_std_nOutlier)),rep("Array 33",nrow(lc_13_df_std)))))

colnames(huprot_within_std_df_nOutlier)<- c("log_mean",'dif_over_sum','Array')


within_std_df_nOutlier<- 
  as.data.frame(rbind(huprot_within_std_df_nOutlier,ICEMR_within_std_df))

plot_within_std_nOutlier<- ggplot(within_std_df_nOutlier,aes(x=log_mean,y=dif_over_sum))+
 geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected and Standardized Values",y="Abs Value of Difference of Log, RLM Corrected and Standardized Values")


plot_within_std_nOutlier
```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2<- (std_ratio_matrix[,1]+std_ratio_matrix[,2])/2
D_1_2<- (std_ratio_matrix[,1]-std_ratio_matrix[,2])

X_1_2<- M_1_2
Y_1_2<- D_1_2

df_1_2_std<- as.data.frame(cbind(X_1_2,Y_1_2))
colnames(df_1_2_std)<- c('log_mean','dif_over_sum')


plot_1_2_std<- ggplot(df_1_2_std,aes(x=log_mean, y=dif_over_sum))+
geom_point(size=0.01)+
  geom_smooth(method=MASS::rlm,col="red", se=F)+
  geom_smooth(method=lm,col="blue", se=F)+
  geom_smooth(method=loess,col='green',se=F)+
  labs(title="Arrays 1,2",x="Mean of Log, RLM, Standardized Values",y="Difference of Log, RLM, Standardized Values")

summary(lm(df_1_2_std$dif_over_sum~df_1_2_std$log_mean))

#############################

M_1_3<- (std_ratio_matrix[,1]+std_ratio_matrix[,3])/2
D_1_3<- (std_ratio_matrix[,1]-std_ratio_matrix[,3])

X_1_3<- M_1_3
Y_1_3<- D_1_3

df_1_3_std<- as.data.frame(cbind(X_1_3,Y_1_3))
colnames(df_1_3_std)<- c('log_mean','dif_over_sum')


plot_1_3_std<- ggplot(df_1_3_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 1,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")

summary(lm(df_1_3_std$dif_over_sum~df_1_3_std$log_mean))
######################
M_2_3<- (std_ratio_matrix[,2]+std_ratio_matrix[,3])/2
D_2_3<- (std_ratio_matrix[,2]-std_ratio_matrix[,3])

X_2_3<- M_2_3
Y_2_3<- D_2_3

df_2_3_std<- as.data.frame(cbind(X_2_3,Y_2_3))
colnames(df_2_3_std)<- c('log_mean','dif_over_sum')


plot_2_3_std<- ggplot(df_2_3_std,aes(x=log_mean, y=dif_over_sum))+
geom_point()+
  geom_smooth(method="lm",col="red")+
  labs(title="Arrays 2,3",x="Box-Cox, RLM Mean",y="Difference of Box-Cox, RLM Values")


summary(lm(df_2_3_std$dif_over_sum~df_2_3_std$log_mean))

huprot_between_std_df<- as.data.frame(cbind(rbind(df_1_2_std,df_1_2_std,df_2_3_std),c(rep("Array 1,2",48384),rep("Array 1,3",48384),rep("Array 2,3",48384))))

colnames(huprot_between_std_df)<- c("log_mean",'dif','Array')



between_std_df<- as.data.frame(rbind(ICEMR_between_std_df,huprot_between_std_df))

outlier_2_3_index<- which(between_std_df$Array=="Array 2,3"&(between_std_df$dif>5|between_std_df$dif<(-5)))

between_std_df_nOutlier<- between_std_df[-outlier_2_3_index,]

plot_between_std<- ggplot(between_std_df_nOutlier,aes(x=log_mean,y=dif))+
  geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected and Standardized Values",y="Difference of Log, RLM Corrected and Standardized Values")

plot_between_std


mean_dif_std<- between_std_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif,na.rm=T))


ccc_array1_2<- CCC(std_ratio_matrix[,1],std_ratio_matrix[,2])$rho.c[1]

ccc_array2_3<- CCC(std_ratio_matrix[,2],std_ratio_matrix[,3])$rho.c[1]

ccc_array1_3<- CCC(std_ratio_matrix[,1],std_ratio_matrix[,3])$rho.c[1]

ccc_array_498_500<- CCC(std_ratio_matrix[,498],std_ratio_matrix[,500])$rho.c[1]


ccc_array_498_504<- CCC(std_ratio_matrix[,498],std_ratio_matrix[,504])$rho.c[1]


ccc_array_500_504<- CCC(std_ratio_matrix[,500],std_ratio_matrix[,504])$rho.c[1]



```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2M<- (med_ratio_matrix[,1]+med_ratio_matrix[,2])/2
D_1_2M<- (med_ratio_matrix[,1]-med_ratio_matrix[,2])

X_1_2M<- M_1_2M
Y_1_2M<- D_1_2M

df_1_2_stdM<- as.data.frame(cbind(X_1_2M,Y_1_2M))
colnames(df_1_2_stdM)<- c('log_mean','dif_over_sum')


summary(lm(df_1_2_stdM$dif_over_sum~df_1_2_stdM$log_mean))

#############################

M_1_3M<- (med_ratio_matrix[,1]+med_ratio_matrix[,3])/2
D_1_3M<- (med_ratio_matrix[,1]-med_ratio_matrix[,3])

X_1_3M<- M_1_3M
Y_1_3M<- D_1_3M

df_1_3_stdM<- as.data.frame(cbind(X_1_3M,Y_1_3M))
colnames(df_1_3_stdM)<- c('log_mean','dif_over_sum')


summary(lm(df_1_3_stdM$dif_over_sum~df_1_3_stdM$log_mean))
######################
M_2_3M<- (med_ratio_matrix[,2]+med_ratio_matrix[,3])/2
D_2_3M<- (med_ratio_matrix[,2]-med_ratio_matrix[,3])

X_2_3M<- M_2_3M
Y_2_3M<- D_2_3M

df_2_3_stdM<- as.data.frame(cbind(X_2_3M,Y_2_3M))
colnames(df_2_3_stdM)<- c('log_mean','dif_over_sum')




summary(lm(df_2_3_stdM$dif_over_sum~df_2_3_stdM$log_mean))

huprot_between_med_df<- as.data.frame(cbind(rbind(df_1_2_stdM,df_1_2_stdM,df_2_3_stdM),c(rep("Array 1,2",48384),rep("Array 1,3",48384),rep("Array 2,3",48384))))

colnames(huprot_between_med_df)<- c("log_mean",'dif','Array')



between_med_df<- as.data.frame(rbind(ICEMR_between_med_df,huprot_between_med_df))

outlier_2_3_index<- which(between_med_df$Array=="Array 2,3"&(between_med_df$dif>5|between_med_df$dif<(-5)))

between_med_df_nOutlier<- between_med_df[-outlier_2_3_index,]

plot_between_med<- ggplot(between_med_df_nOutlier,aes(x=log_mean,y=dif))+
  geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected and Median Standardized Values",y="Difference of Log, RLM Corrected and Median Standardized Values")

plot_between_med


mean_dif_med<- between_med_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif,na.rm=T))


ccc_array1_2<- CCC(med_ratio_matrix[,1],med_ratio_matrix[,2])$rho.c[1]

ccc_array2_3<- CCC(med_ratio_matrix[,2],med_ratio_matrix[,3])$rho.c[1]

ccc_array1_3<- CCC(med_ratio_matrix[,1],med_ratio_matrix[,3])$rho.c[1]

ccc_array_498_500<- CCC(med_ratio_matrix[,498],med_ratio_matrix[,500])$rho.c[1]


ccc_array_498_504<- CCC(med_ratio_matrix[,498],med_ratio_matrix[,504])$rho.c[1]


ccc_array_500_504<- CCC(med_ratio_matrix[,500],med_ratio_matrix[,504])$rho.c[1]



```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2W<- (wins_ratio_matrix[,1]+wins_ratio_matrix[,2])/2
D_1_2W<- (wins_ratio_matrix[,1]-wins_ratio_matrix[,2])

X_1_2W<- M_1_2W
Y_1_2W<- D_1_2W

df_1_2_stdW<- as.data.frame(cbind(X_1_2W,Y_1_2W))
colnames(df_1_2_stdW)<- c('log_mean','dif_over_sum')


summary(lm(df_1_2_stdW$dif_over_sum~df_1_2_stdW$log_mean))

#############################

M_1_3W<- (wins_ratio_matrix[,1]+wins_ratio_matrix[,3])/2
D_1_3W<- (wins_ratio_matrix[,1]-wins_ratio_matrix[,3])

X_1_3W<- M_1_3W
Y_1_3W<- D_1_3W

df_1_3_stdW<- as.data.frame(cbind(X_1_3W,Y_1_3W))
colnames(df_1_3_stdW)<- c('log_mean','dif_over_sum')


summary(lm(df_1_3_stdW$dif_over_sum~df_1_3_stdW$log_mean))
######################
M_2_3W<- (wins_ratio_matrix[,2]+wins_ratio_matrix[,3])/2
D_2_3W<- (wins_ratio_matrix[,2]-wins_ratio_matrix[,3])

X_2_3W<- M_2_3W
Y_2_3W<- D_2_3W

df_2_3_stdW<- as.data.frame(cbind(X_2_3W,Y_2_3W))
colnames(df_2_3_stdW)<- c('log_mean','dif_over_sum')




summary(lm(df_2_3_stdW$dif_over_sum~df_2_3_stdW$log_mean))

huprot_between_wins_df<- as.data.frame(cbind(rbind(df_1_2_stdW,df_1_2_stdW,df_2_3_stdW),c(rep("Array 1,2",48384),rep("Array 1,3",48384),rep("Array 2,3",48384))))

colnames(huprot_between_wins_df)<- c("log_mean",'dif','Array')



between_wins_df<- as.data.frame(rbind(ICEMR_between_wins_df,huprot_between_wins_df))

outlier_2_3_index<- which(between_wins_df$Array=="Array 2,3"&(between_wins_df$dif>5|between_wins_df$dif<(-5)))

between_wins_df_nOutlier<- between_wins_df[-outlier_2_3_index,]

plot_between_wins<- ggplot(between_wins_df_nOutlier,aes(x=log_mean,y=dif))+
  geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected and Winsorized Standardized Values",y="Difference of Log, RLM Corrected and Winsorized Standardized Values")

plot_between_wins


mean_dif_wins<- between_wins_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif,na.rm=T))


ccc_array1_2<- CCC(wins_ratio_matrix[,1],wins_ratio_matrix[,2])$rho.c[1]

ccc_array2_3<- CCC(wins_ratio_matrix[,2],wins_ratio_matrix[,3])$rho.c[1]

ccc_array1_3<- CCC(wins_ratio_matrix[,1],wins_ratio_matrix[,3])$rho.c[1]

ccc_array_498_500<- CCC(wins_ratio_matrix[,498],wins_ratio_matrix[,500])$rho.c[1]


ccc_array_498_504<- CCC(wins_ratio_matrix[,498],wins_ratio_matrix[,504])$rho.c[1]


ccc_array_500_504<- CCC(wins_ratio_matrix[,500],wins_ratio_matrix[,504])$rho.c[1]



```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
M_1_2Q<- (quant_ratio_matrix[,1]+quant_ratio_matrix[,2])/2
D_1_2Q<- (quant_ratio_matrix[,1]-quant_ratio_matrix[,2])

X_1_2Q<- M_1_2Q
Y_1_2Q<- D_1_2Q

df_1_2_stdQ<- as.data.frame(cbind(X_1_2Q,Y_1_2Q))
colnames(df_1_2_stdQ)<- c('log_mean','dif_over_sum')


summary(lm(df_1_2_stdQ$dif_over_sum~df_1_2_stdQ$log_mean))

#############################

M_1_3Q<- (quant_ratio_matrix[,1]+quant_ratio_matrix[,3])/2
D_1_3Q<- (quant_ratio_matrix[,1]-quant_ratio_matrix[,3])

X_1_3Q<- M_1_3Q
Y_1_3Q<- D_1_3Q

df_1_3_stdQ<- as.data.frame(cbind(X_1_3Q,Y_1_3Q))
colnames(df_1_3_stdQ)<- c('log_mean','dif_over_sum')


summary(lm(df_1_3_stdQ$dif_over_sum~df_1_3_stdQ$log_mean))
######################
M_2_3Q<- (quant_ratio_matrix[,2]+quant_ratio_matrix[,3])/2
D_2_3Q<- (quant_ratio_matrix[,2]-quant_ratio_matrix[,3])

X_2_3Q<- M_2_3Q
Y_2_3Q<- D_2_3Q

df_2_3_stdQ<- as.data.frame(cbind(X_2_3Q,Y_2_3Q))
colnames(df_2_3_stdQ)<- c('log_mean','dif_over_sum')




summary(lm(df_2_3_stdQ$dif_over_sum~df_2_3_stdQ$log_mean))

huprot_between_quant_df<- as.data.frame(cbind(rbind(df_1_2_stdQ,df_1_2_stdQ,df_2_3_stdQ),c(rep("Array 1,2",48384),rep("Array 1,3",48384),rep("Array 2,3",48384))))

colnames(huprot_between_quant_df)<- c("log_mean",'dif','Array')



between_quant_df<- as.data.frame(rbind(ICEMR_between_quant_df,huprot_between_quant_df))

outlier_2_3_index<- which(between_quant_df$Array=="Array 2,3"&(between_quant_df$dif>5|between_quant_df$dif<(-5)))

between_quant_df_nOutlier<- between_quant_df[-outlier_2_3_index,]

plot_between_quant<- ggplot(between_quant_df_nOutlier,aes(x=log_mean,y=dif))+
  geom_point(size=0.25)+
  geom_smooth(method="lm",col="red", se=F)+
  facet_wrap(~Array, scale='free')+
  labs(x="Mean of Log, RLM Corrected and Quantile Normalized Values",y="Difference of Log, RLM Corrected and Quantile Normalized Values")

plot_between_quant


mean_dif_std<- between_std_df%>%
  group_by(Array)%>%
  summarise(mean_dif= mean(dif,na.rm=T))


ccc_array1_2<- CCC(std_ratio_matrix[,1],std_ratio_matrix[,2])$rho.c[1]

ccc_array2_3<- CCC(std_ratio_matrix[,2],std_ratio_matrix[,3])$rho.c[1]

ccc_array1_3<- CCC(std_ratio_matrix[,1],std_ratio_matrix[,3])$rho.c[1]

ccc_array_498_500<- CCC(std_ratio_matrix[,498],std_ratio_matrix[,500])$rho.c[1]


ccc_array_498_504<- CCC(std_ratio_matrix[,498],std_ratio_matrix[,504])$rho.c[1]


ccc_array_500_504<- CCC(std_ratio_matrix[,500],std_ratio_matrix[,504])$rho.c[1]



```

```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}



rlm_medians<- apply(corrected_log_matrix,1,median)


rlm_medians_proteins<- as.data.frame(cbind(n_1$ID,rlm_medians))
 



rlm_medians_ctrl_proteins<- rlm_medians_proteins[index_ctrl,]

rlm_medians_test_proteins<- rlm_medians_proteins[-c(index_ctrl),]

rlm_medians_test_proteins$rlm_medians<- as.numeric(rlm_medians_test_proteins$rlm_medians)

rlm_medians_test_proteins<- rlm_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(rlm_medians,na.rm=T))

ordered_rlm_medians_test_proteins<- rlm_medians_test_proteins[order(rlm_medians_test_proteins[,2],decreasing = TRUE),]

ranked_rlm_test_proteins<-cbind(ordered_rlm_medians_test_proteins,rep(1:nrow(ordered_rlm_medians_test_proteins)))
##################################

raw_medians<- apply(ratio_matrix,1,median)


raw_medians_proteins<- as.data.frame(cbind(n_1$ID,raw_medians), stringsAsFactors=FALSE,col.names=c("ID","Intensity"))

raw_medians_proteins$raw_medians<- as.numeric(raw_medians_proteins$raw_medians)

#separate control and test probes: 

raw_medians_ctrl_proteins<- raw_medians_proteins[index_ctrl,]

raw_medians_test_proteins<- raw_medians_proteins[-c(index_ctrl),]

raw_medians_test_proteins$raw_medians<- as.numeric(raw_medians_test_proteins$raw_medians)


raw_medians_test_proteins<- raw_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(raw_medians,na.rm=T))


ordered_raw_medians_test_proteins<- raw_medians_test_proteins[order(raw_medians_test_proteins[,2],decreasing = TRUE),]

ranked_raw_test_proteins<-cbind(ordered_raw_medians_test_proteins,rep(1:nrow(ordered_raw_medians_test_proteins)))
#######################################


std_medians<- apply(std_ratio_matrix[,1:20],1,median,na.rm=T)


std_medians_proteins<- as.data.frame(cbind(n_1$ID,std_medians))
 



std_medians_ctrl_proteins<- std_medians_proteins[index_ctrl,]

std_medians_test_proteins<- std_medians_proteins[-c(index_ctrl),]

std_medians_test_proteins$std_medians<- as.numeric(std_medians_test_proteins$std_medians)

std_medians_test_proteins<- std_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(std_medians,na.rm=T))


ordered_std_medians_test_proteins<- std_medians_test_proteins[order(std_medians_test_proteins[,2],decreasing = TRUE),]

ranked_std_test_proteins<-cbind(ordered_std_medians_test_proteins,rep(1:nrow(ordered_std_medians_test_proteins)))

########################################

Method<- rep(c(1,2,3),each=20)

Antigen<- rep(c(1:10,25:34),times=3)

Ordering<- rep(c(1:20),times=3)

Rank<- c(1:10,25:34,1,2,3,4,5,6,8,7,9,10,25,26,31,29,28,27,32,30,33,34,1,2,3,4,5,6,8,7,9,11,25,26,30,33,34,29,27,28,31,37)


Huprot_rank_df<- as.data.frame(cbind(Method, Antigen, Rank, Ordering))


Huprot_rank_df$Method<- as.numeric(Huprot_rank_df$Method)
Huprot_rank_df$Antigen<- as.factor(Huprot_rank_df$Antigen)
Huprot_rank_df$Rank<- as.integer(Huprot_rank_df$Rank)
Huprot_rank_df$Ordering<- as.numeric(Huprot_rank_df$Ordering)

Huprot_rank_plot<- ggplot(Huprot_rank_df, aes(x=Method,stratum=Antigen, alluvium=Rank, fill=Antigen,label=Rank))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="HuProt Arrays Antigen Ranks")

plot_grid(ICEMR_rank_plot,Huprot_rank_plot)

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


med_medians<- apply(med_ratio_matrix,1,median,na.rm=T)


med_medians_proteins<- as.data.frame(cbind(n_1$ID,med_medians))
 



med_medians_ctrl_proteins<- med_medians_proteins[index_ctrl,]

med_medians_test_proteins<- med_medians_proteins[-c(index_ctrl),]

med_medians_test_proteins$med_medians<- as.numeric(med_medians_test_proteins$med_medians)

med_medians_test_proteins<- med_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(med_medians,na.rm=T))


ordered_med_medians_test_proteins<- med_medians_test_proteins[order(med_medians_test_proteins[,2],decreasing = TRUE),]

ranked_med_test_proteins<-cbind(ordered_med_medians_test_proteins,rep(1:nrow(ordered_med_medians_test_proteins)))

########################################


Rank_med<- c(1:10,25:34,1,2,3,4,5,6,8,7,9,10,25,26,31,29,28,27,32,30,33,34,1,2,3,4,5,6,8,7,10,12,38,28,31,27,34,23,22,24,39,44)


Huprot_rank_df_med<- as.data.frame(cbind(Method, Antigen, Rank_med, Ordering))


Huprot_rank_df_med$Method<- as.numeric(Huprot_rank_df_med$Method)
Huprot_rank_df_med$Antigen<- as.factor(Huprot_rank_df_med$Antigen)
Huprot_rank_df_med$Rank_med<- as.integer(Huprot_rank_df_med$Rank_med)
Huprot_rank_df_med$Ordering<- as.numeric(Huprot_rank_df_med$Ordering)

Huprot_rank_plot_med<- ggplot(Huprot_rank_df_med, aes(x=Method,stratum=Antigen, alluvium=Rank_med, fill=Antigen,label=Rank_med))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="HuProt Arrays Antigen Ranks (Median Standardized)")

plot_grid(ICEMR_rank_plot_med,Huprot_rank_plot_med)

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


wins_medians<- apply(wins_ratio_matrix,1,median,na.rm=T)


wins_medians_proteins<- as.data.frame(cbind(n_1$ID,wins_medians))
 



wins_medians_ctrl_proteins<- wins_medians_proteins[index_ctrl,]

wins_medians_test_proteins<- wins_medians_proteins[-c(index_ctrl),]

wins_medians_test_proteins$wins_medians<- as.numeric(wins_medians_test_proteins$wins_medians)

wins_medians_test_proteins<- wins_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(wins_medians,na.rm=T))


ordered_wins_medians_test_proteins<- wins_medians_test_proteins[order(wins_medians_test_proteins[,2],decreasing = TRUE),]

ranked_wins_test_proteins<-cbind(ordered_wins_medians_test_proteins,rep(1:nrow(ordered_wins_medians_test_proteins)))

########################################


Rank_wins<- c(1:10,25:34,1,2,3,4,5,6,8,7,9,10,25,26,31,29,28,27,32,30,33,34,1,2,3,4,5,6,8,7,9,11,33,27,26,30,32,28,23,25,40,42)


Huprot_rank_df_wins<- as.data.frame(cbind(Method, Antigen, Rank_wins, Ordering))


Huprot_rank_df_wins$Method<- as.numeric(Huprot_rank_df_wins$Method)
Huprot_rank_df_wins$Antigen<- as.factor(Huprot_rank_df_wins$Antigen)
Huprot_rank_df_wins$Rank_wins<- as.integer(Huprot_rank_df_wins$Rank_wins)
Huprot_rank_df_wins$Ordering<- as.numeric(Huprot_rank_df_wins$Ordering)

Huprot_rank_plot_wins<- ggplot(Huprot_rank_df_wins, aes(x=Method,stratum=Antigen, alluvium=Rank_wins, fill=Antigen,label=Rank_wins))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="HuProt Arrays Antigen Ranks (Winsorized Standardized)")

plot_grid(ICEMR_rank_plot_wins,Huprot_rank_plot_wins)

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


quant_medians<- apply(quant_ratio_matrix,1,median,na.rm=T)


quant_medians_proteins<- as.data.frame(cbind(n_1$ID,quant_medians))
 



quant_medians_ctrl_proteins<- quant_medians_proteins[index_ctrl,]

quant_medians_test_proteins<- quant_medians_proteins[-c(index_ctrl),]

quant_medians_test_proteins$quant_medians<- as.numeric(quant_medians_test_proteins$quant_medians)

quant_medians_test_proteins<- quant_medians_test_proteins%>%
  group_by(V1)%>%
  summarise(median_vals=median(quant_medians,na.rm=T))


ordered_quant_medians_test_proteins<- quant_medians_test_proteins[order(quant_medians_test_proteins[,2],decreasing = TRUE),]

ranked_quant_test_proteins<-cbind(ordered_quant_medians_test_proteins,rep(1:nrow(ordered_quant_medians_test_proteins)))

########################################


Rank_quant<- c(1:10,25:34,1,2,3,4,5,6,8,7,9,10,25,26,31,29,28,27,32,30,33,34,1,2,3,4,5,6,8,7,9,15,25,26,28,32,34,27,29,31,30,33)


Huprot_rank_df_quant<- as.data.frame(cbind(Method, Antigen, Rank_quant, Ordering))


Huprot_rank_df_quant$Method<- as.numeric(Huprot_rank_df_quant$Method)
Huprot_rank_df_quant$Antigen<- as.factor(Huprot_rank_df_quant$Antigen)
Huprot_rank_df_quant$Rank_quant<- as.integer(Huprot_rank_df_quant$Rank_quant)
Huprot_rank_df_quant$Ordering<- as.numeric(Huprot_rank_df_quant$Ordering)

Huprot_rank_plot_quant<- ggplot(Huprot_rank_df_quant, aes(x=Method,stratum=Antigen, alluvium=Rank_quant, fill=Antigen,label=Rank_quant))+
  scale_x_discrete(limits=c("Raw Ranks", "Log, RLM, Ranks", "Log, RLM, Std Ranks"))+
  geom_flow(stat="alluvium", lode.guidance="frontback")+
  geom_stratum(alpha=0.75)+
  geom_text(stat="stratum", size=3)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.length.y = unit(0,"cm"), legend.position = "none")+
  scale_fill_viridis(discrete=TRUE)+
  labs(title="HuProt Arrays Antigen Ranks (Quantile Normalization)")

plot_grid(ICEMR_rank_plot_quant,Huprot_rank_plot_quant)

```


```{r, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

random_index_ICEMR<- sample(c(1:504), size=10, replace=F)

ICEMR_densities_raw<- as.data.frame(cbind(as.vector(log_ratio_matrix[,random_index_ICEMR]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

ICEMR_densities_quant<-as.data.frame(cbind(as.vector(quant_ratio_matrix[,random_index_ICEMR]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

ICEMR_densities_vsn<-as.data.frame(cbind(as.vector(vsn_ratio_matrix[,random_index_ICEMR]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

ICEMR_densities_cyclic_loess<-as.data.frame(cbind(as.vector(cyclic_loess_matrix[,random_index_ICEMR]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

ICEMR_densities_std<-as.data.frame(cbind(as.vector(std_ratio_matrix[,random_index_ICEMR]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

random_index_HuProt<- sample(c(1:100), size=10,replace=F)

huprot_densities_raw<- as.data.frame(cbind(as.vector(std_ratio_matrix[,random_index_HuProt]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )

huprot_densities_quant<-as.data.frame(cbind(as.vector(quant_ratio_matrix[,random_index_HuProt]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )


huprot_densities_vsn<-as.data.frame(cbind(as.vector(vsn_ratio_matrix[,random_index_HuProt]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )


huprot_densities_cyclic_loess<-as.data.frame(cbind(as.vector(cyclic_loess_matrix[,random_index_HuProt]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )


huprot_densities_std<-as.data.frame(cbind(as.vector(std_ratio_matrix[,random_index_HuProt]),rep(c("Array 1","Array 2", "Array 3", "Array 4", "Array 5", "Array 6","Array 7", "Array 8", "Array 9", "Array 10"),each=nrow(ratio_matrix))) )


densities_quant_df<- as.data.frame(cbind(rbind(ICEMR_densities_raw,ICEMR_densities_quant,ICEMR_densities_vsn,ICEMR_densities_cyclic_loess,ICEMR_densities_std,huprot_densities_raw,huprot_densities_quant,huprot_densities_vsn, huprot_densities_cyclic_loess, huprot_densities_std),c(rep(c("Malaria"), 1156*50),rep(c("HuProt"),48384*50)), c(rep("Log",1156*10),rep("Quantile", 1156*10),rep("VSN", 1156*10),rep("Cyclic Loess", 1156*10),rep("RLM+Std", 1156*10),rep("Log",48384*10),rep("Quantile", 48384*10),rep("VSN", 48384*10),rep("Cyclic Loess", 48384*10),rep("RLM+Std", 48384*10))))

#densities_quant_df<- as.data.frame(cbind(rbind(ICEMR_densities_raw,ICEMR_densities_quant,huprot_densities_raw,huprot_densities_quant),c(rep(c("Malaria"), 1156*20), rep(c("Huprot"),48384*20)), c(rep("Raw Intensities",1156*10),rep("Quantile Normalized Intensities", 1156*10),rep("Raw Intensities",48384*10),rep("Quantile Normalized Intensities", 48384*10))))

colnames(densities_quant_df)<- c("Intensities", "Array_Number","Study", "Method")


densities_quant_df$Intensities<- as.numeric(densities_quant_df$Intensities)

densities_quant_df_nOutlier<- densities_quant_df%>%
  filter(Intensities<40)

densities_plot<- ggplot(data=densities_quant_df_nOutlier,aes(x=Intensities))+
  geom_density(aes(group=Array_Number))+
  facet_grid(Study~Method, scales="free")+theme_classic()

```